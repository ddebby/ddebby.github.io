<!DOCTYPE html>
<html  lang="zh">
<head>
    <meta charset="utf-8" />

<meta name="generator" content="Hexo 3.9.0" />

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />

<title>Ebby&#39;s Notes</title>


    <meta name="description" content="记录人工智能学习路径">
<meta name="keywords" content="人工智能, AI, 神经网络, 算法">
<meta property="og:type" content="website">
<meta property="og:title" content="Ebby&#39;s Notes">
<meta property="og:url" content="http://blog.a-stack.com/page/11/index.html">
<meta property="og:site_name" content="Ebby&#39;s Notes">
<meta property="og:description" content="记录人工智能学习路径">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="http://blog.a-stack.com/images/og_image.png">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Ebby&#39;s Notes">
<meta name="twitter:description" content="记录人工智能学习路径">
<meta name="twitter:image" content="http://blog.a-stack.com/images/og_image.png">







<link rel="icon" href="/images/favicon.svg">


<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.7.2/css/bulma.css">
<link rel="stylesheet" href="https://cdn.bootcss.com/font-awesome/5.4.1/css/all.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Ubuntu:400,600|Source+Code+Pro">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/tomorrow-night-eighties.css">


    
    
<style>body>.footer,body>.navbar,body>.section{opacity:0}</style>

    
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css">

    
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.css">

    
    
    
    
<link rel="stylesheet" href="/css/back-to-top.css">

    
    
    
    <script>
var _hmt = _hmt || [];
(function() {
    var hm = document.createElement("script");
    hm.src = "//hm.baidu.com/hm.js?684368b6943d7a5b6689dba5e7bf30ad";
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(hm, s);
})();
</script>
    
    
    
    <link rel="stylesheet" href="/css/progressbar.css">
<script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script>
    
    
    


<link rel="stylesheet" href="/css/style.css">
</head>
<body class="is-3-column">
    <nav class="navbar navbar-main">
    <div class="container">
        <div class="navbar-brand is-flex-center">
            <a class="navbar-item navbar-logo" href="/">
            
                <img src="/images/logo02.png" alt="Ebby&#39;s Notes" height="28">
            
            </a>
        </div>
        <div class="navbar-menu">
            
            <div class="navbar-start">
                
                <a class="navbar-item"
                href="/">主页</a>
                
                <a class="navbar-item"
                href="/archives">归档</a>
                
                <a class="navbar-item"
                href="/categories">分类</a>
                
                <a class="navbar-item"
                href="/tags">标签</a>
                
                <a class="navbar-item"
                href="/reading">读书</a>
                
                <a class="navbar-item"
                href="/resources">资源</a>
                
                <a class="navbar-item"
                href="/notebooks">📝</a>
                
                <a class="navbar-item"
                href="/about">关于</a>
                
            </div>
            
            <div class="navbar-end">
                
                
                
                <a class="navbar-item search" title="搜索" href="javascript:;">
                    <i class="fas fa-search"></i>
                </a>
                
            </div>
        </div>
    </div>
</nav>
    
    <section class="section">
        <div class="container">
            <div class="columns">
                <div class="column is-8-tablet is-8-desktop is-6-widescreen has-order-2 column-main">
    
<div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                

                <time class="level-item has-text-grey" datetime="2018-04-21T15:12:04.000Z">2018-04-21</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/机器学习/">机器学习</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    11 分钟 读完 (大约 1695 个字)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2018/04/21/机器学习三要素-模型-策略与算法/">机器学习三要素：模型,策略与算法</a>
            
        </h1>
        <div class="content">
            <p><strong>摘要：</strong> 李航在《统计学习方法》中将统计学习方法的三要素——模型、策略、算法总结为机器学习方法的提纲挈领。这篇博文主要总结归纳《统计学习方法》中对于这三要素的阐述。<br><!-- excerpt --></p>
<p>@[toc]</p>
<p>最近在读李航的《统计学习方法》，作者从统计学习的方法来分析机器学习技术，分析很细致深刻，值得反思，未来将逐步总结相关内容，期待更多共鸣与思考。</p>
<h2 id="什么是统计机器学习"><a href="#什么是统计机器学习" class="headerlink" title="什么是统计机器学习"></a>什么是统计机器学习</h2><p><strong>统计学习</strong>又叫<strong>统计机器学习</strong>，是关于计算机基于数据构建概率统计模型并运用模型对数据进行预测与分析的一门学科。</p>
<p>统计学习的对象是具备一定统计规律的数据，同时对数据有一个强假设：数据是独立同分布产生的。学习的模型属于某个函数的集合，称为<strong>假设空间</strong>(hypothesis space)，应用某个<strong>评价准则</strong>(evaluation criterion) 从假设空间中选取一个最优的模型，使它对已知训练数据和未知测试数据在给定评价准则下有最优的预测结果，这个模型的选取过程由<strong>算法</strong>实现。这样统计学习的方法由模型的假设空间、模型选择的准则以及模型的学习算法组成，称为统计机器学习的三要素。</p>
<h3 id="概念定义"><a href="#概念定义" class="headerlink" title="概念定义"></a>概念定义</h3><ul>
<li><strong>输入空间</strong>： 输入变量$X={x_1, x_2, …, x_N}$ 构成的空间；</li>
<li><strong>输出空间</strong>：对于输入变量的真实输出$Y={y_1, y_2,…,y_N}$ 构成的空间；</li>
<li><strong>特征空间</strong>：每个输入变量都可以由一组特征向量表示，这些特征向量构成了特征空间；<ul>
<li>模型实际上都是定义在特征空间上的；</li>
</ul>
</li>
<li><strong>假设空间</strong>： 包含所有可能的映射关系集合 $F={ f|y=f_{\theta}(X), \theta \in R^n}$  <ul>
<li>输入到输出的映射的集合，表示为条件概率分布$\hat P(X|Y)$ 或决策函数 $Y = \hat f(X)$ </li>
</ul>
</li>
<li><strong>参数空间</strong>： 构成假设空间每个映射函数的参数所形成的空间；</li>
<li><strong>监督学习的联合概率分布</strong>：</li>
</ul>
<blockquote>
<p> 监督学习假设输入与输出的随机变量$X$ 和 $Y$ 遵循联合概率分布 $P(X,Y)$ , 机器学习的前提是假设该概率分布存在，但具体定义是未知的（如果知道的话也没必要通过机器学习来获取的了，直接可以通过条件函数来预测未知结果）。训练数据和测试数据被看作是依据联合概率分布$P(X,Y)$ 独立同分布产生的。这是机器学习数据具备一定统计规律的基本假设。</p>
</blockquote>
<h2 id="模型"><a href="#模型" class="headerlink" title="模型"></a>模型</h2><p>如下图所示，在机器学习中，模型描述的是一组从输入到输出的映射关系的函数表示。</p>
<p><img src="/qnsource/images/2018-04-21-机器学习三要素-模型-策略与算法/model.png" alt="model"></p>
<p>在监督学习中，模型就是从假设空间中所要学习条件概率分布$\hat P(X|Y)$ 或决策函数 $Y = \hat f(X)$ 。</p>
<h2 id="策略"><a href="#策略" class="headerlink" title="策略"></a>策略</h2><p>策略描述了学习的目标函数，通过什么样的准则使学习的方向最终逼近最终的优化目标从而能够从假设空间中选取最优的模型。一般采用损失函数或代价函数来对模型的好坏进行度量。损失函数是$f(X)$ 和 $Y$ 的非负实值函数，记作 $L(Y, f(X))$ 。</p>
<p>损失函数数值越小，模型越好，损失函数的期望为：</p>
<script type="math/tex; mode=display">
R_{exp} (f) = E_p [L(Y,f(x))] = \int_{x\times y} L(y,f(x))P(x,y)dxdy</script><p>这是理论上模型$f(X)$ 关于联合分布的平均意义下的损失，称为<strong>风险函数</strong>或<strong>期望损失</strong>。由于$P(X,Y)$ 未知，所以期望损失无法直接计算。因此引入另一个概念：<strong>经验风险（损失）</strong>：</p>
<script type="math/tex; mode=display">
R_{emp} (f) = \frac{1}{N} \sum_{i=1}^NL(y_i,f(x_i))</script><p><strong>经验风险</strong>是模型关于训练样本的平均损失。根据大数定理，当样本容量N趋于无穷时，经验风险趋于期望风险。所以可以用经验风险估计期望风险，但由于现实世界中训练样本数目有限，所以需要对经验风险进行一定的矫正(如正则化)。</p>
<p>当样本容量很小时，经验风险最小化学习会产生过拟合现象，于是引入修正方案：结构风险最小化（SRM）：</p>
<script type="math/tex; mode=display">
R_{emp} (f) = \frac{1}{N} \sum_{i=1}^NL(y_i,f(x_i)) + \lambda J(f)</script><p>结构风险是在经验风险基础上加上表示模型复杂度的正则化项（惩罚项）$J(f)$ ，它描述了模型的复杂度。</p>
<blockquote>
<p><strong>过拟合</strong>：如果在假设空间中存在“真”模型，过拟合可以理解为所选模型复杂度由于比真模型更高，包含了更多的参数，对训练数据预测比”真”模型更好，但对新数据的预测很差。（训练数据中掺杂着噪声，所以即使”真”模型也无法一定完全拟合训练数据）。</p>
</blockquote>
<p>过拟合问题告诉我们，对模型好坏的评价不是完全靠在训练数据上的经验风险或结构风险来决定的，而是学习方法的泛化能力，这是期望损失本身要表达的意思。如果学到一个模型$\hat f$,那么用这个模型对未知数据预测的误差即为<strong>泛化误差</strong>：</p>
<script type="math/tex; mode=display">
R_{exp} (\hat f) = E_p [L(Y,\hat f(x))] = \int_{x\times y} L(y,\hat f(x))P(x,y)dxdy</script><p>泛化误差具备如下性质：</p>
<ol>
<li>它是样本容量的函数，随着样本容量增加，泛化误差上界趋于0；</li>
<li>它是假设空间容量的函数，假设空间越大，模型就越难学，泛化误差上界就越大。</li>
</ol>
<h2 id="算法"><a href="#算法" class="headerlink" title="算法"></a>算法</h2><p>算法将机器学习问题转换为最优化问题进行求解。设计目标是寻找全局最优解并使得求解过程足够高效。</p>
<hr>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ol>
<li>​《统计学习方法》</li>
</ol>

        </div>
        
        
        
    </div>
</div>








    
<div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                

                <time class="level-item has-text-grey" datetime="2018-04-20T01:09:14.000Z">2018-04-20</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/深度学习/">深度学习</a>&nbsp;/&nbsp;<a class="has-link-grey -link" href="/categories/深度学习/基础知识/">基础知识</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    10 分钟 读完 (大约 1486 个字)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2018/04/20/Backpropagation-in-Neural-Network/">Backpropagation in Neural Network</a>
            
        </h1>
        <div class="content">
            <p><strong>摘要：</strong> 反向传播毋庸置疑是整个神经网络的精髓，正是由于它的提出标志着深度神经网络的训练在有限算力基础上成为可能，但反向传播本身的原理同样值得品读和思考。<br><!-- excerpt --></p>
<p>本文主要总结神经网络中反向传播算法的推导流程并挖掘一些深层次的原理。反向传播算法在1970年就已经提出，直到1986年 <a href="http://en.wikipedia.org/wiki/David_Rumelhart">David Rumelhart</a>, <a href="http://www.cs.toronto.edu/~hinton/">Geoffrey Hinton</a>, and <a href="http://en.wikipedia.org/wiki/Ronald_J._Williams">Ronald Williams</a>在一篇<a href="https://www.nature.com/articles/323533a0">论文</a>中对其实现的分析才得以普及。</p>
<h2 id="1-表达式的定义"><a href="#1-表达式的定义" class="headerlink" title="1. 表达式的定义"></a>1. 表达式的定义</h2><ul>
<li>$w_{jk}^l$ 代表第l−1层第k个神经元，与第l层第j个神经元之间的权重（注意j与k的顺序）；</li>
<li>$b_j^l$  代表第l层中第j个神经元的偏移；</li>
<li>$a_j^l$  代表第l层中第j个神经元的激活函数值；</li>
<li>$L$  代表神经网络的总层数；</li>
<li>$J(W,b)$ 简写为$J$ 代表神经网络的代价函数；</li>
</ul>
<p>假设我们有$m$ 个训练样本${(x^{(1)},y^{(1)}),…, (x^{(m)},y^{(m)})}$ ,对于每个训练样本$(x,y)$ 定义代价函数为：</p>
<script type="math/tex; mode=display">
J(W,b;x,y) = \frac{1}{2} ||h_{W,b}(x) - y||^2</script><p>对于$m$个训练样本，总的代价函数为：</p>
<script type="math/tex; mode=display">
J(W,b) = [\frac{1}{m} \sum_{i=1}^m J(W,b;x^{(i)},y^{(i)}] + \frac{\lambda}{2} \sum_{l=1}^{n_l -1}\sum_{i=1}^{s_l}\sum_{j=1}^{s_{l+1}}(W_{ji}^{(l)})^2</script><p>根据神经网络层与层之间关系的定义，我们有如下表达式（<strong>向量形式</strong>）：</p>
<script type="math/tex; mode=display">
z^l = w^l a^{l-1} + b^l,   l=2,3,...,L</script><script type="math/tex; mode=display">
a^l = \sigma (z^l), l=2,3,...,L</script><script type="math/tex; mode=display">
a^1=z^1=X</script><p>其中</p>
<script type="math/tex; mode=display">
z_j^l = \sum_k w_{jk}^l a_k^{l-1} + b_j^l</script><p>利用梯度下降法进行目标优化使用的主要梯度更新公式：</p>
<script type="math/tex; mode=display">
w^l := w^l - \alpha \frac{\partial J}{\partial w^l}</script><script type="math/tex; mode=display">
b^l := b^l - \alpha \frac{\partial J}{\partial b^l}</script><p>因为神经网络的复杂性导致$\frac{\partial J}{\partial w^l}$ 无法直接计算或者计算代价太大（每个权重的计算都需要进行一次前向传播），反向传播的目的在于提供一种更加高效的手段，完成上述梯度的更新操作。</p>
<h2 id="2-反向传播的直观理解"><a href="#2-反向传播的直观理解" class="headerlink" title="2. 反向传播的直观理解"></a>2. 反向传播的直观理解</h2><p>反向传播是用于理解改变网络中的任一权重如何影响网络代价函数的过程。假设神经网络中某个权重$w_{jk}^l$ </p>
<p>产生了轻微的扰动误差 $\Delta w_{jk}^l$ ,扰动误差导致该神经元的输出产生误差 $\Delta z_j^l$ ,这个扰动将使对应的神经元$a_j^l$ 产生一个扰动误差 $\Delta a_j^l$ ，该误差将逐步向后层传递，直至达到输出层，并最终影响代价函数，生成一个代价误差 $\Delta J = \frac{\partial J}{\partial z_j^l}\Delta z_j^l$ 。我们可以给出如下式子来为通过误差近似计算梯度提供方向：</p>
<script type="math/tex; mode=display">
\Delta J \approx \frac{\partial J}{\partial a^L_m} 
  \frac{\partial a^L_m}{\partial a^{L-1}_n}
  \frac{\partial a^{L-1}_n}{\partial a^{L-2}_p} \ldots
  \frac{\partial a^{l+1}_q}{\partial a^l_j}
  \frac{\partial a^l_j}{\partial w^l_{jk}} \Delta w^l_{jk}</script><script type="math/tex; mode=display">
 \frac{\Delta J}{\Delta z_{j}^l}=\delta_j^l=\frac{\partial J}{\partial z_j^l}</script><p>其中，$\delta_j^l$  可以定义为$l$层第$j$个神经元上的误差。</p>
<p>我们先从计算最后一层误差$\delta_j^L$ 开始，</p>
<script type="math/tex; mode=display">
\delta^L_j = \frac{\partial J}{\partial a^L_j} \sigma'(z^L_j)</script><p><strong>公式E1</strong>（向量形式）：</p>
<script type="math/tex; mode=display">
\delta^L = \nabla_a J \odot \sigma'(z^L)</script><p><strong>证明</strong>：</p>
<script type="math/tex; mode=display">
\delta^L_j =\frac{\partial J}{\partial z_j^L}=\frac{\partial J}{\partial a_j^L}.\frac{\partial a_j^L}{\partial z_j^L}= \frac{\partial J}{\partial a^L_j} \sigma'(z^L_j).</script><p>现在把问题转变为如何利用反向传播由后往前逐步计算误差$\delta_j^l$ ，为计算不同层之间误差之间的关系，利用链式法则给出如下推理过程：</p>
<script type="math/tex; mode=display">
\delta^l =\frac{\partial J}{\partial z^l} = \frac{\partial J}{\partial z^{l+1}}.\frac{\partial z^{l+1}}{\partial z^l}=\delta^{l+1}.(\frac{\partial z^{l+1}}{\partial a^l}.\frac{\partial a^l}{\partial z^l})= ((w^{l+1})^T\delta^{l+1})\odot \sigma'(z^l)</script><p>即<strong>公式E2</strong>：</p>
<script type="math/tex; mode=display">
\delta^l = ((w^{l+1})^T \delta^{l+1}) \odot \sigma'(z^l)</script><p>有了以上误差的反向传播计算方法，我们可以利用计算的误差计算权重的梯度如下：</p>
<p><strong>公式E3</strong>：</p>
<script type="math/tex; mode=display">
\frac{\partial J}{\partial b^l_j} =\delta^l_j</script><p><strong>公式E4</strong>：</p>
<script type="math/tex; mode=display">
\frac{\partial J}{\partial w^l_{jk}} = a^{l-1}_k \delta^l_j</script><p>其中公式（4）也可以写成：</p>
<script type="math/tex; mode=display">
\frac{\partial
    J}{\partial w} = a_{\rm in} \delta_{\rm out}</script><p><strong>证明：</strong></p>
<script type="math/tex; mode=display">
\frac{\partial J}{\partial b^l_j} =\frac{\partial J}{\partial z^l_j}.\frac{\partial z^l_j}{\partial b^l_j}=  
  \delta^l_j</script><script type="math/tex; mode=display">
\frac{\partial J}{\partial w^l_{jk}} = \frac{\partial J}{\partial z^l_{jk}}.\frac{\partial z_{jk}^l}{\partial w^l_{jk}}=a^{l-1}_k \delta^l_j</script><h3 id="另一种求解方式"><a href="#另一种求解方式" class="headerlink" title="另一种求解方式"></a>另一种求解方式</h3><script type="math/tex; mode=display">
\dfrac{\partial J}{\partial w_{ij}^l} =\frac{\partial J}{\partial a_j^l}.\frac{\partial a_j^l}{\partial z_j^l}.\frac{\partial z_j^l}{w_{ij}^l}=\frac{\partial J}{\partial a_j^l}.\sigma^{'}(z_j^l)a_i^{l-1}</script><p>如何我们令$\delta_j^l =\frac{\partial J}{\partial a_j^l}$ 也可以按照上述过程类似的方法推到出相关公式</p>
<h2 id="3-反向传播算法的计算流程"><a href="#3-反向传播算法的计算流程" class="headerlink" title="3. 反向传播算法的计算流程"></a>3. 反向传播算法的计算流程</h2><ol>
<li>输入$x$，令$a^1=z^1=x$;</li>
<li>前向传播： 对于每层$l=2,3,…,L$计算$z^l$和$a^l$；</li>
<li>根据公式<strong>E1</strong>计算输出误差：$\delta^L = \nabla_a J \odot \sigma’(z^L)$ ;</li>
<li>反向传播：对于每层$l=L-1,L-2,…,2$ 利用公式<strong>E2</strong>计算误差：$\delta^l = ((w^{l+1})^T \delta^{l+1}) \odot \sigma’(z^l)$ ；</li>
<li>利用公式<strong>E3</strong>和<strong>E4</strong>计算参数梯度；</li>
<li>更新权重</li>
</ol>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ol>
<li><a href="http://cs231n.github.io/optimization-2/">CS231n讲义：Backpropagation, Intuitions</a></li>
<li><a href="http://neuralnetworksanddeeplearning.com/chap2.html">Neural Networks and Deep Learning</a></li>
<li><a href="http://deeplearning.stanford.edu/wiki/index.php/Backpropagation_Algorithm">Machine Learning Cousera Course</a></li>
</ol>

        </div>
        
        
        
    </div>
</div>








    
<div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                

                <time class="level-item has-text-grey" datetime="2018-04-14T13:16:41.000Z">2018-04-14</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/动手实践营/">动手实践营</a>&nbsp;/&nbsp;<a class="has-link-grey -link" href="/categories/动手实践营/机器视觉/">机器视觉</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    39 分钟 读完 (大约 5793 个字)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2018/04/14/TensorFlow-Object-Detection-API/">使用TensorFlow Object Detection API识别仪表表盘</a>
            
        </h1>
        <div class="content">
            <p>前面用到了Tensorflow的物体识别API做了一个检测仪表表盘的实践，记录实践过程中的技巧。<br><!-- excerpt --></p>
<blockquote>
<p>Update: 2019/04/16，使用新版Tensorflow接口</p>
</blockquote>
<h2 id="1-概述"><a href="#1-概述" class="headerlink" title="1. 概述"></a>1. 概述</h2><p>本文主要介绍如何使用Tensorflow 物体识别API应用自己业务场景进行物体识别。将结合从事的一些实际经验，分享一个仪表表盘识别的案例。我们在一个利用机器视觉技术自动识别仪表表读数的项目中，需要首先识别各种不同类型表盘的显示屏位置。本案例分析将针对面板识别中采用的关键技术进行分析，详细阐述如何利用物体识别技术和已训练好的模型快速实现使用用户数据设计一个面向特定物体识别的深度神经网络。</p>
<p><strong>目标：</strong> 从给定的水表图片中将关键的数字面板给扣取出来。</p>
<p>如下图所示，如果采用通用OCR技术对水表图片面板进行检测，将同时提取很多特征项，对实际的检测值造成比较大的干扰。</p>
<p><img src="/qnsource/images/2018-04-14-TensorFlow-Object-Detection-API/ocr-demo.PNG" alt="ocr-demo"></p>
<h3 id="1-1-模型及算法选型"><a href="#1-1-模型及算法选型" class="headerlink" title="1.1 模型及算法选型"></a>1.1 模型及算法选型</h3><p>在方案设计初期我们分别使用公有云服务、现有的成熟OCR软件、开源的OCR方案对目标对象进行了初步识别及分析。通过实测，现有方案无法满足我们的任务需求。为此希望能够利用深度学习在物体识别领域的成熟方案，构建一个面向水表图片面板识别的神经网络模型。</p>
<ul>
<li><p><strong>计算框架：</strong> Tensorflow (v1.7)</p>
</li>
<li><p><strong>使用接口：</strong> <a href="https://github.com/tensorflow/models/tree/master/research/object_detection">Tensorflow Object Detection API</a><sup><a href="#fn_1" id="reffn_1">1</a></sup></p>
</li>
<li><p><strong>算法模型：</strong> 根据预训练采用的数据集不同，可用的模型列表如下：</p>
<ul>
<li><a href="http://mscoco.org/">COCO dataset</a></li>
</ul>
</li>
</ul>
<div class="table-container">
<table>
<thead>
<tr>
<th>Model name</th>
<th>Speed (ms)</th>
<th>COCO mAP<sup><a href="#fn_2" id="reffn_2">2</a></sup></th>
<th>Outputs</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="http://download.tensorflow.org/models/object_detection/ssd_mobilenet_v1_coco_2017_11_17.tar.gz">ssd_mobilenet_v1_coco</a></td>
<td>30</td>
<td>21</td>
<td>Boxes</td>
</tr>
<tr>
<td><a href="http://download.tensorflow.org/models/object_detection/ssd_inception_v2_coco_2017_11_17.tar.gz">ssd_inception_v2_coco</a></td>
<td>42</td>
<td>24</td>
<td>Boxes</td>
</tr>
<tr>
<td><a href="http://download.tensorflow.org/models/object_detection/faster_rcnn_inception_v2_coco_2017_11_08.tar.gz">faster_rcnn_inception_v2_coco</a></td>
<td>58</td>
<td>28</td>
<td>Boxes</td>
</tr>
<tr>
<td><a href="http://download.tensorflow.org/models/object_detection/faster_rcnn_resnet50_coco_2017_11_08.tar.gz">faster_rcnn_resnet50_coco</a></td>
<td>89</td>
<td>30</td>
<td>Boxes</td>
</tr>
<tr>
<td><a href="http://download.tensorflow.org/models/object_detection/faster_rcnn_resnet50_lowproposals_coco_2017_11_08.tar.gz">faster_rcnn_resnet50_lowproposals_coco</a></td>
<td>64</td>
<td></td>
<td>Boxes</td>
</tr>
<tr>
<td><a href="http://download.tensorflow.org/models/object_detection/rfcn_resnet101_coco_2017_11_08.tar.gz">rfcn_resnet101_coco</a></td>
<td>92</td>
<td>30</td>
<td>Boxes</td>
</tr>
<tr>
<td><a href="http://download.tensorflow.org/models/object_detection/faster_rcnn_resnet101_coco_2017_11_08.tar.gz">faster_rcnn_resnet101_coco</a></td>
<td>106</td>
<td>32</td>
<td>Boxes</td>
</tr>
<tr>
<td><a href="http://download.tensorflow.org/models/object_detection/faster_rcnn_resnet101_lowproposals_coco_2017_11_08.tar.gz">faster_rcnn_resnet101_lowproposals_coco</a></td>
<td>82</td>
<td></td>
<td>Boxes</td>
</tr>
<tr>
<td><a href="http://download.tensorflow.org/models/object_detection/faster_rcnn_inception_resnet_v2_atrous_coco_2017_11_08.tar.gz">faster_rcnn_inception_resnet_v2_atrous_coco</a></td>
<td>620</td>
<td>37</td>
<td>Boxes</td>
</tr>
<tr>
<td><a href="http://download.tensorflow.org/models/object_detection/faster_rcnn_inception_resnet_v2_atrous_lowproposals_coco_2017_11_08.tar.gz">faster_rcnn_inception_resnet_v2_atrous_lowproposals_coco</a></td>
<td>241</td>
<td></td>
<td>Boxes</td>
</tr>
<tr>
<td><a href="http://download.tensorflow.org/models/object_detection/faster_rcnn_nas_coco_2017_11_08.tar.gz">faster_rcnn_nas</a></td>
<td>1833</td>
<td>43</td>
<td>Boxes</td>
</tr>
<tr>
<td><a href="http://download.tensorflow.org/models/object_detection/faster_rcnn_nas_lowproposals_coco_2017_11_08.tar.gz">faster_rcnn_nas_lowproposals_coco</a></td>
<td>540</td>
<td></td>
<td>Boxes</td>
</tr>
</tbody>
</table>
</div>
<ul>
<li><a href="http://www.cvlibs.net/datasets/kitti/">Kitti dataset</a></li>
</ul>
<div class="table-container">
<table>
<thead>
<tr>
<th>Model name</th>
<th>Speed (ms)</th>
<th>Pascal mAP@0.5 (ms)</th>
<th>Outputs</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="http://download.tensorflow.org/models/object_detection/faster_rcnn_resnet101_kitti_2017_11_08.tar.gz">faster_rcnn_resnet101_kitti</a></td>
<td>79</td>
<td>87</td>
<td>Boxes</td>
</tr>
</tbody>
</table>
</div>
<ul>
<li><a href="https://github.com/openimages/dataset">Open Images dataset</a></li>
</ul>
<div class="table-container">
<table>
<thead>
<tr>
<th>Model name</th>
<th>Speed (ms)</th>
<th>Open Images mAP@0.5<sup><a href="#fn_2" id="reffn_2">2</a></sup></th>
<th>Outputs</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="http://download.tensorflow.org/models/object_detection/faster_rcnn_inception_resnet_v2_atrous_oid_2017_11_08.tar.gz">faster_rcnn_inception_resnet_v2_atrous_oid</a></td>
<td>727</td>
<td>37</td>
<td>Boxes</td>
</tr>
<tr>
<td><a href="http://download.tensorflow.org/models/object_detection/faster_rcnn_inception_resnet_v2_atrous_lowproposals_oid_2017_11_08.tar.gz">faster_rcnn_inception_resnet_v2_atrous_lowproposals_oid</a></td>
<td>347</td>
<td></td>
<td>Boxes</td>
</tr>
</tbody>
</table>
</div>
<p>  几种模型主要在精度和速度方面进行了取舍，如果需要一个高精度的模型可以选择faster R-CNN，如果希望速度快比如实时检测，则可以选择SSD模型。鉴于本方案中设计检测目标特征将为简单，可采用最轻量级的MobileSSD进行优化。</p>
<h2 id="2-实现流程"><a href="#2-实现流程" class="headerlink" title="2. 实现流程"></a>2. 实现流程</h2><h3 id="2-1-数据准备"><a href="#2-1-数据准备" class="headerlink" title="2.1 数据准备"></a>2.1 数据准备</h3><p>数据准备的环节是除了训练过程之外最为耗时的环节，准备数据的质量和数量将直接决定了训练模型的好坏。图片数据最好在光线、角度、清晰度等方面能最大化的泛化实际的业务场景。由于在这个案例中我们只需要输出一个分类对象，而且输入对象被限定在水表图片上，所以整体涉及需要提取的特征参数空间不是很大，少量经过处理好的明显可供辨识的水表图片即可。目前可用水表图片攻击229张，我们采用80%用于训练，20%用于测试的方式进行划分。</p>
<blockquote>
<p>如果分类较多，数据有限，可以选择从互联网上下载或者在开源数据集中获得所需的数据。</p>
<p>另外需要注意图片的大小，图片太大一方面影响训练过程的处理时间，另外大量图片载入内存将很容导致内存溢出，所以如果图像特征粒度不是特别精细可以采用低分辨率图片进行分析。</p>
</blockquote>
<h4 id="数据标记"><a href="#数据标记" class="headerlink" title="数据标记"></a>数据标记</h4><p>对于物体识别而言，数据标记过程是一个相对复杂的过程，目前除了人工标记没有太好的自动或半监督手段，幸好针对图片的标记已经有了几款很好用的工具：</p>
<ul>
<li><p><a href="https://github.com/tzutalin/labelImg">LabelImg</a></p>
<ul>
<li>这是一个可以直接在图片上做注释框自动生成标记信息的软件，注释信息将被保存为PASCAL VOC 格式的XML文件（<a href="http://www.image-net.org/">ImageNet</a>的文件格式）</li>
</ul>
<p><img src="/qnsource/images/2018-04-14-TensorFlow-Object-Detection-API/labelImage.jpg" alt="labelImage"></p>
</li>
<li><p><a href="https://github.com/christopher5106/FastAnnotationTool">FIAT (Fast Image Data Annotation Tool)</a> </p>
<ul>
<li><p>该工具生成csv格式的注释文件</p>
<p><a href="https://camo.githubusercontent.com/c77ea08c2a142680f237371c1a1e5743b877842c/687474703a2f2f6368726973746f70686572353130362e6769746875622e696f2f696d672f616e6e6f7461746f725f65726173652e706e67"><img src="https://camo.githubusercontent.com/c77ea08c2a142680f237371c1a1e5743b877842c/687474703a2f2f6368726973746f70686572353130362e6769746875622e696f2f696d672f616e6e6f7461746f725f65726173652e706e67" alt="data annotation"></a></p>
</li>
</ul>
</li>
<li><p><a href="http://imagemagick.org/#">ImageMagick</a></p>
<ul>
<li>图片预处理工具</li>
<li>Use ImageMagick<a href="http://tarr.uspto.gov/servlet/tarr?regser=serial&amp;entry=78333969">®</a> to create, edit, compose, or convert bitmap images.  It can read and write images in a variety of <a href="http://imagemagick.org/script/formats.php">formats</a> (over 200) including PNG, JPEG, GIF, HEIC, TIFF, <a href="http://imagemagick.org/script/motion-picture.php">DPX</a>, <a href="http://imagemagick.org/script/high-dynamic-range.php">EXR</a>, WebP, Postscript, PDF, and SVG.  Use ImageMagick to resize, flip, mirror, rotate, distort, shear and transform images, adjust image colors, apply various special effects, or draw text, lines, polygons, ellipses and Bézier curves.</li>
</ul>
</li>
</ul>
<p>在本方案中我们使用工具LabelImage将229张水表图片进行了标注，同时生成了PASCAL格式的XML文件，名字为<code>000001.jpg</code>的图片注释格式如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">annotation</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">folder</span>&gt;</span>imgs<span class="tag">&lt;/<span class="name">folder</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filename</span>&gt;</span>000001.jpg<span class="tag">&lt;/<span class="name">filename</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">source</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">database</span>&gt;</span>VOC<span class="tag">&lt;/<span class="name">database</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">annotation</span>&gt;</span>PASCAL VOC<span class="tag">&lt;/<span class="name">annotation</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">source</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">size</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">width</span>&gt;</span>2448<span class="tag">&lt;/<span class="name">width</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">height</span>&gt;</span>3264<span class="tag">&lt;/<span class="name">height</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">depth</span>&gt;</span>3<span class="tag">&lt;/<span class="name">depth</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">size</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">segmented</span>&gt;</span>0<span class="tag">&lt;/<span class="name">segmented</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">object</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">name</span>&gt;</span>panel<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">pose</span>&gt;</span>Frontal<span class="tag">&lt;/<span class="name">pose</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">truncated</span>&gt;</span>0<span class="tag">&lt;/<span class="name">truncated</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">difficult</span>&gt;</span>0<span class="tag">&lt;/<span class="name">difficult</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">bndbox</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">xmin</span>&gt;</span>739<span class="tag">&lt;/<span class="name">xmin</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">ymin</span>&gt;</span>430<span class="tag">&lt;/<span class="name">ymin</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">xmax</span>&gt;</span>1475<span class="tag">&lt;/<span class="name">xmax</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">ymax</span>&gt;</span>796<span class="tag">&lt;/<span class="name">ymax</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">bndbox</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">object</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">annotation</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>我们在根目录新建一个<code>annotations</code>的文件夹存储229张图片的XML描述文件，同时根目录<code>images</code>文件夹用于存储所有的训练数据和测试数据。</p>
<h4 id="数据描述格式"><a href="#数据描述格式" class="headerlink" title="数据描述格式"></a>数据描述格式</h4><ul>
<li>在TensorFlow 物体检测API中使用 <a href="https://www.tensorflow.org/api_guides/python/python_io#tfrecords_format_details">TFRecord file format</a>格式对图像标记信息进行描述，所以我们无论采取下面的那种标记方式，最终需要生成TFRcord格式的文件格式。</li>
<li><strong>TFRecord</strong>格式要去如下：</li>
</ul>
<blockquote>
<p>For every example in your dataset, you should have the following information:</p>
<ol>
<li>An RGB image for the dataset encoded as jpeg or png.</li>
<li>A list of bounding boxes for the image. Each bounding box should contain:<ol>
<li>A bounding box coordinates (with origin in top left corner) defined by 4floating point numbers [ymin, xmin, ymax, xmax]. Note that we store the<em>normalized</em> coordinates (x / width, y / height) in the TFRecord dataset.</li>
<li>The class of the object in the bounding box.</li>
</ol>
</li>
</ol>
</blockquote>
<ul>
<li><p>TensorFlow针对主流的物体识别类数据集格式提供了<a href="https://github.com/tensorflow/models/tree/master/research/object_detection/dataset_tools">转换工具</a>，包括 <a href="http://host.robots.ox.ac.uk/pascal/VOC/">PASCAL VOC dataset</a> ， <a href="http://www.robots.ox.ac.uk/~vgg/data/pets/">Oxford Pet dataset</a>等；</p>
<ul>
<li>PASCAL VOC </li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># From tensorflow/models/research/</span></span><br><span class="line">wget http://host.robots.ox.ac.uk/pascal/VOC/voc2012/VOCtrainval_11-May-2012.tar</span><br><span class="line">tar -xvf VOCtrainval_11-May-2012.tar</span><br><span class="line">python object_detection/dataset_tools/create_pascal_tf_record.py \</span><br><span class="line">    --label_map_path=object_detection/data/pascal_label_map.pbtxt \</span><br><span class="line">    --data_dir=VOCdevkit --year=VOC2012 --<span class="built_in">set</span>=train \</span><br><span class="line">    --output_path=pascal_train.record</span><br><span class="line">python object_detection/dataset_tools/create_pascal_tf_record.py \</span><br><span class="line">    --label_map_path=object_detection/data/pascal_label_map.pbtxt \</span><br><span class="line">    --data_dir=VOCdevkit --year=VOC2012 --<span class="built_in">set</span>=val \</span><br><span class="line">    --output_path=pascal_val.record</span><br></pre></td></tr></table></figure>
<ul>
<li>Oxford-IIIT Pet</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># From tensorflow/models/research/</span></span><br><span class="line">wget http://www.robots.ox.ac.uk/~vgg/data/pets/data/images.tar.gz</span><br><span class="line">wget http://www.robots.ox.ac.uk/~vgg/data/pets/data/annotations.tar.gz</span><br><span class="line">tar -xvf annotations.tar.gz</span><br><span class="line">tar -xvf images.tar.gz</span><br><span class="line">python object_detection/dataset_tools/create_pet_tf_record.py \</span><br><span class="line">    --label_map_path=object_detection/data/pet_label_map.pbtxt \</span><br><span class="line">    --data_dir=`<span class="built_in">pwd</span>` \</span><br><span class="line">    --output_dir=`<span class="built_in">pwd</span>`</span><br></pre></td></tr></table></figure>
</li>
<li><p>如果你使用了自己的格式，可以参考<a href="https://github.com/tensorflow/models/blob/master/research/object_detection/g3doc/using_your_own_dataset.md">TensorFlow官方文档</a>完成格式转换；</p>
</li>
</ul>
<p>在本方案中我们采用自己处理的方式来进行格式转换，使用文件<a href="https://github.com/datitran/raccoon_dataset/blob/master/xml_to_csv.py"><code>xml_to_csv.py</code></a>将所有图片的PASCAL格式文件转化为一个csv文件，然后进一步的利用TensorFLow工具<code>generate_tfrecord.py</code>生成TFRecord格式文件：</p>
<ol>
<li><p>执行<code>python xml_to_csv.py</code>,该文件将在根目录的<code>annotations</code>的文件夹下所有的<code>*xml</code>文件，并生成<code>screen_labels.csv</code>文件；</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> glob</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> xml.etree.ElementTree <span class="keyword">as</span> ET</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">xml_to_csv</span><span class="params">(path)</span>:</span></span><br><span class="line">    xml_list = []</span><br><span class="line">    <span class="keyword">for</span> xml_file <span class="keyword">in</span> glob.glob(path + <span class="string">'/*.xml'</span>):</span><br><span class="line">        tree = ET.parse(xml_file)</span><br><span class="line">        root = tree.getroot()</span><br><span class="line">        <span class="keyword">for</span> member <span class="keyword">in</span> root.findall(<span class="string">'object'</span>):</span><br><span class="line">            filename = root.find(<span class="string">'filename'</span>).text</span><br><span class="line">            value = (root.find(<span class="string">'filename'</span>).text,</span><br><span class="line">                     int(root.find(<span class="string">'size'</span>)[<span class="number">0</span>].text),</span><br><span class="line">                     int(root.find(<span class="string">'size'</span>)[<span class="number">1</span>].text),</span><br><span class="line">                     member[<span class="number">0</span>].text,</span><br><span class="line">                     int(member[<span class="number">4</span>][<span class="number">0</span>].text),</span><br><span class="line">                     int(member[<span class="number">4</span>][<span class="number">1</span>].text),</span><br><span class="line">                     int(member[<span class="number">4</span>][<span class="number">2</span>].text),</span><br><span class="line">                     int(member[<span class="number">4</span>][<span class="number">3</span>].text)</span><br><span class="line">                     )</span><br><span class="line">            xml_list.append(value)</span><br><span class="line">    column_name = [<span class="string">'filename'</span>, <span class="string">'width'</span>, <span class="string">'height'</span>, <span class="string">'class'</span>, <span class="string">'xmin'</span>, <span class="string">'ymin'</span>, <span class="string">'xmax'</span>, <span class="string">'ymax'</span>]</span><br><span class="line">    xml_df = pd.DataFrame(xml_list, columns=column_name)</span><br><span class="line">    <span class="keyword">return</span> xml_df</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    image_path = os.path.join(os.getcwd(), <span class="string">'Annotations'</span>) <span class="comment"># Need Changes</span></span><br><span class="line">    xml_df = xml_to_csv(image_path)</span><br><span class="line">    xml_df.to_csv(<span class="string">'screen_labels.csv'</span>, index=<span class="keyword">None</span>) <span class="comment"># Need Changes</span></span><br><span class="line">    print(<span class="string">'Successfully converted xml to csv.'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">main()</span><br></pre></td></tr></table></figure>
</li>
</ol>
<ol>
<li><p>使用如下代码随机生成训练数据和测试数据：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line">np.random.seed(<span class="number">1</span>)</span><br><span class="line">full_labels = pd.read_csv(<span class="string">'screen_labels.csv'</span>)</span><br><span class="line">gb = full_labels.groupby(<span class="string">'filename'</span>)</span><br><span class="line">grouped_list = [gb.get_group(x) <span class="keyword">for</span> x <span class="keyword">in</span> gb.groups]</span><br><span class="line">train_index = np.random.choice(len(grouped_list), size=<span class="number">180</span>, replace=<span class="keyword">False</span>)</span><br><span class="line">test_index = np.setdiff1d(list(range(<span class="number">229</span>)), train_index)</span><br><span class="line">train = pd.concat([grouped_list[i] <span class="keyword">for</span> i <span class="keyword">in</span> train_index])</span><br><span class="line">test = pd.concat([grouped_list[i] <span class="keyword">for</span> i <span class="keyword">in</span> test_index])</span><br><span class="line">train.to_csv(<span class="string">'train_labels.csv'</span>, index=<span class="keyword">None</span>)</span><br><span class="line">test.to_csv(<span class="string">'test_labels.csv'</span>, index=<span class="keyword">None</span>)</span><br></pre></td></tr></table></figure>
</li>
<li><p>分别执行脚本将训练数据和测试数据转换为TFRecord：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># From tensorflow/models/research/</span></span><br><span class="line">protoc object_detection/protos/*.proto --python_out=.</span><br><span class="line"><span class="comment"># Create train data:</span></span><br><span class="line">  python generate_tfrecord.py --csv_input=data/train_labels.csv  --output_path=train.record</span><br><span class="line"></span><br><span class="line">  <span class="comment"># Create test data:</span></span><br><span class="line">  python generate_tfrecord.py --csv_input=data/test_labels.csv  --output_path=test.record</span><br></pre></td></tr></table></figure>
</li>
<li><p>将train.record和test.record的文件存储至根目录的data文件夹下</p>
</li>
<li><p>至此数据准备基本结束，我们创建了如下目录结构</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">├── annotations</span><br><span class="line">│   ├── 000001.xml</span><br><span class="line">          ...</span><br><span class="line">│   └── 000229.xml</span><br><span class="line">├── data</span><br><span class="line">│   ├── screen_labels.csv</span><br><span class="line">│   ├── test_labels.csv</span><br><span class="line">│   ├── test.record</span><br><span class="line">│   ├── train_labels.csv</span><br><span class="line">│   └── train.record</span><br><span class="line">├── generate_tfrecord.py</span><br><span class="line">├── images</span><br><span class="line">│   ├── 000001.jpg</span><br><span class="line">         ...</span><br><span class="line">│   └── 000229.jpg</span><br><span class="line">├── __init__.py</span><br><span class="line">├── README.md</span><br><span class="line">├── split labels.ipynb</span><br><span class="line">├── test_generate_tfrecord.py</span><br><span class="line">├── test_xml_to_csv.py</span><br><span class="line">└── xml_to_csv.py</span><br><span class="line">​</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="2-2-模型配置-迁移学习"><a href="#2-2-模型配置-迁移学习" class="headerlink" title="2.2 模型配置/迁移学习"></a>2.2 模型配置/迁移学习</h3><blockquote>
<p>完全从头训练一个用于物体检测的模型即使采用大量GPU资源至少也需要数周时间，为了加速模型初期迭代过程，我们选择了一个已经在COCO数据集针对其他多种物体识别场景预训练好的模型，通过重复使用该模型的多数参数来快速生成我们的模型。更多技术内容可以参照迁移学习的技术实现。</p>
</blockquote>
<p>由于没有足够的资源从头训练一个模型，我们将采用迁移学习技术，利用一个已经训练好的模型进行迁移学习及训练。</p>
<p>从测试角度考虑，本测试方案选择了体积最小，速度最快的用于嵌入式设备的SSD模型：<a href="http://download.tensorflow.org/models/object_detection/ssd_mobilenet_v1_coco_2017_11_17.tar.gz">ssd_mobilenet_v1_coco</a></p>
<p>下载模型包，可以得到如下文件：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">├── object-detection.pbtxt	</span><br><span class="line">├── ssd_mobilenet_v1_pets.config</span><br><span class="line">├── checkpoint</span><br><span class="line">├── frozen_inference_graph.pb</span><br><span class="line">├── model.ckpt.data-00000-of-00001</span><br><span class="line">├── model.ckpt.index</span><br><span class="line">├── model.ckpt.meta</span><br><span class="line">└── saved_model</span><br><span class="line">    ├── saved_model.pb</span><br><span class="line">    └── variables</span><br></pre></td></tr></table></figure>
<blockquote>
<ul>
<li>a graph proto (<code>graph.pbtxt</code>)</li>
<li>a checkpoint (<code>model.ckpt.data-00000-of-00001</code>, <code>model.ckpt.index</code>, <code>model.ckpt.meta</code>)</li>
<li>a frozen graph proto with weights baked into the graph as constants (<code>frozen_inference_graph.pb</code>) to be used for out of the box inference</li>
<li>a config file (<code>pipeline.config</code>) which was used to generate the graph. These directly correspond to a config file in the <a href="https://github.com/tensorflow/models/tree/master/research/object_detection/samples/configs">samples/configs</a>) directory but often with a modified score threshold. </li>
</ul>
</blockquote>
<p>我们下载并在根目录解压模型包ssd_mobilenet_v1_coco，同时创建一个training文件，存储如下文件：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">training/</span><br><span class="line">├── object-detection.pbtxt</span><br><span class="line">└── ssd_mobilenet_v1_pets.config</span><br></pre></td></tr></table></figure>
<h4 id="Label-Map"><a href="#Label-Map" class="headerlink" title="Label Map"></a>Label Map</h4><p>其中 <code>object-detection.pbtxt</code>是我们模型所有分类的标签，如下所示，如果有多个分类id从1开始递增，同时给每个标签一个唯一的名称(id为0预留给背景分类)</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">item &#123;</span><br><span class="line">  id: 1</span><br><span class="line">  name: <span class="string">'panel'</span></span><br><span class="line">&#125;</span><br><span class="line">item&#123;</span><br><span class="line">  id: 2</span><br><span class="line">  name: <span class="string">'其他分类'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="配置物体识别训练流程文件"><a href="#配置物体识别训练流程文件" class="headerlink" title="配置物体识别训练流程文件"></a>配置物体识别训练流程文件</h4><blockquote>
<p>更多内容参考：<a href="https://github.com/tensorflow/models/blob/master/research/object_detection/g3doc/configuring_jobs.md">https://github.com/tensorflow/models/blob/master/research/object_detection/g3doc/configuring_jobs.md</a></p>
</blockquote>
<p>Tensorflow Object Detection API 使用 protobuf 文件来配置训练和检测的流程。通过配置Training Pipleline的参数配置可以决定训练参数的选择，我们将尽量多的利用已经训练好的参数进行训练。</p>
<p>一个配置文件由5部分组成：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">model &#123;</span><br><span class="line">(... Add model config here...)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">train_config : &#123;</span><br><span class="line">(... Add train_config here...)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">train_input_reader: &#123;</span><br><span class="line">(... Add train_input configuration here...)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">eval_config: &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">eval_input_reader: &#123;</span><br><span class="line">(... Add eval_input configuration here...)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<ol>
<li>The <code>model</code> configuration. This defines what type of model will be trained (ie. meta-architecture, feature extractor).</li>
<li>The <code>train_config</code>, which decides what parameters should be used to train model parameters (ie. SGD parameters, input preprocessing and feature extractor initialization values).</li>
<li>The <code>eval_config</code>, which determines what set of metrics will be reported for evaluation (currently we only support the PASCAL VOC metrics).</li>
<li>The <code>train_input_config</code>, which defines what dataset the model should be trained on.</li>
<li>The <code>eval_input_config</code>, which defines what dataset the model will be evaluated on. Typically this should be different than the training input dataset.</li>
</ol>
</blockquote>
<p><code>ssd_mobilenet_v1_pets.config</code>为模型配置文件，我们在样例(详见：object_detection/samples/configs 文件夹)上进行如下修改：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">  ssd &#123;</span><br><span class="line">    num_classes: 1                 <span class="comment">#修改类别为实际类别值</span></span><br><span class="line">    box_coder &#123;</span><br><span class="line">      faster_rcnn_box_coder &#123;</span><br><span class="line">        y_scale: 10.0</span><br><span class="line">        x_scale: 10.0</span><br><span class="line">        height_scale: 5.0</span><br><span class="line">        width_scale: 5.0</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">fine_tune_checkpoint: <span class="string">"ssd_mobilenet_v1_coco_2017_11_17/model.ckpt"</span> <span class="comment">#指向模型文件中的checkpoint文件</span></span><br><span class="line">train_input_reader: &#123;                                               </span><br><span class="line">  tf_record_input_reader &#123;</span><br><span class="line">    input_path: <span class="string">"data/train.record"</span>              <span class="comment">#修改为上一个步骤生成的训练record路径</span></span><br><span class="line">  &#125;</span><br><span class="line">  label_map_path: <span class="string">"data/object-detection.pbtxt"</span>  <span class="comment">#修改为pbtxt文件路径，描述类别标签</span></span><br><span class="line">&#125;</span><br><span class="line">eval_input_reader: &#123;</span><br><span class="line">  tf_record_input_reader &#123;</span><br><span class="line">    input_path: <span class="string">"data/test.record"</span>           <span class="comment">#修改为上一个步骤生成的测试数据record路径</span></span><br><span class="line">  &#125;</span><br><span class="line">  label_map_path: <span class="string">"data/object-detection.pbtxt"</span> <span class="comment">#修改为pbtxt文件路径，描述类别标签</span></span><br><span class="line">  shuffle: <span class="literal">false</span></span><br><span class="line">  num_readers: 1</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p><code>train_config</code> provides two fields to specify pre-existing checkpoints: <code>fine_tune_checkpoint</code> and <code>from_detection_checkpoint</code>. <code>fine_tune_checkpoint</code> should provide a path to the pre-existing checkpoint (ie:”/usr/home/username/checkpoint/model.ckpt-#####”). <code>from_detection_checkpoint</code> is a boolean value. If false, it assumes the checkpoint was from an object classification checkpoint. Note that starting from a detection checkpoint will usually result in a faster training job than a classification checkpoint.</p>
<p>The list of provided checkpoints can be found <a href="https://github.com/tensorflow/models/blob/master/research/object_detection/g3doc/detection_model_zoo.md">here</a>.</p>
</blockquote>
<h3 id="2-3-训练"><a href="#2-3-训练" class="headerlink" title="2.3 训练"></a>2.3 训练</h3><h4 id="Tensorflow-Object-Detection-API-安装"><a href="#Tensorflow-Object-Detection-API-安装" class="headerlink" title="Tensorflow Object Detection API 安装"></a>Tensorflow Object Detection API 安装</h4><ol>
<li><p>从GitHub下载Tensorflow Object Detection API</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/tensorflow/models.git</span><br></pre></td></tr></table></figure>
</li>
<li><p>配置基本环境</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># For CPU</span></span><br><span class="line">pip install tensorflow</span><br><span class="line"><span class="comment"># For GPU</span></span><br><span class="line">pip install tensorflow-gpu</span><br><span class="line"></span><br><span class="line">sudo apt-get install protobuf-compiler python-pil python-lxml python-tk</span><br><span class="line">pip install --user Cython</span><br><span class="line">pip install --user contextlib2</span><br><span class="line">pip install --user jupyter</span><br><span class="line">pip install --user matplotlib</span><br></pre></td></tr></table></figure>
</li>
<li><p>COCO API installation</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/cocodataset/cocoapi.git</span><br><span class="line">cd cocoapi/PythonAPI</span><br><span class="line">make</span><br><span class="line">cp -r pycocotools &lt;path_to_tensorflow&gt;/models/research/</span><br></pre></td></tr></table></figure>
</li>
</ol>
<ol>
<li>Protobuf 编译</li>
</ol>
<p>Tensorflow通过Google的Protobufs来配置和训练模型，所以在开始使用之前需要对protobuf相关库进行编译。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># From tensorflow/models/research/</span></span><br><span class="line">protoc object_detection/protos/*.proto --python_out=.</span><br></pre></td></tr></table></figure>
<ol>
<li>Add Libraries to PYTHONPATH[<strong>重要</strong>]</li>
</ol>
<p>在路径 <code>tensorflow/models/research/</code> 下添加PYTHONPATH路径，实现全局引用</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># From tensorflow/models/research/</span></span><br><span class="line"><span class="built_in">export</span> PYTHONPATH=<span class="variable">$PYTHONPATH</span>:`<span class="built_in">pwd</span>`:`<span class="built_in">pwd</span>`/slim</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>Note:</strong> This command needs to run from every new terminal you start. If you wish to avoid running this manually, you can add it as a new line to the end of your ~/.bashrc file.</p>
</blockquote>
<ol>
<li><p>测试安装是否成功</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># From tensorflow/models/research/</span></span><br><span class="line">python object_detection/builders/model_builder_test.py</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h4 id="启动训练过程"><a href="#启动训练过程" class="headerlink" title="启动训练过程"></a>启动训练过程</h4><ol>
<li><p>将在数据准备和模型配置阶段的文件复制到tensorflow object_detect文件夹下<code>/models/research/object_detection</code>,包括data/文件夹，image/文件夹，training/文件夹，ssd_mobilenet_v1_coco_2017_11_17/原始模型文件夹</p>
</li>
<li><p>执行如下代码启动训练过程：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># From the tensorflow/models/research/ directory</span></span><br><span class="line">PIPELINE_CONFIG_PATH=&#123;path to pipeline config file&#125;</span><br><span class="line">MODEL_DIR=&#123;path to model directory&#125;</span><br><span class="line">NUM_TRAIN_STEPS=50000</span><br><span class="line">SAMPLE_1_OF_N_EVAL_EXAMPLES=1</span><br><span class="line">python object_detection/model_main.py \</span><br><span class="line">    --pipeline_config_path=<span class="variable">$&#123;PIPELINE_CONFIG_PATH&#125;</span> \</span><br><span class="line">    --model_dir=<span class="variable">$&#123;MODEL_DIR&#125;</span> \</span><br><span class="line">    --num_train_steps=<span class="variable">$&#123;NUM_TRAIN_STEPS&#125;</span> \</span><br><span class="line">    --sample_1_of_n_eval_examples=<span class="variable">$SAMPLE_1_OF_N_EVAL_EXAMPLES</span> \</span><br><span class="line">    --alsologtostderr</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h4 id="使用TensorBoard-跟踪训练过程"><a href="#使用TensorBoard-跟踪训练过程" class="headerlink" title="使用TensorBoard 跟踪训练过程"></a>使用TensorBoard 跟踪训练过程</h4><p>训练过程会持续几个小时到十几个小时，可以通过tensorboard查看训练的情况</p>
<p>使用一台Azure的CPU虚拟机进行训练~4s进行一次迭代，正常模型有比较不错结果迭代次数大概在10K以上。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tensorboard --logdir=<span class="variable">$&#123;MODEL_DIR&#125;</span></span><br></pre></td></tr></table></figure>
<p><img src="/qnsource/images/2018-04-14-TensorFlow-Object-Detection-API/tensorboard_loss.PNG" alt="tensorboard_loss"></p>
<h3 id="2-4-导出模型"><a href="#2-4-导出模型" class="headerlink" title="2.4 导出模型"></a>2.4 导出模型</h3><p>模型训练过程中，会每隔一段时间生成一个checkpoint，一个checkpoint至少包括三个文件：</p>
<ul>
<li>model.ckpt-${CHECKPOINT_NUMBER}.data-00000-of-00001</li>
<li>model.ckpt-${CHECKPOINT_NUMBER}.index</li>
<li>model.ckpt-${CHECKPOINT_NUMBER}.meta</li>
</ul>
<p>可以通过如下命令从checkpoints中提取模型：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">Example Usage:</span><br><span class="line">--------------</span><br><span class="line">python export_inference_graph \</span><br><span class="line">    --input_type image_tensor \</span><br><span class="line">    --pipeline_config_path path/to/ssd_inception_v2.config \</span><br><span class="line">    --trained_checkpoint_prefix path/to/model.ckpt \</span><br><span class="line">    --output_directory path/to/exported_model_directory</span><br><span class="line">    </span><br><span class="line">    -----</span><br><span class="line">The expected output would be <span class="keyword">in</span> the directory</span><br><span class="line">path/to/exported_model_directory (<span class="built_in">which</span> is created <span class="keyword">if</span> it does not exist)</span><br><span class="line">with contents:</span><br><span class="line"> - graph.pbtxt</span><br><span class="line"> - model.ckpt.data-00000-of-00001</span><br><span class="line"> - model.ckpt.info</span><br><span class="line"> - model.ckpt.meta</span><br><span class="line"> - frozen_inference_graph.pb</span><br><span class="line"> + saved_model (a directory)</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># From tensorflow/models/research/</span></span><br><span class="line"><span class="built_in">export</span> PYTHONPATH=<span class="variable">$PYTHONPATH</span>:`<span class="built_in">pwd</span>`:`<span class="built_in">pwd</span>`/slim</span><br><span class="line">python export_inference_graph.py \</span><br><span class="line">    --input_type image_tensor \</span><br><span class="line">    --pipeline_config_path training/ssd_mobilenet_v1_pets.config \</span><br><span class="line">    --trained_checkpoint_prefix training/model.ckpt-10116 \</span><br><span class="line">    --output_directory water_meter_panel</span><br><span class="line">-----</span><br><span class="line">INPUT_TYPE=image_tensor</span><br><span class="line">PIPELINE_CONFIG_PATH=<span class="string">"object_detection/training/pipeline.config"</span></span><br><span class="line">TRAINED_CKPT_PREFIX=/home/ubuntu/1.objectDetection/training/model.ckpt-14450</span><br><span class="line">EXPORT_DIR=/home/ubuntu/1.objectDetection/<span class="built_in">export</span></span><br><span class="line"></span><br><span class="line">$ python object_detection/export_inference_graph.py \</span><br><span class="line">    --input_type=<span class="variable">$&#123;INPUT_TYPE&#125;</span> \</span><br><span class="line">    --pipeline_config_path=<span class="variable">$&#123;PIPELINE_CONFIG_PATH&#125;</span> \</span><br><span class="line">    --trained_checkpoint_prefix=<span class="variable">$&#123;TRAINED_CKPT_PREFIX&#125;</span> \</span><br><span class="line">    --output_directory=<span class="variable">$&#123;EXPORT_DIR&#125;</span></span><br><span class="line"></span><br><span class="line">-----</span><br><span class="line">WARNING:tensorflow:From /home/gaoc/data/<span class="built_in">test</span>/object_detect/models/research/object_detection/exporter.py:357: get_or_create_global_step (from tensorflow.contrib.framework.python.ops.variables) is deprecated and will be removed <span class="keyword">in</span> a future version.</span><br><span class="line">Instructions <span class="keyword">for</span> updating:</span><br><span class="line">Please switch to tf.train.get_or_create_global_step</span><br><span class="line">2018-01-20 06:34:08.551446: I tensorflow/core/platform/cpu_feature_guard.cc:137] Your CPU supports instructions that this TensorFlow binary was not compiled to use: SSE4.1 SSE4.2 AVX AVX2 FMA</span><br><span class="line">2018-01-20 06:34:14.056881: I tensorflow/core/grappler/devices.cc:51] Number of eligible GPUs (core count &gt;= 8): 0</span><br><span class="line">Converted 199 variables to const ops.</span><br></pre></td></tr></table></figure>
<blockquote>
<p>如果<code>Exportor.py</code>文件报bug，请参考<a href="https://github.com/tensorflow/models/issues/2861">https://github.com/tensorflow/models/issues/2861</a> 修复</p>
</blockquote>
<p>运行以上代码，将在<code>water_meter_panel</code>文件夹下生成模型所需的相关文件：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">gaoc@DataScience:~/data/<span class="built_in">test</span>/object_detect/models/research/object_detection$ ls -l water_meter_panel/</span><br><span class="line">total 44820</span><br><span class="line">-rw-r--r-- 1 gaoc root       77 Jan 20 06:34 checkpoint</span><br><span class="line">-rw-r--r-- 1 gaoc root 22636802 Jan 20 06:34 frozen_inference_graph.pb</span><br><span class="line">-rw-r--r-- 1 gaoc root 22174240 Jan 20 06:34 model.ckpt.data-00000-of-00001</span><br><span class="line">-rw-r--r-- 1 gaoc root     8873 Jan 20 06:34 model.ckpt.index</span><br><span class="line">-rw-r--r-- 1 gaoc root  1058139 Jan 20 06:34 model.ckpt.meta</span><br><span class="line">drwxr-xr-x 3 gaoc root     4096 Jan 20 06:34 saved_model</span><br><span class="line">water_meter_panel/</span><br><span class="line">├── checkpoint</span><br><span class="line">├── frozen_inference_graph.pb</span><br><span class="line">├── model.ckpt.data-00000-of-00001</span><br><span class="line">├── model.ckpt.index</span><br><span class="line">├── model.ckpt.meta</span><br><span class="line">└── saved_model</span><br><span class="line">    ├── saved_model.pb</span><br><span class="line">    └── variables</span><br></pre></td></tr></table></figure>
<h3 id="2-5-测试"><a href="#2-5-测试" class="headerlink" title="2.5 测试"></a>2.5 测试</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># From the tensorflow/models/research/ directory</span></span><br><span class="line">python object_detection/eval.py \</span><br><span class="line">    --logtostderr \</span><br><span class="line">    --pipeline_config_path=<span class="variable">$&#123;PATH_TO_YOUR_PIPELINE_CONFIG&#125;</span> \</span><br><span class="line">    --checkpoint_dir=<span class="variable">$&#123;PATH_TO_TRAIN_DIR&#125;</span> \</span><br><span class="line">    --eval_dir=<span class="variable">$&#123;PATH_TO_EVAL_DIR&#125;</span></span><br></pre></td></tr></table></figure>
<p>物体识别领域的算法性能评价指标多数选择AP和mAP（mean average precision），多个类别物体检测中，每一个类别都可以根据recall和precision绘制一条曲线，AP就是该曲线下的面积，mAP是多个类别AP的平均值</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Average Precision (AP):</span><br><span class="line">AP% AP at IoU=.50:.05:.95 (primary challenge metric) APIoU=.50% AP at IoU=.50 (PASCAL VOC metric) APIoU=.75% AP at IoU=.75 (strict metric) </span><br><span class="line">AP Across Scales:</span><br><span class="line">APsmall% AP <span class="keyword">for</span> small objects: area &lt; 322 APmedium% AP <span class="keyword">for</span> medium objects: 322 &lt; area &lt; 962 APlarge% AP <span class="keyword">for</span> large objects: area &gt; 962 </span><br><span class="line">Average Recall (AR):</span><br><span class="line">ARmax=1% AR given 1 detection per image ARmax=10% AR given 10 detections per image ARmax=100% AR given 100 detections per image </span><br><span class="line">AR Across Scales:</span><br><span class="line">ARsmall% AR <span class="keyword">for</span> small objects: area &lt; 322 ARmedium% AR <span class="keyword">for</span> medium objects: 322 &lt; area &lt; 962 ARlarge% AR <span class="keyword">for</span> large objects: area &gt; 962</span><br></pre></td></tr></table></figure>
<p><img src="/qnsource/images/2018-04-14-TensorFlow-Object-Detection-API/AP_MAP.PNG" alt="AP_MAP"></p>
<p>从性能测试结果来看该模型已经具备96%的检测精度了，具备投入生产环境所需的性能。</p>
<p>预测结果见下图，准确率达到了99%以上。</p>
<p><img src="/qnsource/images/2018-04-14-TensorFlow-Object-Detection-API/detect_demo.png" alt="detect_demo"></p>
<h2 id="3-结论"><a href="#3-结论" class="headerlink" title="3. 结论"></a>3. 结论</h2><ul>
<li>对于简单业务场景的物体识别类案例，可以通过迁移学习利用已有的成熟模型快速迭代生成新的特定模型；</li>
<li>这种迁移的另一个优势是对小数据样本具备很好的适应能力，可以解决前期数据不足和数据质量差的问题；</li>
<li>当然采用这种方式也同时存在一定的弊端，比如由于模型预训练参数较多，模型体积较大，模型的选取需要反复测试和优化。</li>
</ul>
<h3 id="3-1-经验总结"><a href="#3-1-经验总结" class="headerlink" title="3.1 经验总结"></a>3.1 经验总结</h3><ol>
<li><p>虽然Tensorflow Object Detection API提供了丰富的文档介绍相关工作流程，但由于技术、平台和软件版本本身更新较快，实践中还是或多或少会遇到不少问题，静下心来多翻翻Github的issues里一般都有别人的提问及解答；建议还是先根据文档跑通demo，熟悉相关工具和流程再将框架迁移到自己的数据集之上；</p>
</li>
<li><p>建议自己识别的项目文件单独建立一个数据准备文件夹进行数据准备和相关配置脚本的准备，不要跟Github克隆的Object Detection项目混在一起，不容易管理，也不利于重复利用；</p>
</li>
<li><p>TFOD API提供的Tensorflow可视化相当完备，启动训练任务之后，一定要同步启动验证脚本，可以实时跟踪训练进程；</p>
</li>
<li><p>很容易疏忽的一个步骤是关于PYTHON PATH的处理，在执行相关API之前一定要记得EXPORT相关path，可以些一个bash文件，在执行命令的Terminal中source一下；常见错误如下：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ImportError: No module named ’object_detection’</span><br></pre></td></tr></table></figure>
</li>
<li><p>充分利用GPU和CPU进行训练：</p>
<ol>
<li><p>如果使用CPU训练，控制配置参数中<code>num_examples</code>为一个很小的值（5-10），这样将使用验证数据中的一部分进行验证而不是全部；</p>
</li>
<li><p>配置<code>CUDA_VISIBLE_DEVICES</code>环境变量，选择使用哪个GPU或CPU来分配内存资源：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ export CUDA_VISIBLE_DEVICES="0"</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ export CUDA_VISIBLE_DEVICES="1"</span><br><span class="line">... another scripts</span><br></pre></td></tr></table></figure>
<p>配置为空使用CPU</p>
</li>
</ol>
</li>
<li><p>尽量使用最新版的Tensorflow，在撰写本文时已经是1.7了，当时做实验用的是1.4，复现的时候发现1.4版本已经抛错了…</p>
</li>
</ol>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><blockquote id="fn_1">
<sup>1</sup>. The TensorFlow Object Detection API is an open source framework built on top of TensorFlow that makes it easy to construct, train and deploy object detection models.<a href="#reffn_1" title="Jump back to footnote [1] in the text."> &#8617;</a>
</blockquote>
<blockquote id="fn_2">
<sup>2</sup>. See <a href="http://cocodataset.org/#detections-eval">MSCOCO evaluation protocol</a>.<a href="#reffn_2" title="Jump back to footnote [2] in the text."> &#8617;</a>
</blockquote>
<ol>
<li><a href="https://www.kernix.com/blog/image-classification-with-a-pre-trained-deep-neural-network_p11">Image classification with a pre-trained deep neural network</a></li>
<li><a href="https://towardsdatascience.com/how-to-train-your-own-object-detector-with-tensorflows-object-detector-api-bec72ecfe1d9">How to train your own Object Detector with TensorFlow’s Object Detector API</a></li>
<li><a href="https://github.com/datitran/raccoon_dataset">https://github.com/datitran/raccoon_dataset</a></li>
</ol>

        </div>
        
        
        
    </div>
</div>








    
<div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                

                <time class="level-item has-text-grey" datetime="2018-04-13T06:45:52.000Z">2018-04-13</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/深度学习/">深度学习</a>&nbsp;/&nbsp;<a class="has-link-grey -link" href="/categories/深度学习/机器视觉/">机器视觉</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    23 分钟 读完 (大约 3385 个字)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2018/04/13/Object-Detection-Faster-RCNN/">物体识别技术之Faster R-CNN</a>
            
        </h1>
        <div class="content">
            <p><strong>摘要:</strong> 2015年提出的Faster R-CNN架构在基于机器视觉的物体识别领域占据重要的地位，从R-CNN到fast R-CNN再到faster R-CNN,乃至后续的Mask-R-CNN形成了一条完整的两步识别的物体识别技术生态。</p>
<!-- excerpt -->
<h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p>物体识别技术一直是机器视觉中业务场景最丰富，关注度最高的一个类别。将花几期来分别对主流的物体识别技术如Faster RCNN，SSD，YOLO，Mask-RCNN进行整理和分析，并利用实践的方式进行强化。</p>
<p>在R-CNN,Fast R-CNN，Faster R-CNN中，物体识别被分为两个步骤实现（与SSD、YOLO的主要差异）：候选区域选择和基于深度网络的物体识别。</p>
<h3 id="传统的物体识别算法"><a href="#传统的物体识别算法" class="headerlink" title="传统的物体识别算法"></a>传统的物体识别算法</h3><p>传统的物体识别技术采用的滑动窗口+图像金字塔+分类器的算法，可以参见前述博文在<a href="/Deep-Learning-Lab-Logo-Detection">基于机器视觉技术的品牌LOGO检测</a>中做的实际测试，原理易于理解，但效率较低，很难达到实时处理的需求：</p>
<ol>
<li>速度慢，效率低：需要利用滑动窗口遍历图像的不同位置；</li>
<li>受图像畸变影响严重：由于CNN的输入必须是固定大小的图像，所以限制了检测目标的长宽比例，比如这种方法不能同时检测矮胖对象和长瘦对象；</li>
<li>错误率高，没法识别图像的全局特征，每个窗口只能看到局部特征，所以检测精度也受到了比较大的影响。</li>
</ol>
<h3 id="物体识别精度的衡量指标"><a href="#物体识别精度的衡量指标" class="headerlink" title="物体识别精度的衡量指标"></a>物体识别精度的衡量指标</h3><ul>
<li><p>IoU(Intersection over Union)</p>
<script type="math/tex; mode=display">
IoU = \frac{Area\ of\ Overlap}{Area\ of\ Union}</script><p><img src="/qnsource/images/2018-04-13-Object-Detection-Faster-RCNN/IoU.png" alt="IoU"></p>
</li>
<li><p>mAP(Mean Average Precision)</p>
<ul>
<li>所有分类的IoU均值；</li>
</ul>
</li>
</ul>
<h3 id="参考论文"><a href="#参考论文" class="headerlink" title="参考论文"></a>参考论文</h3><ol>
<li>R-CNN： Rich feature hierarchies for accurate object detection and semantic segmentation</li>
<li>Faster R-CNN</li>
</ol>
<h2 id="R-CNN"><a href="#R-CNN" class="headerlink" title="R-CNN"></a>R-CNN</h2><blockquote>
<p><strong>论文：</strong> Rich feature hierarchies for accurate object detection and semantic segmentation，2013，Girshick</p>
</blockquote>
<p>问题：解决目标检测网络</p>
<p>R-CNN的实现包括如下图所示的4个主要步骤：</p>
<ol>
<li>接受输入图像；</li>
<li>利用Selective Search算法从图像中抽取大约2000个候选区域；</li>
<li>对每个候选区域利用预训练的CNN进行特征抽取（迁移学习）；</li>
<li>对每个特征抽取区域利用线性SVM进行分类</li>
</ol>
<p><img src="/qnsource/images/2018-04-13-Object-Detection-Faster-RCNN/R-CNN.png" alt="R-CNN"></p>
<p>论文的主要贡献：</p>
<ol>
<li>使用Selective Search替代了特征金字塔和滑动窗口实现的兴趣区域选择，提升了效率；</li>
<li>利用预训练的神经网络进行特征提取替代了手工特征如HOG的特征提取方法，正是由于CNN学习的特征具备的鲁棒性大大提供了系统的泛化性能</li>
</ol>
<p>仍然存在的问题：</p>
<ol>
<li>识别慢，效率低；</li>
<li>不是一个端到端的解决方案</li>
</ol>
<h3 id="Selective-Search算法"><a href="#Selective-Search算法" class="headerlink" title="Selective Search算法"></a>Selective Search算法</h3><blockquote>
<p>论文：<a href="https://koen.me/research/pub/uijlings-ijcv2013-draft.pdf">Selective Search for Object Recognition</a>，2012，J.R.R.Uijings</p>
</blockquote>
<p>之前很多算法都是基于蛮力搜索(Exhaustive Search),对整张图片进行扫描，或者是采用动态窗口的方法，这种方法耗时严重，操作麻烦。J.R.R提出的选择性搜索的方法，在识别前期在整张图片中生成1~3K个proposal的方法，再对每个proposal进行处理。</p>
<p>Selective Search [4], one of the most popular methods, greedily merges superpixels based on engineered low-level features.</p>
<blockquote>
<p>缺点：效率低，计算量大，使用1个CPU处理一张图片，需要2s<sup><a href="#fn_1" id="reffn_1">1</a></sup></p>
</blockquote>
<h2 id="Fast-R-CNN"><a href="#Fast-R-CNN" class="headerlink" title="Fast R-CNN"></a>Fast R-CNN</h2><p>问题提出：解决端到端训练的问题，提出了Region of Interest（ROI）Pooling</p>
<p>跟R-CNN中使用深度CNN的方式不同，Fast R-CNN中首先将CNN应用到整个图像中进行特征提取，利用一个固定窗口在抽取特征上滑动，分别进行分类预测和回归预测。Fast R-CNN的主要处理流程包括：</p>
<ol>
<li>输入图像和标定的识别框信息；</li>
<li>利用深度卷积神经网络抽取图像特征；</li>
<li>利用ROI pooling获取ROI特征向量；</li>
<li>利用两个全联通层进行分类和回归预测</li>
</ol>
<p><img src="/qnsource/images/2018-04-13-Object-Detection-Faster-RCNN/Fast-RCNN.png" alt="Fast RCNN"></p>
<p>端到端的训练过程源于提出了多任务损失函数，将分类问题和回归问题整合在一起，打通了梯度的更新路径，下图描述了Fast R-CNN的训练和测试过程：</p>
<p><img src="/qnsource/images/2018-04-13-Object-Detection-Faster-RCNN/fast-R-CNN-训练与测试.png" alt="fast R-CNN 训练与测试"></p>
<blockquote>
<p>缺点：仍然没有摆脱Selective Search算法在推理阶段进行候选区域生成。</p>
</blockquote>
<h2 id="Faster-R-CNN"><a href="#Faster-R-CNN" class="headerlink" title="Faster R-CNN"></a>Faster R-CNN</h2><blockquote>
<p>论文：<a href="https://arxiv.org/abs/1506.01497">Faster R-CNN: Towards Real-Time Object Detection with Region Proposal Networks</a>, 2015, <a href="https://arxiv.org/find/cs/1/au:+Ren_S/0/1/0/all/0/1">Shaoqing Ren</a>, <a href="https://arxiv.org/find/cs/1/au:+He_K/0/1/0/all/0/1">Kaiming He</a>, <a href="https://arxiv.org/find/cs/1/au:+Girshick_R/0/1/0/all/0/1">Ross Girshick</a>, <a href="https://arxiv.org/find/cs/1/au:+Sun_J/0/1/0/all/0/1">Jian Sun</a></p>
<p>实现：<a href="https://github.com/rbgirshick/py-faster-rcnn">Github上作者提供的Python实现</a></p>
<p>商业实现：Pinterests<sup><a href="#fn_2" id="reffn_2">2</a></sup></p>
</blockquote>
<p><strong>问题提出：</strong>在基于候选区域选择的CNN（region-based CNN）物体识别网络中，候选区域选择的效率成为了整个系统的瓶颈；Faster R-CNN中提出了<em>Region Proposal Netwrok</em>与物体识别网络共享网络参数（替代了Fast R-CNN中的Selective Search算法），降低了候选区域选择的时间代价。</p>
<ul>
<li>基础网络（Base Network）：特征抽取（迁移学习），抽取的特征将同时应用于RPN和RoIP阶段</li>
<li>RPN：候选区域选择（利用了网络的Attention机制），用于发掘图像中潜在的可能存在物体的区域</li>
<li>RoIP：兴趣区域特征提取</li>
<li>R-CNN：分类预测和候选框回归</li>
</ul>
<p><img src="/qnsource/images/2018-04-13-Object-Detection-Faster-RCNN/fasterrcnn-architecture.b9035cba.png" alt="fasterrcnn-architecture.b9035cba"></p>
<blockquote>
<p>使用一块GPU，性能大概在7-10 FPS</p>
</blockquote>
<h3 id="基础网络"><a href="#基础网络" class="headerlink" title="基础网络"></a>基础网络</h3><p>基础网络的主要作用是利用迁移学习完成原始图像的特征抽取，在论文中使用了 在ImageNet预训练的<a href="https://arxiv.org/abs/1311.2901">ZF</a> 或 <a href="https://arxiv.org/abs/1409.1556">VGG</a>来完成这一任务。当然根据物体识别任务的不同应用场景可以在模型精度和推理时间上进行折中选择 <a href="https://arxiv.org/abs/1704.04861">MobileNet</a>, ResNet-152， <a href="https://arxiv.org/abs/1608.06993">DenseNet</a>。</p>
<blockquote>
<p>文献中，Faster R-CNN的基础网络在使用VGG作为特征提取网络时，使用<code>conv5/conv5_1</code>层的输出特征；</p>
<p>目前ResNet在很多情况下已经替代了VGG16作为特征提取网络；</p>
<p>为了保证网络是全卷积神经网络架构，需要把全连接层剔除，保证可以输入任意维度的输入图像</p>
</blockquote>
<p><img src="/qnsource/images/2018-04-13-Object-Detection-Faster-RCNN/base-network.png" alt="base-network"></p>
<h3 id="Anchor-Box"><a href="#Anchor-Box" class="headerlink" title="Anchor Box"></a>Anchor Box</h3><blockquote>
<p>替代传统算法的特征金字塔或filter金字塔</p>
</blockquote>
<p>一张图像中被识别目标形状大小各异，这也是在原始算法中加入特征金子塔来对原始图像进行多个维度特征变换的原因。</p>
<p><strong>Anchor Box</strong>也是为了解决上述问题，我们可以不改变图像的形状，通过改变预测每个区域物体的“窗口”来框出不同大小的物体。首先在原始图像中均匀的选取一些Anchor Box中心点，然后在每个中心点上预制多个Anchor Box。</p>
<p><img src="/qnsource/images/2018-04-13-Object-Detection-Faster-RCNN/anchors-centers.141181d6.png" alt="anchors-centers.141181d6"></p>
<p>在Faster R-CNN是使用3个不同形状（1:1, 1:2,2:1）和3个不同大小(128x128,256x256,512x512，按照原图尺寸生成)进行组合共计3x3=9种不同的Anchor box。</p>
<blockquote>
<p>使用VGG16做特征提取的情况下，一张输入图片总共可以刻画为512个窗口区域，生成512x(4+2)x9个输出参数。</p>
</blockquote>
<p><img src="/qnsource/images/2018-04-13-Object-Detection-Faster-RCNN/anchors-progress.119e1e92.png" alt="anchors-progress.119e1e92"></p>
<p>由于直接预测bouding box难以实现，作者将问题转变为预测预测值与真实值之间的偏移，将问题转变为四个偏移值的预测问题。</p>
<h3 id="Region-Proposal-Network-RPN"><a href="#Region-Proposal-Network-RPN" class="headerlink" title="Region Proposal Network(RPN)"></a>Region Proposal Network(RPN)</h3><p>RPN的主要目的是对每个区域是否可能有物体进行打分，基于打分值决定是否进行下一步的分类任务。在基础网络抽取的特征图上使用一个3x3的滑动窗口（512个卷积核），每个滑动窗口的中心点位置为上述Achor Box的中心点区域，在每个滑动窗口区域，将得到两个1x1卷积网络输出，分别为2k的前景/背景预测（该区域是否存在可被预测物体，分类问题）以及4k的位置信息预测（回归问题），四个值分别是 </p>
<script type="math/tex; mode=display">
 \Delta_{center_{x}}, \Delta_{center_{y}}, \Delta_{width}, \Delta_{height}</script><blockquote>
<p>k是Anchor Box的数目</p>
<p>我们将从候选区域中选择打分较高的前N个进行下一轮分析，如果物体打分足够高，下一步将进行非极大抑制和区域选择，如果打分值很低将抛弃这些区域</p>
</blockquote>
<p><img src="/qnsource/images/2018-04-13-Object-Detection-Faster-RCNN/rpn-conv-layers.63c5bf86.png" alt="rpn-conv-layers.63c5bf86"></p>
<h4 id="目标和损失函数"><a href="#目标和损失函数" class="headerlink" title="目标和损失函数"></a>目标和损失函数</h4><p>The RPN does two different type of predictions: the binary classification and the bounding box regression adjustment.</p>
<p>For training, we take all the anchors and put them into two different categories. Those that overlap a ground-truth object with an <a href="https://www.pyimagesearch.com/2016/11/07/intersection-over-union-iou-for-object-detection/">Intersection over Union</a> (IoU) bigger than 0.5 are considered “foreground” and those that don’t overlap any ground truth object or have less than 0.1 IoU with ground-truth objects are considered “background”.</p>
<script type="math/tex; mode=display">
L({p_i}, {t_i}) = \frac{1}{N_{cls}}\sum_iL_{cls}(p_i,p_i^*)+\lambda\frac{1}{N_{reg}}\sum_ip_i^*L_{reg}(t_i,t_i^*)</script><p>其中分类的损失函数为：</p>
<script type="math/tex; mode=display">
L_{cls}(p_i,p_i^*) = -log[p_i^*p_i+(1-p_i^*)(1-p_i)]</script><p>$p_i$为第$i$个参考框是物体的预测概率值，$p_i^*$为实际值，如果anchor是物体的话该值为1，否则为0。</p>
<p>回归损失函数为：</p>
<script type="math/tex; mode=display">
L_{reg}(t_i,t_i^*)=R(t_i-t_i^*)</script><p>其中R为smooth L1平滑方程：</p>
<script type="math/tex; mode=display">
smooth_{L_1}(x)=\left\{  
             \begin{array}{lr}  
             0.5x^2  & if \  |x|<1 \\  
             |x|-0.5 & otherwise.     
             \end{array}  
\right.</script><p>$t_i$与 $ t_i^<em> $ 分别对应四个偏差值。$ t_i $ 是预测框与anchor之间的偏差，$ t_i^</em> $ 是ground truth与anchor之间的偏差</p>
<h4 id="参数选择"><a href="#参数选择" class="headerlink" title="参数选择"></a>参数选择</h4><blockquote>
<p>参数选择与其说是一个技术活倒不如认为是一个经验活，是通过大量实践验证出来的最佳实践，所以有必要分析整理每篇文章对参数选择和优化的技巧。</p>
</blockquote>
<ul>
<li>非极大抑制的IoU阈值一般使用<strong>0.6</strong>；</li>
<li>论文中关于候选区域选择了N=2000,但一般而言比这个小的数目也能取得不错的效果，比如50，100 …</li>
</ul>
<h3 id="Region-of-Interest（ROI）Pooling"><a href="#Region-of-Interest（ROI）Pooling" class="headerlink" title="Region of Interest（ROI）Pooling"></a>Region of Interest（ROI）Pooling</h3><p>ROI阶段的主要作用为使用矩阵操作（Array Slicing）从特征图中捕获N个兴趣区域，并降采样到7x7xD的尺寸，服务于接下来的全联同网络。</p>
<p><img src="/qnsource/images/2018-04-13-Object-Detection-Faster-RCNN/roi.png" alt="roi"></p>
<h3 id="Region-based-CNN"><a href="#Region-based-CNN" class="headerlink" title="Region-based CNN"></a>Region-based CNN</h3><p>使用两个不同的全联通网络（Fully-Connected Network，FC）：</p>
<ul>
<li>A fully-connected layer with N+1units where N is the total number of classes and that extra one is for the background class.</li>
<li>A fully-connected layer with 4N units. We want to have a regression prediction, thus we need $\Delta<em>{center</em>{x}}$, $\Delta<em>{center</em>{y}}$, $\Delta<em>{width}$, $\Delta</em>{height}$ for each of the N possible classes.</li>
</ul>
<p><img src="/qnsource/images/2018-04-13-Object-Detection-Faster-RCNN/rcnn-architecture.6732b9bd.png" alt="rcnn-architecture.6732b9bd"></p>
<p>在这个步骤中同样由两个损失函数构成：Categorical cross-entropy分类损失和Smooth L1回归损失</p>
<h3 id="网络训练"><a href="#网络训练" class="headerlink" title="网络训练"></a>网络训练</h3><ul>
<li>实验表明：联合训练（使用weighted sum）优于单独训练两个网络；<ul>
<li>将每个阶段的4个损失函数（其中RPN阶段2个，R-CNN阶段2个）组合在一起，并赋不同的权重，分类损失需要获得比回归损失更多的权重；</li>
<li>使用L2正则损失</li>
</ul>
</li>
<li>是否单独训练基础网络取悦于目标与预训练网络的差异，这个跟迁移学习类似；</li>
<li>使用带动量的随机梯度下降（SGD with momentum），其中<code>monmentum=0.9</code>，初始学习率<code>lr=0.001</code>， 50k步之后，lr调整为0.0001</li>
</ul>
<h2 id="实践时间"><a href="#实践时间" class="headerlink" title="实践时间"></a>实践时间</h2><h3 id="数据集：LISA交通标志数据库"><a href="#数据集：LISA交通标志数据库" class="headerlink" title="数据集：LISA交通标志数据库"></a>数据集：LISA交通标志数据库</h3><ul>
<li>下载地址：<a href="http://cvrr.ucsd.edu/LISA/lisa-traffic-sign-dataset.html">http://cvrr.ucsd.edu/LISA/lisa-traffic-sign-dataset.html</a></li>
<li>47 US sign types</li>
<li>7855 annotations on 6610 frames.</li>
<li>Sign sizes from 6x6 to 167x168 pixels.</li>
<li>Images obtained from different cameras. Image sizes vary from 640x480 to 1024x522 pixels.</li>
<li>Some images in color and some in grayscale.</li>
<li>Full version of the dataset includes videos for all annotated signs.</li>
<li>Each sign is annotated with sign type, position, size, occluded (yes/no), on side road (yes/no).</li>
<li>All annotations are save in plain text .csv-files.</li>
<li>~7.7GB大小</li>
</ul>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><blockquote id="fn_1">
<sup>1</sup>. <a href="https://arxiv.org/abs/1506.01497">Faster R-CNN: Towards Real-Time Object Detection with Region Proposal Networks</a>, 2015, <a href="https://arxiv.org/find/cs/1/au:+Ren_S/0/1/0/all/0/1">Shaoqing Ren</a>, <a href="https://arxiv.org/find/cs/1/au:+He_K/0/1/0/all/0/1">Kaiming He</a>, <a href="https://arxiv.org/find/cs/1/au:+Girshick_R/0/1/0/all/0/1">Ross Girshick</a>, <a href="https://arxiv.org/find/cs/1/au:+Sun_J/0/1/0/all/0/1">Jian Sun</a><a href="#reffn_1" title="Jump back to footnote [1] in the text."> &#8617;</a>
</blockquote>
<blockquote id="fn_2">
<sup>2</sup>. D. Kislyuk, Y. Liu, D. Liu, E. Tzeng, and Y. Jing, “Human curation and convnets: Powering item-to-item recommendations on pinterest,” arXiv:1511.04003, 2015.<a href="#reffn_2" title="Jump back to footnote [2] in the text."> &#8617;</a>
</blockquote>
<blockquote id="fn_3">
<sup>3</sup>. <a href="https://tryolabs.com/blog/2018/01/18/faster-r-cnn-down-the-rabbit-hole-of-modern-object-detection/">Faster R-CNN: Down the rabbit hole of modern object detection</a><a href="#reffn_3" title="Jump back to footnote [3] in the text."> &#8617;</a>
</blockquote>

        </div>
        
        
        
    </div>
</div>








    
<div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                

                <time class="level-item has-text-grey" datetime="2018-04-11T06:44:58.000Z">2018-04-11</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/动手实践营/">动手实践营</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    17 分钟 读完 (大约 2546 个字)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2018/04/11/Vechicle-identification-by-stanford-car-dataset/">利用迁移学习实现车辆识别</a>
            
        </h1>
        <div class="content">
            <p><strong>摘要：</strong> 利用迁移学习技术训练识别汽车厂商和款式的模型。<br><!-- excerpt --></p>
<p>@[toc]</p>
<h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><h3 id="数据集：-Stanford-Cars-Dataset"><a href="#数据集：-Stanford-Cars-Dataset" class="headerlink" title="数据集： Stanford Cars Dataset"></a>数据集： Stanford Cars Dataset</h3><ul>
<li>数据集组成：包含<strong>196</strong>种车辆的<strong>16,185</strong>张照片；其中训练集8144，测试集8041；</li>
<li>关键特征包括：车辆制造商、款式、生产日期（比如：2012 Tesla Model S）；</li>
<li>下载地址：<a href="https://ai.stanford.edu/~jkrause/cars/car_dataset.html；">https://ai.stanford.edu/~jkrause/cars/car_dataset.html；</a></li>
<li>相关论文：<a href="https://ai.stanford.edu/~jkrause/papers/3drr13.pdf"><strong>3D Object Representations for Fine-Grained Categorization</strong></a>，Jonathan Krause, Michael Stark, Jia Deng, Li Fei-Fei</li>
</ul>
<p><img src="/qnsource/images/2018-04-11-vechicle-identification-by-stanford-car-dataset/car.jpg" alt="car"></p>
<blockquote>
<p><strong>数据集特点：</strong></p>
<ol>
<li>存在明显的数据不平衡问题；</li>
<li>每个分类图像数目过少，无法达到准确预测分类目标的基准；</li>
</ol>
</blockquote>
<p>针对数据集的特点，利用迁移学习Fine-Tune来训练一个在ImageNet上预训练的模型是一个不错的方式，下面我们将从数据的准备开始一步步得完成模型的训练任务。</p>
<h2 id="数据准备"><a href="#数据准备" class="headerlink" title="数据准备"></a>数据准备</h2><p>在这一部分中，我们将读入原始数据，进行基本的数据处理，然后对数据进行统一存储，一般面对大规模的数据集可以选用<code>HDF5</code>或MXNet的.<code>LST</code>格式进行存储。</p>
<blockquote>
<p>通过这种方式进行存储可以解决每张图片读取都要产生一次IO带来的访问时延，同时可以利用存储系统连续读的方式，直接对大规模数据集进行切片操作。</p>
</blockquote>
<h3 id="配置信息"><a href="#配置信息" class="headerlink" title="配置信息"></a>配置信息</h3><p>为了配合后续处理流程方便，新建一个<code>car.config</code>的配置文件，用于对相关配置信息的存储：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> os <span class="keyword">import</span> path</span><br><span class="line"></span><br><span class="line"><span class="comment"># define the base path to the cars dataset</span></span><br><span class="line">BASE_PATH = <span class="string">"Path-to-car-dataset"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># based on the base path, derive the images path and meta file path</span></span><br><span class="line">IMAGES_PATH = path.sep.join([BASE_PATH, <span class="string">"car_ims"</span>])</span><br><span class="line">LABELS_PATH = path.sep.join([BASE_PATH, <span class="string">"complete_dataset.csv"</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment">#define path for HDF5</span></span><br><span class="line">TRAIN_HDF5 = path.sep.join([MX_OUTPUT, <span class="string">"hdf5/train.hdf5"</span>])</span><br><span class="line">VAL_HDF5 = path.sep.join([MX_OUTPUT, <span class="string">"hdf5/val.hdf5"</span>])</span><br><span class="line">TEST_HDF5 = path.sep.join([MX_OUTPUT, <span class="string">"hdf5/test.hdf5"</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment">#define path for storing Mean R G B data</span></span><br><span class="line">DATASET_MEAN = path.sep.join([BASE_PATH, <span class="string">"output/car_mean.json"</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># define the path to the output directory used for storing plots,</span></span><br><span class="line"><span class="comment"># classification reports, etc.</span></span><br><span class="line">OUTPUT_PATH = <span class="string">"output"</span></span><br><span class="line">MODEL_PATH = path.sep.join([OUTPUT_PATH,<span class="string">"inceptionv3_stanfordcar.hdf5"</span>])</span><br><span class="line">FIG_PATH = path.sep.join([OUTPUT_PATH,<span class="string">"inceptionv3_stanfordcar.png"</span>])</span><br><span class="line">JSON_PATH = path.sep.join([OUTPUT_PATH,<span class="string">"inceptionv3_stanfordcar.json"</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># define the path to the label encoder</span></span><br><span class="line">LABEL_ENCODER_PATH = path.sep.join([BASE_PATH, <span class="string">"output/le.cpickle"</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># define the percentage of validation and testing images relative</span></span><br><span class="line"><span class="comment"># to the number of training images</span></span><br><span class="line">NUM_CLASSES = <span class="number">164</span></span><br><span class="line">NUM_VAL_IMAGES = <span class="number">0.15</span></span><br><span class="line">NUM_TEST_IMAGES = <span class="number">0.15</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># define the batch size</span></span><br><span class="line">BATCH_SIZE = <span class="number">64</span></span><br></pre></td></tr></table></figure>
<p>配置文件中包括<code>HDF5</code>文件的存放位置描述，原始数据和数据描述文件路径，RGB均值存储位置，训练过程中输出的图像和日志存储位置等信息。</p>
<h3 id="数据概览"><a href="#数据概览" class="headerlink" title="数据概览"></a>数据概览</h3><ol>
<li>我们先将数据描述文件<code>complete_dataset.csv</code>导入，了解下数据格式：</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="comment"># loading image paths and labels</span></span><br><span class="line">df = pd.read_csv(config.LABELS_PATH)</span><br><span class="line">df.head()</span><br></pre></td></tr></table></figure>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left">id</th>
<th>Image FileName</th>
<th>Make</th>
<th>Model</th>
<th>Vechicle Typle</th>
<th>Year</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">0</td>
<td>car_ims/000090.jpg</td>
<td>Acura</td>
<td>RL</td>
<td>Sedan</td>
<td>2012</td>
</tr>
<tr>
<td style="text-align:left">1</td>
<td>car_ims/000091.jpg</td>
<td>Acura</td>
<td>RL</td>
<td>Sedan</td>
<td>2012</td>
</tr>
<tr>
<td style="text-align:left">2</td>
<td>car_ims/000092.jpg</td>
<td>Acura</td>
<td>RL</td>
<td>Sedan</td>
<td>2012</td>
</tr>
<tr>
<td style="text-align:left">3</td>
<td>car_ims/000093.jpg</td>
<td>Acura</td>
<td>RL</td>
<td>Sedan</td>
<td>2012</td>
</tr>
</tbody>
</table>
</div>
<ol>
<li><p>遍历文件列表，将文件地址和样本标签分别进行存储，在本实验中值使用了制造商和款式两种特征，所以构成分类总共有164个：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> sklearn.preprocessing <span class="keyword">import</span> LabelEncoder</span><br><span class="line">trainPaths = []</span><br><span class="line">trainLabels = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> id,name <span class="keyword">in</span> enumerate(df[<span class="string">"Image Filename"</span>]):</span><br><span class="line">    trainPaths.append(os.sep.join([config.IMAGES_PATH,name]))</span><br><span class="line">    trainLabels.append(<span class="string">"&#123;&#125;:&#123;&#125;"</span>.format(df.iloc[id][<span class="string">"Make"</span>], df.iloc[id][<span class="string">"Model"</span>]))</span><br><span class="line"><span class="comment">#Encoding labels to num</span></span><br><span class="line">le = LabelEncoder()</span><br><span class="line">trainLabels = le.fit_transform(trainLabels)</span><br></pre></td></tr></table></figure>
</li>
<li><p>按照70%，15%，15%切分训练集、验证集和测试集：</p>
 <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.model_selection <span class="keyword">import</span> train_test_split</span><br><span class="line"></span><br><span class="line">numVal = int(len(trainPaths)*<span class="number">0.15</span>)</span><br><span class="line">numTest = int(len(trainPaths)*<span class="number">0.15</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># perform sampling from the training set to construct a a validation set</span></span><br><span class="line">split = train_test_split(trainPaths, trainLabels, test_size=numVal,</span><br><span class="line">    stratify=trainLabels)</span><br><span class="line">(trainPaths, valPaths, trainLabels, valLabels) = split</span><br><span class="line"></span><br><span class="line"><span class="comment"># perform stratified sampling from the training set to construct a testing set</span></span><br><span class="line">split = train_test_split(trainPaths, trainLabels, test_size=numTest,</span><br><span class="line">    stratify=trainLabels)</span><br><span class="line">(trainPaths, testPaths, trainLabels, testLabels) = split</span><br></pre></td></tr></table></figure>
</li>
<li><p>初始化相关配置：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># initialize the lists of RGB channel averages</span></span><br><span class="line">(R, G, B) = ([], [], [])</span><br><span class="line"></span><br><span class="line"><span class="comment"># construct a list pairing the training, validation, and testing</span></span><br><span class="line"><span class="comment"># image paths along with their corresponding labels and output list</span></span><br><span class="line"><span class="comment"># files</span></span><br><span class="line">datasets = [</span><br><span class="line">	(<span class="string">"train"</span>, trainPaths, trainLabels, config.TRAIN_HDF5),</span><br><span class="line">	(<span class="string">"val"</span>, valPaths, valLabels, config.VAL_HDF5),</span><br><span class="line">	(<span class="string">"test"</span>, testPaths, testLabels, config.TEST_HDF5)]</span><br></pre></td></tr></table></figure>
</li>
<li><p>遍历数据集并存储至HDF5文件：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> HDF5DatasetWriter</span><br><span class="line"><span class="keyword">import</span> AspectAwarePreprocessor</span><br><span class="line"><span class="keyword">import</span> progressbar</span><br><span class="line"></span><br><span class="line"><span class="comment">#resize images to (256,256,3)</span></span><br><span class="line">aap = AspectAwarePreprocessor(<span class="number">256</span>,<span class="number">256</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># loop over the dataset tuples</span></span><br><span class="line"><span class="keyword">for</span> (dType, paths, labels, outputPath) <span class="keyword">in</span> datasets:</span><br><span class="line">    <span class="comment"># create HDF5 writer</span></span><br><span class="line">    print(<span class="string">"[INFO] building &#123;&#125;..."</span>.format(outputPath))</span><br><span class="line">    writer = HDF5DatasetWriter((len(paths), <span class="number">256</span>, <span class="number">256</span>, <span class="number">3</span>), outputPath)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># initialize the progress bar</span></span><br><span class="line">    widgets = [<span class="string">"Building Dataset: "</span>, progressbar.Percentage(), <span class="string">" "</span>,</span><br><span class="line">        progressbar.Bar(), <span class="string">" "</span>, progressbar.ETA()]</span><br><span class="line">    pbar = progressbar.ProgressBar(maxval=len(paths),</span><br><span class="line">        widgets=widgets).start()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># loop over the image paths</span></span><br><span class="line">    <span class="keyword">for</span> (i, (path, label)) <span class="keyword">in</span> enumerate(zip(paths, labels)):</span><br><span class="line">        <span class="comment"># load the image from disk</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            image = cv2.imread(path)</span><br><span class="line">            image = aap.preprocess(image)</span><br><span class="line">            <span class="comment">#print(image.shape)</span></span><br><span class="line">            <span class="comment"># if we are building the training dataset, then compute the</span></span><br><span class="line">            <span class="comment"># mean of each channel in the image, then update the respective lists</span></span><br><span class="line">            <span class="keyword">if</span> dType == <span class="string">"train"</span>:</span><br><span class="line">                (b, g, r) = cv2.mean(image)[:<span class="number">3</span>]</span><br><span class="line">                R.append(r)</span><br><span class="line">                G.append(g)</span><br><span class="line">                B.append(b)</span><br><span class="line"></span><br><span class="line">            <span class="comment"># add the image and label to the HDF5 dataset</span></span><br><span class="line">            writer.add([image], [label])</span><br><span class="line">            pbar.update(i)</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            print(path)</span><br><span class="line">            print(label)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># close the HDF5 writer</span></span><br><span class="line">    pbar.finish()</span><br><span class="line">    writer.close()</span><br></pre></td></tr></table></figure>
<blockquote>
<p>我们首先统一将文件调整到(256,256,3)大小，再进行存储，所以在读取文件之后进行了简单的预处理。</p>
</blockquote>
</li>
<li><p>将RGB均值存储至单独文件</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="comment"># construct a dictionary of averages, then serialize the means to a JSON file</span></span><br><span class="line">print(<span class="string">"[INFO] serializing means..."</span>)</span><br><span class="line">D = &#123;<span class="string">"R"</span>: np.mean(R), <span class="string">"G"</span>: np.mean(G), <span class="string">"B"</span>: np.mean(B)&#125;</span><br><span class="line">f = open(config.DATASET_MEAN, <span class="string">"w"</span>)</span><br><span class="line">f.write(json.dumps(D))</span><br><span class="line">f.close()</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>至此，我们完成了将图像文件分为三个类别并分别存到了三个HDF5文件之中。</p>
<p>关于HDF5文件存储相关内容，详见后续推出的预处理博客~~</p>
<p>如果使用<code>MXNET</code>的list和rec来构建数据存储集合，在上述步骤3的基础上，按如下步骤：</p>
<ol>
<li><p>构建数据集列表文件’.list’文件</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># construct a list pairing the training, validation, and testing</span></span><br><span class="line"><span class="comment"># image paths along with their corresponding labels and output list</span></span><br><span class="line"><span class="comment"># files</span></span><br><span class="line">datasets = [</span><br><span class="line">	(<span class="string">"train"</span>, trainPaths, trainLabels, config.TRAIN_MX_LIST),</span><br><span class="line">	(<span class="string">"val"</span>, valPaths, valLabels, config.VAL_MX_LIST),</span><br><span class="line">	(<span class="string">"test"</span>, testPaths, testLabels, config.TEST_MX_LIST)]</span><br><span class="line"></span><br><span class="line"><span class="comment"># loop over the dataset tuples</span></span><br><span class="line"><span class="keyword">for</span> (dType, paths, labels, outputPath) <span class="keyword">in</span> datasets:</span><br><span class="line">	<span class="comment"># open the output file for writing</span></span><br><span class="line">	print(<span class="string">"[INFO] building &#123;&#125;..."</span>.format(outputPath))</span><br><span class="line">    </span><br><span class="line">	f = open(outputPath, <span class="string">"w"</span>)</span><br><span class="line"></span><br><span class="line">	<span class="comment"># loop over each of the individual images + labels</span></span><br><span class="line">	<span class="keyword">for</span> (i, (path, label)) <span class="keyword">in</span> enumerate(zip(paths, labels)):</span><br><span class="line">		<span class="comment"># write the image index, label, and output path to file</span></span><br><span class="line">		row = <span class="string">"\t"</span>.join([str(i), str(label), path])</span><br><span class="line">		f.write(<span class="string">"&#123;&#125;\n"</span>.format(row))</span><br><span class="line"></span><br><span class="line">	<span class="comment"># close the output file</span></span><br><span class="line">	f.close()</span><br></pre></td></tr></table></figure>
</li>
<li><p>将Label名称序列化存储，便于后续调用：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">f = open(config.LABEL_ENCODER_PATH, <span class="string">"wb"</span>)</span><br><span class="line">f.write(pickle.dumps(le))</span><br><span class="line">f.close()</span><br></pre></td></tr></table></figure>
<p>3.利用MXNet工具<code>im2rec</code>创建记录文件</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ /dsvm/tools/mxnet/bin/im2rec ./raid/datasets/cars/lists/train.lst <span class="string">""</span> ./raid/datasets/cars/rec/train.rec resize=256 encoding=<span class="string">'.jpg'</span> quality=100</span><br><span class="line"></span><br><span class="line">$ /dsvm/tools/mxnet/bin/im2rec ./raid/datasets/cars/lists/test.lst <span class="string">""</span> ./raid/datasets/cars/rec/test.rec resize=256 encoding=<span class="string">'.jpg'</span> quality=100</span><br><span class="line"></span><br><span class="line">$ /dsvm/tools/mxnet/bin/im2rec ./raid/datasets/cars/lists/val.lst <span class="string">""</span> ./raid/datasets/cars/rec/val.rec resize=256 encoding=<span class="string">'.jpg'</span> quality=100</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h2 id="训练迁移学习网络"><a href="#训练迁移学习网络" class="headerlink" title="训练迁移学习网络"></a>训练迁移学习网络</h2><p>在迁移学习的模型选择上我们选择了基于Keras提供的InceptionV3,可通过<a href="https://keras-cn.readthedocs.io/en/latest/other/application/">Keras官方文档</a>了解更多使用说明。下表列出了在keras中各模型的表现：</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>模型</th>
<th>大小</th>
<th>Top1准确率</th>
<th>Top5准确率</th>
<th>参数数目</th>
<th>深度</th>
</tr>
</thead>
<tbody>
<tr>
<td>Xception</td>
<td>88MB</td>
<td>0.790</td>
<td>0.945</td>
<td>22,910,480</td>
<td>126</td>
</tr>
<tr>
<td>VGG16</td>
<td>528MB</td>
<td>0.715</td>
<td>0.901</td>
<td>138,357,544</td>
<td>23</td>
</tr>
<tr>
<td>VGG19</td>
<td>549MB</td>
<td>0.727</td>
<td>0.910</td>
<td>143,667,240</td>
<td>26</td>
</tr>
<tr>
<td>ResNet50</td>
<td>99MB</td>
<td>0.759</td>
<td>0.929</td>
<td>25,636,712</td>
<td>168</td>
</tr>
<tr>
<td><strong>InceptionV3</strong></td>
<td><strong>92MB</strong></td>
<td><strong>0.788</strong></td>
<td><strong>0.944</strong></td>
<td><strong>23,851,784</strong></td>
<td><strong>159</strong></td>
</tr>
<tr>
<td>IncetionResNetV2</td>
<td>215MB</td>
<td>0.804</td>
<td>0.953</td>
<td>55,873,736</td>
<td>572</td>
</tr>
<tr>
<td>MobileNet</td>
<td>17MB</td>
<td>0.665</td>
<td>0.871</td>
<td>4,253,864</td>
<td>88</td>
</tr>
</tbody>
</table>
</div>
<h3 id="数据读入"><a href="#数据读入" class="headerlink" title="数据读入"></a>数据读入</h3><p>输入读入过程主要包括几个关键任务：读取RGB均值文件，对原始数据进行预处理：图像扣取、数据增强、去通道均值、矩阵化等。</p>
<p>这块内容不是本篇重点，只能挖坑留给后续更新。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># construct the training image generator for data augmentation</span></span><br><span class="line">aug = ImageDataGenerator(rotation_range=<span class="number">20</span>, zoom_range=<span class="number">0.15</span>,</span><br><span class="line">	width_shift_range=<span class="number">0.2</span>, height_shift_range=<span class="number">0.2</span>, shear_range=<span class="number">0.15</span>,</span><br><span class="line">	horizontal_flip=<span class="keyword">True</span>, fill_mode=<span class="string">"nearest"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># load the RGB means for the training set</span></span><br><span class="line">means = json.loads(open(config.DATASET_MEAN).read())</span><br><span class="line"></span><br><span class="line"><span class="comment"># initialize the image preprocessors</span></span><br><span class="line">sp = SimplePreprocessor(<span class="number">224</span>, <span class="number">224</span>)</span><br><span class="line">pp = PatchPreprocessor(<span class="number">224</span>, <span class="number">224</span>)</span><br><span class="line">mp = MeanPreprocessor(means[<span class="string">"R"</span>], means[<span class="string">"G"</span>], means[<span class="string">"B"</span>])</span><br><span class="line">iap = ImageToArrayPreprocessor()</span><br><span class="line"></span><br><span class="line"><span class="comment"># initialize the training and validation dataset generators</span></span><br><span class="line">trainGen = HDF5DatasetGenerator(config.TRAIN_HDF5, <span class="number">64</span>, aug=aug,</span><br><span class="line">	preprocessors=[pp, mp, iap], classes=config.NUM_CLASSES)</span><br><span class="line">valGen = HDF5DatasetGenerator(config.VAL_HDF5, <span class="number">64</span>,</span><br><span class="line">	preprocessors=[sp, mp, iap], classes=config.NUM_CLASSES)</span><br></pre></td></tr></table></figure>
<h3 id="模型设计"><a href="#模型设计" class="headerlink" title="模型设计"></a>模型设计</h3><p>模型设计过程参考了Keras官方文档给出的演示，导入没有top的预训练InceptionV3模型，</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> keras.applications.inception_v3 <span class="keyword">import</span> InceptionV3</span><br><span class="line"><span class="keyword">from</span> keras.preprocessing <span class="keyword">import</span> image</span><br><span class="line"><span class="keyword">from</span> keras.models <span class="keyword">import</span> Model</span><br><span class="line"><span class="keyword">from</span> keras.layers <span class="keyword">import</span> Dense, GlobalAveragePooling2D</span><br><span class="line"><span class="keyword">from</span> keras <span class="keyword">import</span> backend <span class="keyword">as</span> K</span><br><span class="line"></span><br><span class="line"><span class="comment"># load the Inception network, ensuring the head FC layer sets are left off</span></span><br><span class="line">baseModel = InceptionV3(weights=<span class="string">"imagenet"</span>, include_top=<span class="keyword">False</span>,</span><br><span class="line">                        input_tensor=Input(shape=(<span class="number">224</span>, <span class="number">224</span>, <span class="number">3</span>)))</span><br><span class="line"><span class="comment"># initialize the new head of the network, a set of FC layers</span></span><br><span class="line"><span class="comment"># followed by a softmax classifier</span></span><br><span class="line">x = baseModel.output</span><br><span class="line">x = GlobalAveragePooling2D()(x)</span><br><span class="line">x = Dense(<span class="number">1024</span>, activation=<span class="string">'relu'</span>)(x)</span><br><span class="line">headModel = Dense(config.NUM_CLASSES, activation=<span class="string">'softmax'</span>)(x)</span><br><span class="line"></span><br><span class="line">model = Model(inputs=baseModel.input, outputs=headModel)</span><br><span class="line"></span><br><span class="line"><span class="comment"># loop over all layers in the base model and freeze them so they</span></span><br><span class="line"><span class="comment"># will *not* be updated during the training process</span></span><br><span class="line"><span class="keyword">for</span> layer <span class="keyword">in</span> baseModel.layers:</span><br><span class="line">  layer.trainable = <span class="keyword">False</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># compile our model (this needs to be done after our setting our</span></span><br><span class="line"><span class="comment"># layers to being non-trainable</span></span><br><span class="line">print(<span class="string">"[INFO] compiling model..."</span>)</span><br><span class="line">opt = SGD(lr=<span class="number">0.005</span>,momentum=<span class="number">0.9</span>)</span><br><span class="line">model.compile(loss=<span class="string">"categorical_crossentropy"</span>, optimizer=opt, metrics=[<span class="string">"accuracy"</span>])</span><br></pre></td></tr></table></figure>
<p>特别注意在迁移学习中，由于新添加增的初始权重是随机生成的，而前面大量网络参数并frozen之后不再发生变化，所以需要一个预测的过程来学习参数到一定水平，需要控制学习率在一个比较小的范围。</p>
<p>这个过程可能需要反复尝试试错。</p>
<h3 id="训练过程优化"><a href="#训练过程优化" class="headerlink" title="训练过程优化"></a>训练过程优化</h3><p>训练过程参考了《Deep Learning for Computer Vison with Python》作者给出的<code>Ctrl+C</code>训练方法，可以随时保存训练现场，调整训练率继续进行训练。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> argparse</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"><span class="comment"># construct the argument parse and parse the arguments</span></span><br><span class="line">ap = argparse.ArgumentParser()</span><br><span class="line">ap.add_argument(<span class="string">"-c"</span>, <span class="string">"--checkpoints"</span>, required=<span class="keyword">True</span>, help=<span class="string">"path to output checkpoint directory"</span>)</span><br><span class="line">ap.add_argument(<span class="string">"-m"</span>, <span class="string">"--model"</span>, type=str, help=<span class="string">"path to *specific* model checkpoint to load"</span>)</span><br><span class="line">ap.add_argument(<span class="string">"-s"</span>, <span class="string">"--start-epoch"</span>, type=int, default=<span class="number">0</span>, help=<span class="string">"epoch to restart training at"</span>)</span><br><span class="line">args = vars(ap.parse_args())</span><br><span class="line"></span><br><span class="line"><span class="comment"># set the logging level and output file</span></span><br><span class="line">logging.basicConfig(level=logging.DEBUG,</span><br><span class="line">	filename=<span class="string">"training_&#123;&#125;.log"</span>.format(args[<span class="string">"start_epoch"</span>]), filemode=<span class="string">"w"</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> args[<span class="string">"model"</span>] <span class="keyword">is</span> <span class="keyword">None</span>:</span><br><span class="line"><span class="comment"># load the VGG16 network, ensuring the head FC layer sets are left off</span></span><br><span class="line"></span><br><span class="line">	...</span><br><span class="line">    <span class="comment">## 实现上一步骤的预训练模型定义和模型预热</span></span><br><span class="line">    </span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">	print(<span class="string">"[INFO] loading &#123;&#125;..."</span>.format(args[<span class="string">"model"</span>]))</span><br><span class="line">	model = load_model(args[<span class="string">"model"</span>])</span><br><span class="line">	<span class="comment"># update the learning rate</span></span><br><span class="line">	print(<span class="string">"[INFO] old learning rate: &#123;&#125;"</span>.format(K.get_value(model.optimizer.lr)))</span><br><span class="line">	K.set_value(model.optimizer.lr, <span class="number">1e-3</span>)</span><br><span class="line">	print(<span class="string">"[INFO] new learning rate: &#123;&#125;"</span>.format(K.get_value(model.optimizer.lr)))</span><br><span class="line">    </span><br><span class="line"><span class="comment"># construct the set of callbacks</span></span><br><span class="line">callbacks = [</span><br><span class="line">	EpochCheckpoint(args[<span class="string">"checkpoints"</span>], every=<span class="number">5</span>,</span><br><span class="line">		startAt=args[<span class="string">"start_epoch"</span>]),</span><br><span class="line">	TrainingMonitor(config.FIG_PATH, jsonPath=config.JSON_PATH,</span><br><span class="line">		startAt=args[<span class="string">"start_epoch"</span>])]</span><br><span class="line"></span><br><span class="line"><span class="comment"># train the network</span></span><br><span class="line">print(<span class="string">"[INFO] training network..."</span>)</span><br><span class="line">model.fit_generator(</span><br><span class="line">	trainGen.generator(),</span><br><span class="line">	steps_per_epoch=trainGen.numImages // config.BATCH_SIZE,</span><br><span class="line">	validation_data=valGen.generator(),</span><br><span class="line">	validation_steps=valGen.numImages // config.BATCH_SIZE,</span><br><span class="line">	epochs=<span class="number">100</span>,</span><br><span class="line">	max_queue_size=config.BATCH_SIZE * <span class="number">2</span>,</span><br><span class="line">	callbacks=callbacks, verbose=<span class="number">1</span>)</span><br></pre></td></tr></table></figure>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ol>
<li><a href="https://www.pyimagesearch.com/deep-learning-computer-vision-python-book/">deep learning for computer vision with python</a></li>
</ol>

        </div>
        
        
        
    </div>
</div>









    
<div class="card card-transparent">
    <nav class="pagination is-centered" role="navigation" aria-label="pagination">
        <div class="pagination-previous">
            <a class="is-flex-grow has-text-black-ter" href="/page/10/">上一页</a>
        </div>
        <div class="pagination-next">
            <a class="is-flex-grow has-text-black-ter" href="/page/12/">下一页</a>
        </div>
        <ul class="pagination-list is-hidden-mobile">
            
            <li><a class="pagination-link has-text-black-ter" href="/">1</a></li>
            
            <li><span class="pagination-ellipsis has-text-black-ter">&hellip;</span></li>
            
            <li><a class="pagination-link has-text-black-ter" href="/page/10/">10</a></li>
            
            <li><a class="pagination-link is-current" href="/page/11/">11</a></li>
            
            <li><a class="pagination-link has-text-black-ter" href="/page/12/">12</a></li>
            
            <li><a class="pagination-link has-text-black-ter" href="/page/13/">13</a></li>
            
            <li><a class="pagination-link has-text-black-ter" href="/page/14/">14</a></li>
            
        </ul>
    </nav>
</div>
</div>
                




<div class="column is-4-tablet is-4-desktop is-3-widescreen  has-order-1 column-left ">
    
        
<div class="card widget">
    <div class="card-content">
        <nav class="level">
            <div class="level-item has-text-centered" style="flex-shrink: 1">
                <div>
                    
                    <figure class="image is-128x128 has-mb-6">
                        <img class="is-rounded" src="/images/photo.jpg" alt="Ebby">
                    </figure>
                    
                    <p class="is-size-4 is-block">
                        Ebby
                    </p>
                    
                    
                    <p class="is-size-6 is-block">
                        AI Learner
                    </p>
                    
                    
                    <p class="is-size-6 is-flex is-flex-center has-text-grey">
                        <i class="fas fa-map-marker-alt has-mr-7"></i>
                        <span>ShangHai</span>
                    </p>
                    
                </div>
            </div>
        </nav>
        <nav class="level is-mobile">
            <div class="level-item has-text-centered is-marginless">
                <div>
                    <p class="heading">
                        文章
                    </p>
                    <a href="/archives">
                        <p class="title has-text-weight-normal">
                            70
                        </p>
                    </a>
                </div>
            </div>
            <div class="level-item has-text-centered is-marginless">
                <div>
                    <p class="heading">
                        分类
                    </p>
                    <a href="/categories">
                        <p class="title has-text-weight-normal">
                            20
                        </p>
                    </a>
                </div>
            </div>
            <div class="level-item has-text-centered is-marginless">
                <div>
                    <p class="heading">
                        标签
                    </p>
                    <a href="/tags">
                        <p class="title has-text-weight-normal">
                            71
                        </p>
                    </a>
                </div>
            </div>
        </nav>
        
        <div class="level">
            <a class="level-item button is-link is-rounded" href="https://github.com/ddebby" target="_blank" rel="noopener">
                关注我</a>
        </div>
        
        
        
        <div class="level is-mobile">
            
            <a class="level-item button is-white is-marginless" target="_blank" rel="noopener"
                title="Github" href="https://github.com/ddebby">
                
                <i class="fab fa-github"></i>
                
            </a>
            
            <a class="level-item button is-white is-marginless" target="_blank" rel="noopener"
                title="Facebook" href="https://facebook.com">
                
                <i class="fab fa-facebook"></i>
                
            </a>
            
            <a class="level-item button is-white is-marginless" target="_blank" rel="noopener"
                title="Twitter" href="https://twitter.com/ebbydd">
                
                <i class="fab fa-twitter"></i>
                
            </a>
            
            <a class="level-item button is-white is-marginless" target="_blank" rel="noopener"
                title="Dribbble" href="https://dribbble.com">
                
                <i class="fab fa-dribbble"></i>
                
            </a>
            
            <a class="level-item button is-white is-marginless" target="_blank" rel="noopener"
                title="RSS" href="/">
                
                <i class="fas fa-rss"></i>
                
            </a>
            
        </div>
        
    </div>
</div>
    
        <div class="card widget">
    <div class="card-content">
        <h3 class="menu-label">
            标签云
        </h3>
        <a href="/tags/AI/" style="font-size: 17px;">AI</a> <a href="/tags/Ceph/" style="font-size: 11px;">Ceph</a> <a href="/tags/Fast-ai/" style="font-size: 10px;">Fast.ai</a> <a href="/tags/FastText/" style="font-size: 10px;">FastText</a> <a href="/tags/Git/" style="font-size: 10px;">Git</a> <a href="/tags/Ipython/" style="font-size: 10px;">Ipython</a> <a href="/tags/JupyterNotebook/" style="font-size: 10px;">JupyterNotebook</a> <a href="/tags/Keras/" style="font-size: 10px;">Keras</a> <a href="/tags/Markdown/" style="font-size: 10px;">Markdown</a> <a href="/tags/Numpy/" style="font-size: 10px;">Numpy</a> <a href="/tags/OpenCV/" style="font-size: 10px;">OpenCV</a> <a href="/tags/Pandas/" style="font-size: 10px;">Pandas</a> <a href="/tags/Prophet/" style="font-size: 10px;">Prophet</a> <a href="/tags/Python/" style="font-size: 10px;">Python</a> <a href="/tags/SARIMA/" style="font-size: 10px;">SARIMA</a> <a href="/tags/Time-Series/" style="font-size: 10px;">Time Series</a> <a href="/tags/word2vec/" style="font-size: 11px;">word2vec</a> <a href="/tags/书籍/" style="font-size: 10px;">书籍</a> <a href="/tags/云存储/" style="font-size: 11px;">云存储</a> <a href="/tags/人工智能/" style="font-size: 20px;">人工智能</a> <a href="/tags/优化/" style="font-size: 10px;">优化</a> <a href="/tags/公开课/" style="font-size: 10px;">公开课</a> <a href="/tags/博客/" style="font-size: 10px;">博客</a> <a href="/tags/原理解析/" style="font-size: 10px;">原理解析</a> <a href="/tags/可视化/" style="font-size: 10px;">可视化</a> <a href="/tags/图像分类/" style="font-size: 11px;">图像分类</a> <a href="/tags/实践/" style="font-size: 12px;">实践</a> <a href="/tags/实验/" style="font-size: 10px;">实验</a> <a href="/tags/工具/" style="font-size: 11px;">工具</a> <a href="/tags/工具使用/" style="font-size: 11px;">工具使用</a> <a href="/tags/工程实践/" style="font-size: 10px;">工程实践</a> <a href="/tags/开放数据集/" style="font-size: 11px;">开放数据集</a> <a href="/tags/开源平台/" style="font-size: 10px;">开源平台</a> <a href="/tags/强化学习/" style="font-size: 10px;">强化学习</a> <a href="/tags/心得体会/" style="font-size: 10px;">心得体会</a> <a href="/tags/总结/" style="font-size: 13px;">总结</a> <a href="/tags/感悟/" style="font-size: 11px;">感悟</a> <a href="/tags/感知机/" style="font-size: 10px;">感知机</a> <a href="/tags/技巧/" style="font-size: 12px;">技巧</a> <a href="/tags/技术/" style="font-size: 11px;">技术</a> <a href="/tags/支持向量机/" style="font-size: 10px;">支持向量机</a> <a href="/tags/教学/" style="font-size: 12px;">教学</a> <a href="/tags/数据/" style="font-size: 10px;">数据</a> <a href="/tags/数据标注/" style="font-size: 10px;">数据标注</a> <a href="/tags/数据集/" style="font-size: 10px;">数据集</a> <a href="/tags/文献/" style="font-size: 18px;">文献</a> <a href="/tags/时序数据/" style="font-size: 11px;">时序数据</a> <a href="/tags/机器学习/" style="font-size: 13px;">机器学习</a> <a href="/tags/机器视觉/" style="font-size: 16px;">机器视觉</a> <a href="/tags/模型/" style="font-size: 11px;">模型</a> <a href="/tags/正则化/" style="font-size: 10px;">正则化</a> <a href="/tags/物体识别/" style="font-size: 12px;">物体识别</a> <a href="/tags/特征抽取/" style="font-size: 10px;">特征抽取</a> <a href="/tags/目标检测/" style="font-size: 10px;">目标检测</a> <a href="/tags/知识管理/" style="font-size: 10px;">知识管理</a> <a href="/tags/神经网络/" style="font-size: 10px;">神经网络</a> <a href="/tags/笔记/" style="font-size: 15px;">笔记</a> <a href="/tags/策略/" style="font-size: 10px;">策略</a> <a href="/tags/算法/" style="font-size: 19px;">算法</a> <a href="/tags/线性回归/" style="font-size: 11px;">线性回归</a> <a href="/tags/网络复现/" style="font-size: 14px;">网络复现</a> <a href="/tags/计算机视觉/" style="font-size: 11px;">计算机视觉</a> <a href="/tags/词向量/" style="font-size: 10px;">词向量</a> <a href="/tags/词嵌入/" style="font-size: 11px;">词嵌入</a> <a href="/tags/读书笔记/" style="font-size: 14px;">读书笔记</a> <a href="/tags/资源调度/" style="font-size: 10px;">资源调度</a> <a href="/tags/迁移学习/" style="font-size: 10px;">迁移学习</a> <a href="/tags/逻辑回归/" style="font-size: 11px;">逻辑回归</a> <a href="/tags/部署/" style="font-size: 11px;">部署</a> <a href="/tags/配置/" style="font-size: 10px;">配置</a> <a href="/tags/预处理/" style="font-size: 11px;">预处理</a>
    </div>
</div>
    
        <div class="card widget">
    <div class="card-content">
        <div class="menu">
            <h3 class="menu-label">
                标签
            </h3>
            <div class="field is-grouped is-grouped-multiline">
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/AI/">
                        <span class="tag">AI</span>
                        <span class="tag is-grey">15</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Ceph/">
                        <span class="tag">Ceph</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Fast-ai/">
                        <span class="tag">Fast.ai</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/FastText/">
                        <span class="tag">FastText</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Git/">
                        <span class="tag">Git</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Ipython/">
                        <span class="tag">Ipython</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/JupyterNotebook/">
                        <span class="tag">JupyterNotebook</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Keras/">
                        <span class="tag">Keras</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Markdown/">
                        <span class="tag">Markdown</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Numpy/">
                        <span class="tag">Numpy</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/OpenCV/">
                        <span class="tag">OpenCV</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Pandas/">
                        <span class="tag">Pandas</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Prophet/">
                        <span class="tag">Prophet</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Python/">
                        <span class="tag">Python</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/SARIMA/">
                        <span class="tag">SARIMA</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Time-Series/">
                        <span class="tag">Time Series</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/word2vec/">
                        <span class="tag">word2vec</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/书籍/">
                        <span class="tag">书籍</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/云存储/">
                        <span class="tag">云存储</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/人工智能/">
                        <span class="tag">人工智能</span>
                        <span class="tag is-grey">54</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/优化/">
                        <span class="tag">优化</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/公开课/">
                        <span class="tag">公开课</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/博客/">
                        <span class="tag">博客</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/原理解析/">
                        <span class="tag">原理解析</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/可视化/">
                        <span class="tag">可视化</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/图像分类/">
                        <span class="tag">图像分类</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/实践/">
                        <span class="tag">实践</span>
                        <span class="tag is-grey">3</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/实验/">
                        <span class="tag">实验</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/工具/">
                        <span class="tag">工具</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/工具使用/">
                        <span class="tag">工具使用</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/工程实践/">
                        <span class="tag">工程实践</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/开放数据集/">
                        <span class="tag">开放数据集</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/开源平台/">
                        <span class="tag">开源平台</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/强化学习/">
                        <span class="tag">强化学习</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/心得体会/">
                        <span class="tag">心得体会</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/总结/">
                        <span class="tag">总结</span>
                        <span class="tag is-grey">4</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/感悟/">
                        <span class="tag">感悟</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/感知机/">
                        <span class="tag">感知机</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/技巧/">
                        <span class="tag">技巧</span>
                        <span class="tag is-grey">3</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/技术/">
                        <span class="tag">技术</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/支持向量机/">
                        <span class="tag">支持向量机</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/教学/">
                        <span class="tag">教学</span>
                        <span class="tag is-grey">3</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/数据/">
                        <span class="tag">数据</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/数据标注/">
                        <span class="tag">数据标注</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/数据集/">
                        <span class="tag">数据集</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/文献/">
                        <span class="tag">文献</span>
                        <span class="tag is-grey">25</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/时序数据/">
                        <span class="tag">时序数据</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/机器学习/">
                        <span class="tag">机器学习</span>
                        <span class="tag is-grey">4</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/机器视觉/">
                        <span class="tag">机器视觉</span>
                        <span class="tag is-grey">10</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/模型/">
                        <span class="tag">模型</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/正则化/">
                        <span class="tag">正则化</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/物体识别/">
                        <span class="tag">物体识别</span>
                        <span class="tag is-grey">3</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/特征抽取/">
                        <span class="tag">特征抽取</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/目标检测/">
                        <span class="tag">目标检测</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/知识管理/">
                        <span class="tag">知识管理</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/神经网络/">
                        <span class="tag">神经网络</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/笔记/">
                        <span class="tag">笔记</span>
                        <span class="tag is-grey">6</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/策略/">
                        <span class="tag">策略</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/算法/">
                        <span class="tag">算法</span>
                        <span class="tag is-grey">35</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/线性回归/">
                        <span class="tag">线性回归</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/网络复现/">
                        <span class="tag">网络复现</span>
                        <span class="tag is-grey">5</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/计算机视觉/">
                        <span class="tag">计算机视觉</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/词向量/">
                        <span class="tag">词向量</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/词嵌入/">
                        <span class="tag">词嵌入</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/读书笔记/">
                        <span class="tag">读书笔记</span>
                        <span class="tag is-grey">5</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/资源调度/">
                        <span class="tag">资源调度</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/迁移学习/">
                        <span class="tag">迁移学习</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/逻辑回归/">
                        <span class="tag">逻辑回归</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/部署/">
                        <span class="tag">部署</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/配置/">
                        <span class="tag">配置</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/预处理/">
                        <span class="tag">预处理</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
            </div>
        </div>
    </div>
</div>
    
    
        <div class="column-right-shadow is-hidden-widescreen is-sticky">
        
            
        
            <div class="card widget">
    <div class="card-content">
        <h3 class="menu-label">
            最新文章
        </h3>
        
        <article class="media">
            
            <a href="/2021/02/05/那些效率提升的工具与方法/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="那些效率提升的工具与方法">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2021-02-05T14:10:00.000Z">2021-02-05</time></div>
                    <a href="/2021/02/05/那些效率提升的工具与方法/" class="title has-link-black-ter is-size-6 has-text-weight-normal">那些效率提升的工具与方法</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/总结/">总结</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2021/01/28/Reinforcement-Learning-Tips-and-Tricks/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/../qnsource/blog/rl.jpg" alt="Reinforcement Learning:Tips and Tricks">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2021-01-28T02:56:30.000Z">2021-01-28</time></div>
                    <a href="/2021/01/28/Reinforcement-Learning-Tips-and-Tricks/" class="title has-link-black-ter is-size-6 has-text-weight-normal">Reinforcement Learning:Tips and Tricks</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/强化学习/">强化学习</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2020/11/19/pytorch模型的导出与部署/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="pytorch模型的导出与部署">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2020-11-19T05:00:18.000Z">2020-11-19</time></div>
                    <a href="/2020/11/19/pytorch模型的导出与部署/" class="title has-link-black-ter is-size-6 has-text-weight-normal">pytorch模型的导出与部署</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/深度学习/">深度学习</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2020/05/04/读书笔记-《神经网络与深度学习》/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/../qnsource/blog/qxp.jpg" alt="读书笔记-《神经网络与深度学习》">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2020-05-04T13:50:21.000Z">2020-05-04</time></div>
                    <a href="/2020/05/04/读书笔记-《神经网络与深度学习》/" class="title has-link-black-ter is-size-6 has-text-weight-normal">读书笔记-《神经网络与深度学习》</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/深度学习/">深度学习</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2020/04/19/计算机视觉目标检测研究札记/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/../qnsource/banner/02.jpg" alt="计算机视觉目标检测研究札记">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2020-04-19T07:10:45.000Z">2020-04-19</time></div>
                    <a href="/2020/04/19/计算机视觉目标检测研究札记/" class="title has-link-black-ter is-size-6 has-text-weight-normal">计算机视觉目标检测研究札记</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/深度学习/">深度学习</a>
                    </p>
                </div>
            </div>
        </article>
        
    </div>
</div>
        
            <div class="card widget">
    <div class="card-content">
        <div class="menu">
        <h3 class="menu-label">
            归档
        </h3>
        <ul class="menu-list">
        
        <li>
            <a class="level is-marginless" href="/archives/2021/02/">
                <span class="level-start">
                    <span class="level-item">二月 2021</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2021/01/">
                <span class="level-start">
                    <span class="level-item">一月 2021</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/11/">
                <span class="level-start">
                    <span class="level-item">十一月 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/05/">
                <span class="level-start">
                    <span class="level-item">五月 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/04/">
                <span class="level-start">
                    <span class="level-item">四月 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/03/">
                <span class="level-start">
                    <span class="level-item">三月 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/05/">
                <span class="level-start">
                    <span class="level-item">五月 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/02/">
                <span class="level-start">
                    <span class="level-item">二月 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/01/">
                <span class="level-start">
                    <span class="level-item">一月 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/12/">
                <span class="level-start">
                    <span class="level-item">十二月 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">5</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/11/">
                <span class="level-start">
                    <span class="level-item">十一月 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">4</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/09/">
                <span class="level-start">
                    <span class="level-item">九月 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/08/">
                <span class="level-start">
                    <span class="level-item">八月 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">7</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/07/">
                <span class="level-start">
                    <span class="level-item">七月 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">7</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/06/">
                <span class="level-start">
                    <span class="level-item">六月 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/05/">
                <span class="level-start">
                    <span class="level-item">五月 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">8</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/04/">
                <span class="level-start">
                    <span class="level-item">四月 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">11</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/03/">
                <span class="level-start">
                    <span class="level-item">三月 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">8</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/02/">
                <span class="level-start">
                    <span class="level-item">二月 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/01/">
                <span class="level-start">
                    <span class="level-item">一月 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/02/">
                <span class="level-start">
                    <span class="level-item">二月 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        </ul>
        </div>
    </div>
</div>
        
        </div>
    
</div>

                




<div class="column is-4-tablet is-4-desktop is-3-widescreen is-hidden-touch is-hidden-desktop-only has-order-3 column-right is-sticky">
    
        
    
        <div class="card widget">
    <div class="card-content">
        <h3 class="menu-label">
            最新文章
        </h3>
        
        <article class="media">
            
            <a href="/2021/02/05/那些效率提升的工具与方法/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="那些效率提升的工具与方法">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2021-02-05T14:10:00.000Z">2021-02-05</time></div>
                    <a href="/2021/02/05/那些效率提升的工具与方法/" class="title has-link-black-ter is-size-6 has-text-weight-normal">那些效率提升的工具与方法</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/总结/">总结</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2021/01/28/Reinforcement-Learning-Tips-and-Tricks/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/../qnsource/blog/rl.jpg" alt="Reinforcement Learning:Tips and Tricks">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2021-01-28T02:56:30.000Z">2021-01-28</time></div>
                    <a href="/2021/01/28/Reinforcement-Learning-Tips-and-Tricks/" class="title has-link-black-ter is-size-6 has-text-weight-normal">Reinforcement Learning:Tips and Tricks</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/强化学习/">强化学习</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2020/11/19/pytorch模型的导出与部署/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="pytorch模型的导出与部署">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2020-11-19T05:00:18.000Z">2020-11-19</time></div>
                    <a href="/2020/11/19/pytorch模型的导出与部署/" class="title has-link-black-ter is-size-6 has-text-weight-normal">pytorch模型的导出与部署</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/深度学习/">深度学习</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2020/05/04/读书笔记-《神经网络与深度学习》/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/../qnsource/blog/qxp.jpg" alt="读书笔记-《神经网络与深度学习》">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2020-05-04T13:50:21.000Z">2020-05-04</time></div>
                    <a href="/2020/05/04/读书笔记-《神经网络与深度学习》/" class="title has-link-black-ter is-size-6 has-text-weight-normal">读书笔记-《神经网络与深度学习》</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/深度学习/">深度学习</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2020/04/19/计算机视觉目标检测研究札记/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/../qnsource/banner/02.jpg" alt="计算机视觉目标检测研究札记">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2020-04-19T07:10:45.000Z">2020-04-19</time></div>
                    <a href="/2020/04/19/计算机视觉目标检测研究札记/" class="title has-link-black-ter is-size-6 has-text-weight-normal">计算机视觉目标检测研究札记</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/深度学习/">深度学习</a>
                    </p>
                </div>
            </div>
        </article>
        
    </div>
</div>
    
        <div class="card widget">
    <div class="card-content">
        <div class="menu">
        <h3 class="menu-label">
            归档
        </h3>
        <ul class="menu-list">
        
        <li>
            <a class="level is-marginless" href="/archives/2021/02/">
                <span class="level-start">
                    <span class="level-item">二月 2021</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2021/01/">
                <span class="level-start">
                    <span class="level-item">一月 2021</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/11/">
                <span class="level-start">
                    <span class="level-item">十一月 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/05/">
                <span class="level-start">
                    <span class="level-item">五月 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/04/">
                <span class="level-start">
                    <span class="level-item">四月 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2020/03/">
                <span class="level-start">
                    <span class="level-item">三月 2020</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/05/">
                <span class="level-start">
                    <span class="level-item">五月 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/02/">
                <span class="level-start">
                    <span class="level-item">二月 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/01/">
                <span class="level-start">
                    <span class="level-item">一月 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/12/">
                <span class="level-start">
                    <span class="level-item">十二月 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">5</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/11/">
                <span class="level-start">
                    <span class="level-item">十一月 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">4</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/09/">
                <span class="level-start">
                    <span class="level-item">九月 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/08/">
                <span class="level-start">
                    <span class="level-item">八月 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">7</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/07/">
                <span class="level-start">
                    <span class="level-item">七月 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">7</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/06/">
                <span class="level-start">
                    <span class="level-item">六月 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/05/">
                <span class="level-start">
                    <span class="level-item">五月 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">8</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/04/">
                <span class="level-start">
                    <span class="level-item">四月 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">11</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/03/">
                <span class="level-start">
                    <span class="level-item">三月 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">8</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/02/">
                <span class="level-start">
                    <span class="level-item">二月 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2018/01/">
                <span class="level-start">
                    <span class="level-item">一月 2018</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">1</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/02/">
                <span class="level-start">
                    <span class="level-item">二月 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        </ul>
        </div>
    </div>
</div>
    
    
</div>

            </div>
        </div>
    </section>
    <footer class="footer">
    <div class="container">
        <div class="level">
            <div class="level-start has-text-centered-mobile">
                <a class="footer-logo is-block has-mb-6" href="/">
                
                    <img src="/images/logo02.png" alt="Ebby&#39;s Notes" height="28">
                
                </a>
                <p class="is-size-7">
                &copy; 2021 Ebby DD&nbsp;
                Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> & <a
                        href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a>  沪ICP备20005404号
                
                </p>
            </div>
            <div class="level-end">
            
                <div class="field has-addons is-flex-center-mobile has-mt-5-mobile is-flex-wrap is-flex-middle">
                
                <p class="control">
                    <a class="button is-white is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/">
                        
                        <i class="fab fa-creative-commons"></i>
                        
                    </a>
                </p>
                
                <p class="control">
                    <a class="button is-white is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/">
                        
                        <i class="fab fa-creative-commons-by"></i>
                        
                    </a>
                </p>
                
                </div>
            
            </div>
        </div>
    </div>
</footer>
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script>
<script>moment.locale("zh-CN");</script>


<script>
var IcarusThemeSettings = {
    site: {
        url: 'http://blog.a-stack.com',
        external_link: {"enable":true,"exclude":[]}
    },
    article: {
        highlight: {
            clipboard: true,
            fold: 'unfolded'
        }
    }
};
</script>


<script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script>





<script src="/js/animation.js"></script>



<script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script>
<script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script>
<script src="/js/gallery.js" defer></script>



<div id="outdated">
    <h6>Your browser is out-of-date!</h6>
    <p>Update your browser to view this website correctly. <a id="btnUpdateBrowser" href="http://outdatedbrowser.com/">Update
            my browser now </a></p>
    <p class="last"><a href="#" id="btnCloseUpdateBrowser" title="Close">&times;</a></p>
</div>
<script src="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.js" defer></script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        outdatedBrowser({
            bgColor: '#f25648',
            color: '#ffffff',
            lowerThan: 'flex'
        });
    });
</script>


<script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.5/unpacked/MathJax.js?config=TeX-MML-AM_CHTML" defer></script>
<script>
document.addEventListener('DOMContentLoaded', function () {
    MathJax.Hub.Config({
        'HTML-CSS': {
            matchFontHeight: false
        },
        SVG: {
            matchFontHeight: false
        },
        CommonHTML: {
            matchFontHeight: false
        },
        tex2jax: {
            inlineMath: [
                ['$','$'],
                ['\\(','\\)']
            ]
        }
    });
});
</script>


<a id="back-to-top" title="回到顶端" href="javascript:;">
    <i class="fas fa-chevron-up"></i>
</a>
<script src="/js/back-to-top.js" defer></script>














<script src="/js/main.js" defer></script>

    
    <div class="searchbox ins-search">
    <div class="searchbox-container ins-search-container">
        <div class="searchbox-input-wrapper">
            <input type="text" class="searchbox-input ins-search-input" placeholder="想要查找什么..." />
            <span class="searchbox-close ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="searchbox-result-wrapper ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
    (function (window) {
        var INSIGHT_CONFIG = {
            TRANSLATION: {
                POSTS: '文章',
                PAGES: '页面',
                CATEGORIES: '分类',
                TAGS: '标签',
                UNTITLED: '(无标题)',
            },
            CONTENT_URL: '/content.json',
        };
        window.INSIGHT_CONFIG = INSIGHT_CONFIG;
    })(window);
</script>
<script src="/js/insight.js" defer></script>
<link rel="stylesheet" href="/css/search.css">
<link rel="stylesheet" href="/css/insight.css">
    
</body>
</html>