<!DOCTYPE html>
<html  lang="zh">
<head>
    <meta charset="utf-8" />

<meta name="generator" content="Hexo 3.9.0" />

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />

<title>pytorchæ¨¡å‹çš„å¯¼å‡ºä¸éƒ¨ç½² - Ebby&#39;s Notes</title>


    <meta name="description" content="æ‘˜è¦ï¼š">
<meta name="keywords" content="äººå·¥æ™ºèƒ½,æ·±åº¦å­¦ä¹ ,æŠ€æœ¯,ç®—æ³•">
<meta property="og:type" content="article">
<meta property="og:title" content="pytorchæ¨¡å‹çš„å¯¼å‡ºä¸éƒ¨ç½²">
<meta property="og:url" content="http://blog.a-stack.com/2020/11/19/pytorchæ¨¡å‹çš„å¯¼å‡ºä¸éƒ¨ç½²/index.html">
<meta property="og:site_name" content="Ebby&#39;s Notes">
<meta property="og:description" content="æ‘˜è¦ï¼š">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="http://blog.a-stack.com/qnsource/blog/cvat.jpg">
<meta property="og:updated_time" content="2020-11-27T05:33:41.838Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="pytorchæ¨¡å‹çš„å¯¼å‡ºä¸éƒ¨ç½²">
<meta name="twitter:description" content="æ‘˜è¦ï¼š">
<meta name="twitter:image" content="http://blog.a-stack.com/qnsource/blog/cvat.jpg">







<link rel="icon" href="/images/favicon.svg">


<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.7.2/css/bulma.css">
<link rel="stylesheet" href="https://cdn.bootcss.com/font-awesome/5.4.1/css/all.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Ubuntu:400,600|Source+Code+Pro">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/idea.css">


    
    
<style>body>.footer,body>.navbar,body>.section{opacity:0}</style>

    
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css">

    
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.css">

    
    
    
    
<link rel="stylesheet" href="/css/back-to-top.css">

    
    
    
    <script>
var _hmt = _hmt || [];
(function() {
    var hm = document.createElement("script");
    hm.src = "//hm.baidu.com/hm.js?684368b6943d7a5b6689dba5e7bf30ad";
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(hm, s);
})();
</script>
    
    
    
    <link rel="stylesheet" href="/css/progressbar.css">
<script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script>
    
    
    


<link rel="stylesheet" href="/css/style.css">
</head>
<body class="is-2-column">
    <nav class="navbar navbar-main">
    <div class="container">
        <div class="navbar-brand is-flex-center">
            <a class="navbar-item navbar-logo" href="/">
            
                <img src="/images/logo02.png" alt="pytorchæ¨¡å‹çš„å¯¼å‡ºä¸éƒ¨ç½²" height="28">
            
            </a>
        </div>
        <div class="navbar-menu">
            
            <div class="navbar-start">
                
                <a class="navbar-item"
                href="/">ä¸»é¡µ</a>
                
                <a class="navbar-item"
                href="/archives">å½’æ¡£</a>
                
                <a class="navbar-item"
                href="/categories">åˆ†ç±»</a>
                
                <a class="navbar-item"
                href="/tags">æ ‡ç­¾</a>
                
                <a class="navbar-item"
                href="/reading">è¯»ä¹¦</a>
                
                <a class="navbar-item"
                href="/resources">èµ„æº</a>
                
                <a class="navbar-item"
                href="/notebooks">ğŸ“</a>
                
                <a class="navbar-item"
                href="/about">å…³äº</a>
                
            </div>
            
            <div class="navbar-end">
                
                
                <a class="navbar-item is-hidden-tablet catalogue" title="ç›®å½•" href="javascript:;">
                    <i class="fas fa-list-ul"></i>
                </a>
                
                
                <a class="navbar-item search" title="æœç´¢" href="javascript:;">
                    <i class="fas fa-search"></i>
                </a>
                
            </div>
        </div>
    </div>
</nav>
    
    <section class="section">
        <div class="container">
            <div class="columns">
                <div class="column is-8-tablet is-8-desktop is-9-widescreen has-order-2 column-main">
<div class="card">
    
    <div class="card-image">
        <span  class="image is-7by1">
            <img class="thumbnail" src="/../qnsource/blog/cvat.jpg" alt="pytorchæ¨¡å‹çš„å¯¼å‡ºä¸éƒ¨ç½²">
        </span>
    </div>
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                

                <time class="level-item has-text-grey" datetime="2020-11-19T05:00:18.000Z">2020-11-19</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/æ·±åº¦å­¦ä¹ /">æ·±åº¦å­¦ä¹ </a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    21 åˆ†é’Ÿ è¯»å®Œ (å¤§çº¦ 3222 ä¸ªå­—)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <i class="fas fa-angle-double-right"></i>pytorchæ¨¡å‹çš„å¯¼å‡ºä¸éƒ¨ç½²
            
        </h1>
        <div class="content">
            <p><strong>æ‘˜è¦ï¼š</strong></p>
<a id="more"></a>
<h2 id="pytorchæ¨¡å‹çš„å¯¼å‡º"><a href="#pytorchæ¨¡å‹çš„å¯¼å‡º" class="headerlink" title="pytorchæ¨¡å‹çš„å¯¼å‡º"></a>pytorchæ¨¡å‹çš„å¯¼å‡º</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¿å­˜ç½‘ç»œç»“æ„å’Œå‚æ•°</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ–¹æ³•1ï¼šä¿å­˜ç½‘ç»œç»“æ„å’Œå‚æ•°</span></span><br><span class="line">PATH = <span class="string">'./cifar_net.pth'</span></span><br><span class="line">torch.save(net, PATH)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ–¹æ³•2ï¼šä¿å­˜ç½‘ç»œå‚æ•°</span></span><br><span class="line">PATH = <span class="string">'./cifar_net.pth'</span></span><br><span class="line">torch.save(net.state_dict(), PATH)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ–¹æ³•3ï¼šå¯¼å‡ºç½‘ç»œåˆ°ONNX</span></span><br><span class="line">dummy_input = torch.randn(<span class="number">1</span>, <span class="number">3</span>, <span class="number">32</span>, <span class="number">32</span>).to(device)</span><br><span class="line">torch.onnx.export(net, dummy_input, <span class="string">"torch.onnx"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ–¹æ³•4ï¼šä¿å­˜ç½‘ç»œä½TORCHSCRIPT</span></span><br><span class="line">dummy_input = torch.randn(<span class="number">1</span>, <span class="number">3</span>, <span class="number">32</span>, <span class="number">32</span>).to(device)</span><br><span class="line">traced_cell = torch.jit.trace(net, dummy_input)</span><br><span class="line">traced_cell.save(<span class="string">"tests.pth"</span>)</span><br></pre></td></tr></table></figure>
<h3 id="å¯¼å‡ºæ¨¡å‹çš„æ£€æµ‹"><a href="#å¯¼å‡ºæ¨¡å‹çš„æ£€æµ‹" class="headerlink" title="å¯¼å‡ºæ¨¡å‹çš„æ£€æµ‹"></a>å¯¼å‡ºæ¨¡å‹çš„æ£€æµ‹</h3><blockquote>
<p>But before verifying the modelâ€™s output with ONNX Runtime, we will check the ONNX model with ONNXâ€™s API. First, <code>onnx.load(&quot;super_resolution.onnx&quot;)</code> will load the saved model and will output a onnx.ModelProto structure (a top-level file/container format for bundling a ML model. For more information <a href="https://github.com/onnx/onnx/blob/master/onnx/onnx.proto">onnx.proto documentation</a>.). Then, <code>onnx.checker.check_model(onnx_model)</code> will verify the modelâ€™s structure and confirm that the model has a valid schema. The validity of the ONNX graph is verified by checking the modelâ€™s version, the graphâ€™s structure, as well as the nodes and their inputs and outputs.</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> onnx</span><br><span class="line"></span><br><span class="line">onnx_model = onnx.load(<span class="string">"super_resolution.onnx"</span>)</span><br><span class="line">onnx.checker.check_model(onnx_model)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> onnxruntime</span><br><span class="line"></span><br><span class="line">ort_session = onnxruntime.InferenceSession(<span class="string">"super_resolution.onnx"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Input to the model</span></span><br><span class="line">batch_size = <span class="number">1</span></span><br><span class="line">x = torch.randn(batch_size, <span class="number">3</span>, <span class="number">512</span>, <span class="number">512</span>, requires_grad=<span class="keyword">True</span>)</span><br><span class="line">torch_out = learn.model(x)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">to_numpy</span><span class="params">(tensor)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> tensor.detach().cpu().numpy() <span class="keyword">if</span> tensor.requires_grad <span class="keyword">else</span> tensor.cpu().numpy()</span><br><span class="line"></span><br><span class="line"><span class="comment"># compute ONNX Runtime output prediction</span></span><br><span class="line">ort_inputs = &#123;ort_session.get_inputs()[<span class="number">0</span>].name: to_numpy(x)&#125;</span><br><span class="line">ort_outs = ort_session.run(<span class="keyword">None</span>, ort_inputs)</span><br><span class="line"></span><br><span class="line"><span class="comment"># compare ONNX Runtime and PyTorch results</span></span><br><span class="line">np.testing.assert_allclose(to_numpy(torch_out), ort_outs[<span class="number">0</span>], rtol=<span class="number">1e-03</span>, atol=<span class="number">1e-05</span>)</span><br><span class="line"></span><br><span class="line">print(<span class="string">"Exported model has been tested with ONNXRuntime, and the result looks good!"</span>)</span><br></pre></td></tr></table></figure>
<h2 id="æ¨¡å‹åŠ è½½"><a href="#æ¨¡å‹åŠ è½½" class="headerlink" title="æ¨¡å‹åŠ è½½"></a>æ¨¡å‹åŠ è½½</h2><h3 id="ä½¿ç”¨opencvåŠ è½½ONNXæ¨¡å‹"><a href="#ä½¿ç”¨opencvåŠ è½½ONNXæ¨¡å‹" class="headerlink" title="ä½¿ç”¨opencvåŠ è½½ONNXæ¨¡å‹"></a>ä½¿ç”¨opencvåŠ è½½ONNXæ¨¡å‹</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;opencv2/highgui.hpp&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> cv;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> cv::dnn;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;fstream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    String modelFile = <span class="string">"D://fastai.onnx"</span>;</span><br><span class="line">    String imageFile = <span class="string">"D://1.jpg"</span>;</span><br><span class="line"></span><br><span class="line">    dnn::Net net = cv::dnn::readNetFromONNX(modelFile); <span class="comment">//è¯»å–ç½‘ç»œå’Œå‚æ•°</span></span><br><span class="line">   </span><br><span class="line">    Mat image = imread(imageFile); <span class="comment">// è¯»å–æµ‹è¯•å›¾ç‰‡</span></span><br><span class="line">    cv::cvtColor(image, image, cv::COLOR_BGR2RGB);</span><br><span class="line">    image.convertTo(image, CV_32FC3, <span class="number">1.0f</span> / <span class="number">255.0f</span>);</span><br><span class="line"> </span><br><span class="line">    Mat inputBolb = blobFromImage(image, <span class="number">0.00390625f</span>, Size(<span class="number">512</span>, <span class="number">512</span>), Scalar(), <span class="literal">false</span>, <span class="literal">false</span>); <span class="comment">//å°†å›¾åƒè½¬åŒ–ä¸ºæ­£ç¡®è¾“å…¥æ ¼å¼</span></span><br><span class="line"></span><br><span class="line">    net.setInput(inputBolb); <span class="comment">//è¾“å…¥å›¾åƒ</span></span><br><span class="line"></span><br><span class="line">    Mat result = net.forward(); <span class="comment">//å‰å‘è®¡ç®—</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; result &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">char</span> j;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; j;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="ä½¿ç”¨libtorch"><a href="#ä½¿ç”¨libtorch" class="headerlink" title="ä½¿ç”¨libtorch"></a>ä½¿ç”¨libtorch</h3><ol>
<li>libtorchä¸‹è½½</li>
<li>opencvä¸‹è½½</li>
<li>visual studioç¯å¢ƒå‡†å¤‡</li>
<li>æµ‹è¯•</li>
</ol>
<h3 id="DLLçš„ç”Ÿæˆä¸æµ‹è¯•"><a href="#DLLçš„ç”Ÿæˆä¸æµ‹è¯•" class="headerlink" title="DLLçš„ç”Ÿæˆä¸æµ‹è¯•"></a>DLLçš„ç”Ÿæˆä¸æµ‹è¯•</h3><h4 id="è§£å†³cudaä¸è¯†åˆ«çš„é—®é¢˜"><a href="#è§£å†³cudaä¸è¯†åˆ«çš„é—®é¢˜" class="headerlink" title="è§£å†³cudaä¸è¯†åˆ«çš„é—®é¢˜"></a>è§£å†³cudaä¸è¯†åˆ«çš„é—®é¢˜</h4><p>Windows10ç³»ç»Ÿä¸‹ä½¿ç”¨LibTorch 1.5.0ï¼Œä½¿ç”¨Visual Studioè¿›è¡ŒC++å¼€å‘æ—¶ï¼Œ</p>
<p>Torch::cuda::is_available()è¿”å›å€¼ä¸ºFalseçš„è§£å†³åŠæ³•ï¼š</p>
<p>åœ¨<code>é“¾æ¥å™¨ä¸­ -&gt; å‘½ä»¤è¡Œ -&gt; å…¶ä»–é€‰é¡¹</code>:</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/INCLUDE:?<span class="symbol">warp_size@</span><span class="symbol">cuda@</span><span class="symbol">at@</span><span class="meta">@YAHXZ</span></span><br></pre></td></tr></table></figure>
<h2 id="Visual-Studioé…ç½®"><a href="#Visual-Studioé…ç½®" class="headerlink" title="Visual Studioé…ç½®"></a>Visual Studioé…ç½®</h2><h4 id="1-é™„åŠ åŒ…å«ç›®å½•çš„é…ç½®"><a href="#1-é™„åŠ åŒ…å«ç›®å½•çš„é…ç½®" class="headerlink" title="1. é™„åŠ åŒ…å«ç›®å½•çš„é…ç½®"></a>1. é™„åŠ åŒ…å«ç›®å½•çš„é…ç½®</h4><p><code>é¡¹ç›®å±æ€§</code>â€”<code>c/c++</code>â€”<code>é™„åŠ åŒ…å«ç›®å½•</code>,æ·»åŠ å¦‚ä¸‹ä¿¡æ¯ï¼š</p>
<figure class="highlight taggerscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">D:<span class="symbol">\6</span>6.code<span class="symbol">\9</span>09.torchScript<span class="symbol">\l</span>ibtorchCuda<span class="symbol">\l</span>ibtorch<span class="symbol">\i</span>nclude           D:<span class="symbol">\6</span>6.code<span class="symbol">\9</span>09.torchScript<span class="symbol">\l</span>ibtorchCuda<span class="symbol">\l</span>ibtorch<span class="symbol">\i</span>nclude<span class="symbol">\t</span>orch<span class="symbol">\c</span>src<span class="symbol">\a</span>pi<span class="symbol">\i</span>nclude</span><br><span class="line">D:<span class="symbol">\6</span>6.code<span class="symbol">\9</span>09.torchScript<span class="symbol">\o</span>pencv<span class="symbol">\b</span>uild<span class="symbol">\i</span>nclude</span><br></pre></td></tr></table></figure>
<p><img src="/2020/11/19/pytorchæ¨¡å‹çš„å¯¼å‡ºä¸éƒ¨ç½²/Tue, 24 Nov 2020 104414.png" alt="å…° 0  çš„ çš„ 00 åˆ°  D:\&quot;code\909.torchScript\exâ€¢mpIeâ€¢app\Iibtorch\incIudâ€¢ ï¼š D:\66.code\909.torchScript\opencv\build\incIude  è¿‡ å®ƒ 0 è†£ å¼  æ”¯ ä»… ä¿„ å¯ ä»£ ç  æ¶¯ è¿‡  å…¬ è™ å¾ è¿ è¡Œ æ—¶ æŸ¥  0 äº æ‰ˆ åŠ¨ ç‰ˆ æƒ å“  ç­‰ 3VW3 ï¼‰  é¯ å‰ è§† ä¸º 0  ç¿’ é›ª æ‰€ äº‹  åˆ— å„„ æ¯ çŸ¥ i å›› n ã€‚ â€œ ï¼ˆ è±³  æ˜¯ VsdD  SDL åˆ°  å¯ ç”¨ å°¥ å€ è“€ æ™¯ é“³ ï¼ˆ é€¾ æ€§ ï¼‰  0 å…¥ çš„ IOL  ndo å…ƒ æ•¸  åŠ  åŒ… å« ç›®  æŒ‡ å®š ä¸€ ä¸ª å¤š ä¸ª è¦ æ·» åŠ  åˆ° 0 è·¯ å¾„ åŠ çš„ ç›® å½• ï¼š å½“ åˆ° å½• ä¸ æ­¢ ä¸€ çœ å¯¹ ã€‚ ç”¨ åˆ† åˆ† å„€ ï¼  ä¼Š æ†® å¾„ å‹‡  XM L ç«‹ ç”Ÿ å™¨ "></p>
<h4 id="2-é“¾æ¥å™¨é…ç½®"><a href="#2-é“¾æ¥å™¨é…ç½®" class="headerlink" title="2. é“¾æ¥å™¨é…ç½®"></a>2. é“¾æ¥å™¨é…ç½®</h4><figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">D:</span>\<span class="number">66</span>.code\<span class="number">909</span>.torchScript\opencv\build\x64\vc15\<span class="class"><span class="keyword">lib</span>;</span></span><br><span class="line"><span class="symbol">D:</span>\<span class="number">66</span>.code\<span class="number">909</span>.torchScript\libtorchCuda\libtorch\<span class="class"><span class="keyword">lib</span>;</span></span><br></pre></td></tr></table></figure>
<p><img src="/2020/11/19/pytorchæ¨¡å‹çš„å¯¼å‡ºä¸éƒ¨ç½²/config-link.png" alt="0 äºº çš„ IOL  0d0 ã€ â€œ å…ƒ å¦‚  ã€‹ å·¥ ä¸”  ã€‹ è®½ ML ç«‹ æ¡£ ç”Ÿ è—  é® å‡º ç«‹  æ˜¯ ç¤º å¯ åŠ¨ ç‰ˆ æƒ æ ‡ å¿—  0 è‹¤ å¯¼ å…¥  æ²³ ç›® æ™¯  ä½¿ ç”² è¿‡ é˜ª é¡¹ çš„ å…¥  ä¸Š 011 å­¬  å¼º åˆ¶ ä» å‡º  åˆ› æ´¥ å¯ é‚£ ä¿® å³¡ 0  / OUT ç¬¾ 0 å¯ è™« å†™ é€† åˆ› è¿‡ çš„ ç¨‹ åº çš„ é»˜ è®¤ 0 0 è‹¤ ï¼  OutDir) åœ° 3 å›› é˜ å›› e è¿˜  å  VINCREMENTALâ€¢NO)  0G0  D:Wcode\909.torchScript\opencv\build\x64\vc1S\Iib;D:Wcode\909.torchScript\example-â€¢pp\libtord&#39;\lib; "></p>
<p><code>é“¾æ¥å™¨</code> â€”<code>è¾“å…¥</code>:</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">opencv_world450.lib</span><br><span class="line">asmjit.lib</span><br><span class="line">c10.lib</span><br><span class="line">c10_cuda.lib</span><br><span class="line">caffe2_detectron_ops_gpu.lib</span><br><span class="line">caffe2_module_test_dynamic.lib</span><br><span class="line">caffe2_nvrtc.lib</span><br><span class="line">clog.lib</span><br><span class="line">cpuinfo.lib</span><br><span class="line">fbgemm.lib</span><br><span class="line">libprotobuf.lib</span><br><span class="line">libprotobuf-lite.lib</span><br><span class="line">libprotoc.lib</span><br><span class="line">mkldnn.lib</span><br><span class="line">torch_cpu.lib</span><br><span class="line">torch_cuda.lib</span><br><span class="line">torch.lib</span><br></pre></td></tr></table></figure>
<p><strong>æµ‹è¯•ä»£ç </strong></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;torch/torch.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	torch::Tensor tensor = torch::eye(<span class="number">3</span>);</span><br><span class="line">	<span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; tensor.cuda() &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="æŠ€å·§"><a href="#æŠ€å·§" class="headerlink" title="æŠ€å·§"></a>æŠ€å·§</h2><ol>
<li><p>ä½¿ç”¨<code>dumpbin</code>è¿›è¡Œä¾èµ–çš„æŸ¥çœ‹</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dumpbin /dependents xxx.dll æˆ–è€… xxx.exe</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>   <img src="/2020/11/19/pytorchæ¨¡å‹çš„å¯¼å‡ºä¸éƒ¨ç½²/image-20201119144802243.png" alt="image-20201119144802243"></p>
<p><img src="/2020/11/19/pytorchæ¨¡å‹çš„å¯¼å‡ºä¸éƒ¨ç½²/image-20201119145027954.png" alt="image-20201119145027954"></p>
<ol>
<li><p>é€šè¿‡é…ç½®ç¯å¢ƒå˜é‡ï¼Œå‡å°‘å¤åˆ¶<code>dll</code>çš„ç©ºé—´æˆæœ¬</p>
<p>å±æ€§é¡µâ€”é…ç½®å±æ€§â€”è°ƒè¯•â€”ç¯å¢ƒ</p>
<p>è®¾ç½®dllæ–‡ä»¶çš„ç¯å¢ƒå˜é‡ï¼Œ</p>
<p><code>PATH=D:\software\gnsoftware\pyTorch\libtorch-win-shared-with-deps-debug-1.5.0\libtorch\lib;%PATH%</code></p>
<p>ï¼ˆä¹‹å‰æˆ‘ä¸€èˆ¬æ˜¯æŠŠé‚£ä¸€å †dllæ–‡ä»¶æ‹·è´åˆ°ç”Ÿæˆçš„exeæ–‡ä»¶æ‰€åœ¨ç›®å½•ï¼Œå¯¼è‡´è¿™äº›dllæ–‡ä»¶ä¼šå¤åˆ¶å¾ˆå¤šä»½ï¼Œå æ®å¾ˆå¤§ç©ºé—´ï¼Œè¿™é‡Œé€šè¿‡è®¾ç½®ä¾èµ–äºé¡¹ç›®çš„ç¯å¢ƒå˜é‡ï¼Œå°‘äº†å¤§é‡æ‹·è´ï¼Œè¿˜ä¸å½±å“å…¶ä»–å˜é‡ï¼‰</p>
</li>
</ol>
<h2 id="C-è°ƒç”¨C-DLL"><a href="#C-è°ƒç”¨C-DLL" class="headerlink" title="C#è°ƒç”¨C++ DLL"></a>C#è°ƒç”¨C++ DLL</h2><blockquote>
<p>é¡¹ç›®éœ€æ±‚åˆ©ç”¨C#è°ƒç”¨C++å°è£…å¥½çš„DLLåº“ï¼Œè¿›è¡Œäº†ä¸€ç•ªè°ƒç ”ä¸è¯•é”™ï¼Œæ­¤éƒ¨åˆ†è¿›è¡Œä¸€äº›è¯¦å®çš„è®°å½•ï¼Œæœ‰äº›é—®é¢˜ä»å¾…è¿›ä¸€æ­¥éªŒè¯ã€‚</p>
<p>ä»¥ä¸‹ç»éªŒæ¥è‡ªç½‘å‹çš„åˆ†äº«ï¼š<a href="https://www.cnblogs.com/neverstop/p/5901652.html">https://www.cnblogs.com/neverstop/p/5901652.html</a></p>
</blockquote>
<h3 id="c-ä¸c-çš„ç±»å‹å¯¹ç…§é—®é¢˜"><a href="#c-ä¸c-çš„ç±»å‹å¯¹ç…§é—®é¢˜" class="headerlink" title="c# ä¸c++çš„ç±»å‹å¯¹ç…§é—®é¢˜"></a>c# ä¸c++çš„ç±»å‹å¯¹ç…§é—®é¢˜</h3><p>c#è°ƒç”¨c++æ–¹æ³•æ—¶ï¼Œé¦–å…ˆè¦åœ¨ç±»ä¸­å®šä¹‰ä¸€ä¸ªä¸c++æ–¹æ³•å¯¹åº”çš„å¤–éƒ¨æ–¹æ³•ï¼Œå› ä¸ºè¯¥æ–¹æ³•æ˜¯ç”¨C#è¯­è¨€å®šä¹‰çš„ï¼Œé‚£ä¹ˆè‚¯å®šè¦å¼„æ¸…æ¥šC#ç±»å‹ä¸c++ç±»å‹å¦‚ä½•å¯¹åº”ï¼Œå¦åˆ™ä¼šå¯¼è‡´è°ƒç”¨å¤±è´¥ã€‚å¯ä»¥ä½¿ç”¨å·¥å…·ï¼Œè‡ªåŠ¨æ ¹æ®c++æ–¹æ³•ç­¾åç”Ÿæˆå¯¹åº”çš„C# importæ–¹æ³•ç­¾åï¼Œå‚è€ƒ<a href="http://www.cnblogs.com/lbq1221119/archive/2008/01/16/1040958.html">P/Invoke Interop Assistant</a>ã€‚ä¸è¿‡æœ‰ä¸€ä¸ªé—®é¢˜è¿˜æ˜¯è¦æ³¨æ„çš„ï¼Œåœ¨x86æ¨¡å¼ä¸‹c#ä¸­çš„intå¯¹åº”c++ä¸­çš„intï¼Œè€Œåœ¨x64æ¨¡å¼ä¸‹C#ä¸­çš„intæ˜¯å¯¹åº”c++ä¸­çš„longï¼Œå°±è¿™ä¹ˆä¸€ä¸ªå°å°çš„å˜é‡ç±»å‹ï¼Œåœ¨ä¸ç»æ„é—´å¯èƒ½å°±ä¼šå¯¼è‡´c++ä»£ç å‡ºé”™ã€‚</p>
<p>è¿˜æœ‰ä¸€ä¸ªé—®é¢˜æ˜¯ï¼š<code>æ‰˜ç®¡çš„ PInvoke ç­¾åä¸éæ‰˜ç®¡çš„ç›®æ ‡ç­¾åä¸åŒ¹é…</code>ï¼Œå¯ä»¥åœ¨C#ä»£ç çš„æ–¹æ³•ç‰¹æ€§ä¸ŠåŠ ä¸Š<code>CallingConvention.Cdecl</code>ã€‚å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[DllImport(&quot;dllname.dll&quot;, CharSet = CharSet.Ansi, EntryPoint = &quot;methodname&quot;, CallingConvention = CallingConvention.Cdecl)]</span><br></pre></td></tr></table></figure>
<h3 id="å†…å­˜é‡Šæ”¾"><a href="#å†…å­˜é‡Šæ”¾" class="headerlink" title="å†…å­˜é‡Šæ”¾"></a>å†…å­˜é‡Šæ”¾</h3><p>å“ªé‡Œè°ƒç”¨å“ªé‡Œé‡Šæ”¾ï¼Œéœ€è¦åšå¤§é‡æµ‹è¯•æ£€æµ‹ã€‚</p>
<h3 id="ç‰ˆæœ¬é—®é¢˜"><a href="#ç‰ˆæœ¬é—®é¢˜" class="headerlink" title="ç‰ˆæœ¬é—®é¢˜"></a>ç‰ˆæœ¬é—®é¢˜</h3><p>ç‰ˆæœ¬ä¸åŒ¹é…çš„è¯ï¼Œåœ¨è°ƒè¯•æ—¶ä¼šæç¤º<code>æ­£åœ¨åŠ è½½æ ¼å¼ä¸æ­£ç¡®çš„dll</code>ï¼Œå¦‚æœä½¿ç”¨çš„æ˜¯32ä½çš„c++ç‰ˆdllï¼Œéœ€è¦æŠŠC#é¡¹ç›®çš„ç¼–è¯‘å¹³å°è®¾ç½®ä¸ºx86ï¼Œå¦‚æœä½¿ç”¨çš„æ˜¯64ä½çš„c++ç‰ˆdllï¼Œåˆ™è®¾ç½®ä¸ºany cpuå’Œx64éƒ½å¯ä»¥ã€‚</p>
<h3 id="ç¼–è¯‘é—®é¢˜-é™æ€ç¼–è¯‘ä¸åŠ¨æ€ç¼–è¯‘"><a href="#ç¼–è¯‘é—®é¢˜-é™æ€ç¼–è¯‘ä¸åŠ¨æ€ç¼–è¯‘" class="headerlink" title="ç¼–è¯‘é—®é¢˜(é™æ€ç¼–è¯‘ä¸åŠ¨æ€ç¼–è¯‘)"></a>ç¼–è¯‘é—®é¢˜(é™æ€ç¼–è¯‘ä¸åŠ¨æ€ç¼–è¯‘)</h3><p>è¿™ä¸ªé—®é¢˜åœ¨è¿è¡Œæ—¶æœ‰æ—¶å€™ä¼šæç¤ºdllåŠ è½½ä¸æˆåŠŸï¼Œè¿™ä¸ªé—®é¢˜åœ¨ä¸åŒçš„ç”µè„‘ä¸Šä¼šæœ‰ä¸åŒçš„ä½“ç°ï¼Œæœ‰çš„å­˜åœ¨è¿™ä¸ªé—®é¢˜ï¼Œæœ‰çš„å°±è¿è¡Œæ­£å¸¸ã€‚è€Œæˆ‘æœ¬æœºå°±å±äºæ­£å¸¸çš„ï¼Œéƒ¨ç½²çš„æœåŠ¡å™¨å±äºå‡ºé—®é¢˜çš„ã€‚å‡ºç°è¿™ä¸ªé—®é¢˜åï¼Œåœ¨ç¡®è®¤ä»£ç æ— è¯¯åï¼Œæˆ‘ç”¨<code>depends.exe</code>è¿™ä¸ªå·¥å…·æŸ¥çœ‹äº†ä¸€ä¸‹å¯¼è‡´é—®é¢˜çš„é‚£ä¸ªc++ç‰ˆçš„dlléƒ½ä¾èµ–ä»€ä¹ˆç¨‹åºé›†ï¼Œåœ¨å‡ºé—®é¢˜çš„æœºå™¨ä¸Šä¼šæç¤ºæœ‰ä¸€äº›ä¾èµ–çš„dllä¸å­˜åœ¨ï¼Œè€Œè¿™äº›dllåœ¨è¿è¡Œæ­£å¸¸çš„æœºå™¨ä¸Šæ˜¯å­˜åœ¨çš„ã€‚ä¸‹å›¾çº¢è‰²æ¡†ä¸­çš„ä¸ºæŸäº›æœºå™¨ä¸Šå¯èƒ½ä¼šç¼ºå°‘çš„dllï¼š</p>
<p><img src="/2020/11/19/pytorchæ¨¡å‹çš„å¯¼å‡ºä¸éƒ¨ç½²/206282-20160923224910559-38712457.png" alt="img"></p>
<p>å¦‚æœç¼ºå°‘ç›¸å…³dllï¼Œè¯¥æ¡ç›®çš„å·¦è¾¹ä¼šæ˜¾ç¤ºå‡ºä¸€ä¸ªé»„è‰²çš„é—®å·ã€‚è¿™ä¸ªé—®é¢˜å¯ä»¥é‡‡ç”¨é™æ€ç¼–è¯‘è¿›è¡Œè§£å†³ï¼Œå…³äºä»€ä¹ˆæ˜¯<a href="http://baike.baidu.com/link?url=ZveglEz7YJNWNoKN5pKfGJbu_pijrEoP2yIA7h99VNEAYAcPwl-8jwWEzVoFDwDhlVS5EoqALwxoJejI7Kpj9a">é™æ€ç¼–è¯‘</a>å¯ä»¥è‡ªè¡Œç™¾åº¦ï¼Œæ€»ä¹‹å°±æ˜¯å°†ç¨‹åºæ‰€ä¾èµ–çš„dllç¼–è¯‘åˆ°ç¨‹åºé›†ä¸­ï¼Œè¿™æ ·å³ä½¿å…¶ä»–æœºå™¨ä¸å­˜åœ¨è¿™äº›dllä¹Ÿå¯ä»¥æ­£å¸¸è¿è¡Œäº†ï¼Œé™æ€ç¼–è¯‘å¯ä»¥åœ¨vsçš„é¡¹ç›®å±æ€§ä¸­è¿›è¡Œè®¾ç½®</p>
<p><img src="/2020/11/19/pytorchæ¨¡å‹çš„å¯¼å‡ºä¸éƒ¨ç½²/206282-20160923224957981-1888139544.png" alt="img"></p>
<p>é»˜è®¤æ˜¯<code>å¤šçº¿ç¨‹ DLL(/MD)</code>ï¼Œå³ï¼š<strong>åŠ¨æ€ç¼–è¯‘</strong>ï¼Œè¿™é‡Œæ›´æ”¹ä¸º <code>å¤šçº¿ç¨‹ï¼ˆ/MTï¼‰</code>ï¼Œå³ï¼šé™æ€ç¼–è¯‘ã€‚</p>
<p>åˆšæ‰çš„é…ç½®åªèƒ½è§£å†³ç¼ºå°‘MSVCP120.DLLå’ŒMSVCR120.DLLè¿™ä¸€ç±»é—®é¢˜ï¼Œå¯¹äºç¼ºå°‘MFCç›¸å…³çš„dllï¼Œè¿˜è¦ç»è¿‡ä¸‹é¢çš„é…ç½®ï¼š</p>
<p><img src="/2020/11/19/pytorchæ¨¡å‹çš„å¯¼å‡ºä¸éƒ¨ç½²/206282-20160923225012371-1331717166-1606185369311.png" alt="img"></p>
<h3 id="å¼‚å¸¸æ•è·ä¸é—®é¢˜å®šä½"><a href="#å¼‚å¸¸æ•è·ä¸é—®é¢˜å®šä½" class="headerlink" title="å¼‚å¸¸æ•è·ä¸é—®é¢˜å®šä½"></a>å¼‚å¸¸æ•è·ä¸é—®é¢˜å®šä½</h3><p>å¾ˆå¤šæ—¶å€™åœ¨c#ä»£ç ä¸­æ˜¯æ•è·ä¸åˆ°c++çš„å¼‚å¸¸çš„ï¼Œè™½ç„¶åœ¨æ–¹æ³•ä¸­æ·»åŠ äº†ç‰¹æ€§<code>HandleProcessCorruptedStateExceptions</code>ä¸<code>SecurityCritical</code>ä½†è¿˜æ˜¯æ•è·ä¸åˆ°c++ä¸­çš„å¼‚å¸¸ï¼ŒåŸå› å¯èƒ½æ˜¯c++åœ¨é‡åˆ°æŸäº›å¼‚å¸¸æ—¶ä¼šé€ æˆç¨‹åºç›´æ¥é€€å‡ºï¼Œè¿™æ ·åœ¨C#ä¸­å°±è‡ªç„¶æ•è·ä¸åˆ°äº†ï¼Œæ‰€ä»¥è¿˜æ˜¯å°½é‡ä¿è¯c++ä»£ç çš„å¥å£®æ€§ã€‚ å¦‚æœåœ¨c#ä¸­è°ƒç”¨äº†å¤šä¸ªc++ç‰ˆdllä¸­çš„æ–¹æ³•ï¼Œå› ä¸ºæœ‰æ—¶æ•è·ä¸åˆ°å¼‚å¸¸ï¼Œå¾ˆéš¾é€šè¿‡å¸¸è§„æ–¹æ³•æ‰¾åˆ°é—®é¢˜çš„åŸå› ï¼Œc++æ–¹æ³•ä¸­ä¸€æ—¦å‡ºç°å¼‚å¸¸å¯èƒ½ä¼šç›´æ¥å¯¼è‡´è¿›ç¨‹é€€å‡ºäº†ï¼Œè¿™æ—¶å¯ä»¥å€ŸåŠ©æ“ä½œç³»ç»Ÿä¸­çš„äº‹ä»¶æŸ¥çœ‹å™¨æ¥æ‰¾å‡ºå¼‚å¸¸æ˜¯æ¥è‡ªå“ªä¸ªdllï¼ŒåŒæ—¶åœ¨åŸæœ‰ä»£ç ä¸­æ³¨é‡Šæ‰é‚£æ®µè°ƒç”¨è¯¥c++æ–¹æ³•çš„ä»£ç ï¼Œæˆ–è€…mockä¸€ä¸ªæ–¹æ³•è°ƒç”¨ï¼Œä¿è¯è¯¥æ®µä»£ç æ— å¼‚å¸¸ï¼Œç„¶åå†è¿›è¡Œæµ‹è¯•ï¼Œå¦‚æœæ— å¼‚å¸¸ï¼Œé‚£ä¹ˆåªè¦è§£å†³äº†é‚£ä¸ªc++æ–¹æ³•çš„é—®é¢˜å³å¯ï¼Œå¦‚æœè¿˜æœ‰å¼‚å¸¸é‚£ä¹ˆå°±æ˜¯å…¶ä»–dllçš„é—®é¢˜ï¼Œç„¶åå¯ä»¥ç¼–å†™æµ‹è¯•ä»£ç å•ç‹¬æµ‹è¯•æ›¾ç»å‡ºé—®é¢˜çš„dllä¸­çš„æ–¹æ³•ã€‚<code>å¼‚å¸¸æ•è·+äº‹ä»¶æŸ¥çœ‹å™¨+æ—¥å¿—</code>å¯ä»¥å¸®åŠ©å¼€å‘è€…å‘ç°ç¨‹åºçš„å¤§éƒ¨åˆ†é—®é¢˜ä¸åŸå› ã€‚</p>
<h3 id="c-ä¸-c-äº’ä¼ æ–‡ä»¶ä»£ç "><a href="#c-ä¸-c-äº’ä¼ æ–‡ä»¶ä»£ç " class="headerlink" title="c# ä¸ c++äº’ä¼ æ–‡ä»¶ä»£ç "></a>c# ä¸ c++äº’ä¼ æ–‡ä»¶ä»£ç </h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">public static BitmapInfo GetImagePixel(Bitmap Source)</span><br><span class="line">        &#123;</span><br><span class="line">            byte[] result;</span><br><span class="line">            int step;</span><br><span class="line">            int iWidth = Source.Width;</span><br><span class="line">            int iHeight = Source.Height;</span><br><span class="line">            //</span><br><span class="line">            if (iWidth %4!=0)</span><br><span class="line">            &#123;</span><br><span class="line">                iWidth = iWidth - (iWidth % 4);</span><br><span class="line">            &#125;</span><br><span class="line">            Rectangle rect = new Rectangle(0, 0, iWidth, iHeight);</span><br><span class="line">            System.Drawing.Imaging.BitmapData bmpData = Source.LockBits(rect,</span><br><span class="line">                System.Drawing.Imaging.ImageLockMode.ReadWrite, Source.PixelFormat);</span><br><span class="line">            IntPtr iPtr = bmpData.Scan0;</span><br><span class="line">            //int iBytes = iWidth * iHeight * 3;</span><br><span class="line">            step = bmpData.Stride/iWidth;</span><br><span class="line">            int iBytes = iWidth * iHeight * step;</span><br><span class="line">            byte[] PixelValues = new byte[iBytes];</span><br><span class="line">            System.Runtime.InteropServices.Marshal.Copy(iPtr, PixelValues, 0, iBytes);</span><br><span class="line">            Source.UnlockBits(bmpData);</span><br><span class="line">            result = PixelValues;</span><br><span class="line">            BitmapInfo bi = new BitmapInfo &#123; Result = result, Channels = step, width =iWidth, height = iHeight&#125;;</span><br><span class="line">            return bi;</span><br><span class="line">        &#125;</span><br><span class="line">     </span><br><span class="line">public class BitmapInfo</span><br><span class="line">    &#123;</span><br><span class="line">        public byte[] Result &#123; get; set; &#125;</span><br><span class="line">        public int Channels &#123; get; set; &#125;</span><br><span class="line">        public int width &#123; get; set; &#125;</span><br><span class="line">        public int height &#123; get; set; &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h2 id="å…¶å®ƒ"><a href="#å…¶å®ƒ" class="headerlink" title="å…¶å®ƒ"></a>å…¶å®ƒ</h2><h3 id="å…³äºlibtorchä¸pytorchè¾“å‡ºç»“æœçš„ä¸ä¸€è‡´æ€§"><a href="#å…³äºlibtorchä¸pytorchè¾“å‡ºç»“æœçš„ä¸ä¸€è‡´æ€§" class="headerlink" title="å…³äºlibtorchä¸pytorchè¾“å‡ºç»“æœçš„ä¸ä¸€è‡´æ€§"></a>å…³äºlibtorchä¸pytorchè¾“å‡ºç»“æœçš„ä¸ä¸€è‡´æ€§</h3><ol>
<li><p>pre-processingè¿‡ç¨‹å¯¼è‡´çš„ç»“æœå·®å¼‚</p>
<ol>
<li><p>pre-processingé˜¶æ®µå…³æ³¨ä¸¤ä¸ªé—®é¢˜ï¼š<code>resize</code>çš„æ–¹æ³•æ˜¯å¦ä¸€è‡´ï¼›<code>normalization</code>çš„æ–¹æ³•æ˜¯å¦ä¸€è‡´;</p>
</li>
<li><p>å½“ç»Ÿä¸€çš„ç›¸å…³æ–¹æ³•ä¹‹åä»ç„¶å‘ç°å­˜åœ¨ä¸ä¸€è‡´æ€§ï¼Œè¿›ä¸€æ­¥åˆ†æå‘ç°ï¼š<code>å›¾åƒåº“ PILçš„è®¡ç®—æµ®ç‚¹æ•°ï¼Œä¸opencvè®¡ç®—çš„ä¸ä¸€è‡´ã€‚</code></p>
<blockquote>
<p>å‚è§ï¼š<a href="https://zhuanlan.zhihu.com/p/141401062?from_voters_page=true">https://zhuanlan.zhihu.com/p/141401062?from_voters_page=true</a></p>
<ol>
<li>torchvision transforms é»˜è®¤ä½¿ç”¨ PIL é¢„å¤„ç†å›¾ç‰‡ã€‚</li>
<li>c++ libtorch ä½¿ç”¨opencvé¢„å¤„ç†å›¾ç‰‡ï¼Œæ‰€ä»¥å»ºè®®pythonè®­ç»ƒæ¨¡å‹çš„æ•°æ®å¢å¼ºï¼Œä½¿ç”¨ opencv å¤„ç†æ•°æ®å¢å¼ºï¼Œè¯„ä¼°ä¹Ÿä½¿ç”¨opencv å¤„ç†æ•°æ®å¢å¼ºã€‚</li>
</ol>
</blockquote>
<p>ä½¿ç”¨libtorchè¿›è¡Œé¢„å¤„ç†ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"torch/script.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"torch/torch.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// opencv å¤´æ–‡ä»¶</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;opencv2/highgui/highgui.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;opencv2/imgproc/imgproc.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;opencv2/opencv.hpp&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;memory&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    torch::jit::script::Module <span class="keyword">module</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">module</span> = torch::jit::load(<span class="string">"mobilenetv2-trace.pt"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> (<span class="keyword">const</span> c10::Error&amp; ) &#123;</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">cerr</span> &lt;&lt; <span class="string">"error loading the model\n"</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä¹‹å‰çš„ç‰ˆæœ¬ module-&gt;to , 1.4ç‰ˆæœ¬ä»¥ä¸Šç”¨ module.to();</span></span><br><span class="line">    <span class="keyword">module</span>.to(at::kCUDA);</span><br><span class="line"></span><br><span class="line">    cv::Mat input_image;</span><br><span class="line">    cv::Mat read_image = cv::imread(<span class="string">"cat.png"</span>);</span><br><span class="line">    <span class="keyword">if</span> (read_image.empty() || !read_image.data)</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"read image fail"</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">    cv::cvtColor(read_image, input_image, cv::COLOR_BGR2RGB);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// resize(256)</span></span><br><span class="line">    cv::<span class="function">Size <span class="title">scale</span><span class="params">(<span class="number">256</span>, <span class="number">256</span>)</span></span>;</span><br><span class="line">    cv::resize(input_image, input_image, scale, <span class="number">0</span>, <span class="number">0</span>, cv::INTER_LINEAR);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// centerSizeCrop(224)</span></span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">int</span> cropSize = <span class="number">224</span>;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">int</span> offsetW = <span class="built_in">std</span>::round((input_image.cols - cropSize) / <span class="number">2.0</span>);</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">int</span> offsetH = <span class="built_in">std</span>::round((input_image.rows - cropSize) / <span class="number">2.0</span>);</span><br><span class="line">    <span class="keyword">const</span> cv::<span class="function">Rect <span class="title">roi</span><span class="params">(offsetW, offsetH, cropSize, cropSize)</span></span>;</span><br><span class="line">    input_image = input_image(roi).clone();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// è½¬æ¢ [unsigned int] to [float]</span></span><br><span class="line">    input_image.convertTo(input_image, CV_32FC3, <span class="number">1.0</span> / <span class="number">255.0</span>);</span><br><span class="line">    torch::Tensor tensor_image = torch::from_blob(input_image.data, &#123;<span class="number">1</span>, input_image.rows, input_image.cols,<span class="number">3</span>&#125;);</span><br><span class="line">    tensor_image = tensor_image.permute(&#123;<span class="number">0</span>,<span class="number">3</span>,<span class="number">1</span>,<span class="number">2</span>&#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// transforms.Normalize(mean=[0.485, 0.456, 0.406],</span></span><br><span class="line">    <span class="comment">//                    std=[0.229, 0.224, 0.225])</span></span><br><span class="line">    tensor_image[<span class="number">0</span>][<span class="number">0</span>] = tensor_image[<span class="number">0</span>][<span class="number">0</span>].sub_(<span class="number">0.485</span>).div_(<span class="number">0.229</span>);</span><br><span class="line">    tensor_image[<span class="number">0</span>][<span class="number">1</span>] = tensor_image[<span class="number">0</span>][<span class="number">1</span>].sub_(<span class="number">0.456</span>).div_(<span class="number">0.224</span>);</span><br><span class="line">    tensor_image[<span class="number">0</span>][<span class="number">2</span>] = tensor_image[<span class="number">0</span>][<span class="number">2</span>].sub_(<span class="number">0.406</span>).div_(<span class="number">0.225</span>);</span><br><span class="line">    tensor_image = tensor_image.to(torch::kCUDA);</span><br><span class="line">    torch::Tensor output = <span class="keyword">module</span>.forward(&#123;tensor_image&#125;).toTensor();</span><br><span class="line"></span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; output.slice(<span class="comment">/*dim=*/</span><span class="number">1</span>, <span class="comment">/*start=*/</span><span class="number">0</span>, <span class="comment">/*end=*/</span><span class="number">5</span>) &lt;&lt; <span class="string">'\n'</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¸ºäº†å’Œlibtorchä¸­ä¸€è‡´ï¼Œpytorchä¸­å»ºè®®ä½¿ç”¨çš„ç­–ç•¥ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">import</span> torchvision.models <span class="keyword">as</span> models</span><br><span class="line"><span class="keyword">from</span> torchvision <span class="keyword">import</span> transforms </span><br><span class="line"><span class="comment">#from PIL import Image</span></span><br><span class="line">val_transform = transforms.Compose([</span><br><span class="line">    <span class="comment">#transforms.Resize(512),</span></span><br><span class="line">    <span class="comment">#transforms.CenterCrop(512),</span></span><br><span class="line">    transforms.ToTensor(),</span><br><span class="line">    transforms.Normalize(mean=[<span class="number">0.485</span>, <span class="number">0.456</span>, <span class="number">0.406</span>],</span><br><span class="line">                        std=[<span class="number">0.229</span>, <span class="number">0.224</span>, <span class="number">0.225</span>])</span><br><span class="line">    ]</span><br><span class="line">)  </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">centerSizeCrop</span><span class="params">(image, crop_size)</span>:</span></span><br><span class="line">    rows, cols = image.shape[:<span class="number">2</span>]</span><br><span class="line">    x = round((cols - crop_size) / <span class="number">2.0</span>)</span><br><span class="line">    y = round((rows - crop_size) / <span class="number">2.0</span>)</span><br><span class="line">    img = image[y:y+crop_size, x:x+crop_size]</span><br><span class="line">    <span class="keyword">return</span> img</span><br><span class="line"></span><br><span class="line">img = cv2.imread(<span class="string">"xxxxx.bmp"</span>)</span><br><span class="line">img = cv2.cvtColor(img, cv2.COLOR_BGR2RGB)</span><br><span class="line">img = cv2.resize(img, (<span class="number">1024</span>,<span class="number">1024</span>))</span><br><span class="line">img = centerSizeCrop(img, <span class="number">512</span>)</span><br><span class="line">img = val_transform(img)</span><br><span class="line">img = img.unsqueeze(<span class="number">0</span>)</span><br><span class="line">img = img.cuda()</span><br><span class="line">output = model(img)</span><br></pre></td></tr></table></figure>
</li>
</ol>
</li>
<li><p>è®¡ç®—ç²¾åº¦æŸå¤±å¯¼è‡´çš„å·®å¼‚</p>
</li>
</ol>
<h3 id="C-è°ƒç”¨C-ç±»çš„å®ç°-å¦‚ä¸‹å†…å®¹å¾…æµ‹è¯•"><a href="#C-è°ƒç”¨C-ç±»çš„å®ç°-å¦‚ä¸‹å†…å®¹å¾…æµ‹è¯•" class="headerlink" title="C# è°ƒç”¨C++ç±»çš„å®ç°(å¦‚ä¸‹å†…å®¹å¾…æµ‹è¯•)"></a>C# è°ƒç”¨C++ç±»çš„å®ç°(å¦‚ä¸‹å†…å®¹å¾…æµ‹è¯•)</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line">Marshal C++ Class <span class="keyword">and</span> use the PInvoke</span><br><span class="line">C++ Code ,ClassName.h</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> __<span class="title">declspec</span>(<span class="title">dllexport</span>) <span class="title">CClassName</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"> <span class="keyword">public</span>:</span><br><span class="line">    CClassName();</span><br><span class="line">    ~CClassName();</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">function</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line">C++ Code, ClassName.cpp</span><br><span class="line"></span><br><span class="line">CClassName::CClassName()</span><br><span class="line">&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">CClassName::~CClassName()</span><br><span class="line">&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> CClassName::function()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"Bla bla bla"</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">C++ Code, ClassNameCaller.h file <span class="keyword">for</span> the caller function</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"ClassName.h"</span>      </span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> __cplusplus</span></span><br><span class="line"><span class="keyword">extern</span> <span class="string">"C"</span> &#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> __declspec(dllexport) <span class="function">CClassName* <span class="title">CreateClassName</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> __declspec(dllexport) <span class="function"><span class="keyword">void</span> <span class="title">DisposeClassName</span><span class="params">(CClassName* a_pObject)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> __declspec(dllexport) <span class="function"><span class="keyword">void</span> <span class="title">function</span><span class="params">(CClassName* a_pObject)</span></span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> __cplusplus</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">C++ Code, ClassNameCaller.cpp file <span class="keyword">for</span> the caller function</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"ClassNameCaller.h"</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function">CClassName* <span class="title">CreateClassName</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> CClassName();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">DisposeClassName</span><span class="params">(CClassName* a_pObject)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(a_pObject!= <span class="literal">NULL</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">delete</span> a_pObject;</span><br><span class="line">        a_pObject= <span class="literal">NULL</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">function</span><span class="params">(CClassName* a_pObject)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(a_pObject!= <span class="literal">NULL</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        a_pObject-&gt;function();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">-------------------------------------------------------------------------</span><br><span class="line">C<span class="meta"># code</span></span><br><span class="line"></span><br><span class="line">[DllImport(<span class="string">"ClassNameDll.dll"</span>)]</span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">public</span> <span class="keyword">extern</span> IntPtr <span class="title">CreateClassName</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">[DllImport(<span class="string">"ClassNameDll.dll"</span>)]</span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">public</span> <span class="keyword">extern</span> <span class="keyword">void</span> <span class="title">DisposeClassName</span><span class="params">(IntPtr pClassNameObject)</span></span>;</span><br><span class="line"></span><br><span class="line">[DllImport(<span class="string">"ClassNameDll.dll"</span>)]</span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">public</span> <span class="keyword">extern</span> <span class="keyword">void</span> <span class="title">CallFunction</span><span class="params">(IntPtr pClassNameObject)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//use the functions</span></span><br><span class="line">IntPtr pClassName = CreateClassName();</span><br><span class="line"></span><br><span class="line">CallFunction(pClassName);</span><br><span class="line">DisposeClassName(pClassName);</span><br><span class="line">pClassName = IntPtr.Zero;</span><br></pre></td></tr></table></figure>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><ol>
<li><a href="https://www.cnblogs.com/neverstop/p/5901652.html">https://www.cnblogs.com/neverstop/p/5901652.html</a></li>
</ol>

        </div>
        
        <hr style="height:1px;margin:1rem 0"/>
        <div class="level is-size-7 is-uppercase">
            <div class="level-start">
                <div class="level-item">
                    <i class="fas fa-tags has-text-grey"></i>&nbsp;
                    <a class="has-link-grey -link" href="/tags/äººå·¥æ™ºèƒ½/">äººå·¥æ™ºèƒ½</a>,&nbsp;<a class="has-link-grey -link" href="/tags/æ–‡çŒ®/">æ–‡çŒ®</a>,&nbsp;<a class="has-link-grey -link" href="/tags/ç®—æ³•/">ç®—æ³•</a>
                </div>
            </div>
        </div>
        
        
        
        
<div class="sharethis-inline-share-buttons"></div>
<script type='text/javascript' src='https://platform-api.sharethis.com/js/sharethis.js#property=5e762f775039a80012d346d9&amp;product=inline-share-buttons&amp;cms=sop' async='async'></script>

        
    </div>
</div>



<div class="card">
    <div class="card-content">
        <h3 class="menu-label has-text-centered">å–œæ¬¢è¿™ç¯‡æ–‡ç« ï¼Ÿæ‰“èµä¸€ä¸‹ä½œè€…å§</h3>
        <div class="buttons is-centered">
            
                
<a class="button is-info donate">
    <span class="icon is-small">
        <i class="fab fa-alipay"></i>
    </span>
    <span>æ”¯ä»˜å®</span>
    <div class="qrcode"><img src="/images/site/alipay.jpg" alt="æ”¯ä»˜å®"></div>
</a>

                
                
<a class="button is-success donate">
    <span class="icon is-small">
        <i class="fab fa-weixin"></i>
    </span>
    <span>å¾®ä¿¡</span>
    <div class="qrcode"><img src="/images/site/weixin.png" alt="å¾®ä¿¡"></div>
</a>

                
        </div>
    </div>
</div>



<div class="card card-transparent">
    <div class="level post-navigation is-flex-wrap is-mobile">
        
        <div class="level-start">
            <a class="level level-item has-link-grey  article-nav-prev" href="/2021/01/28/Reinforcement-Learning-Tips-and-Tricks/">
                <i class="level-item fas fa-chevron-left"></i>
                <span class="level-item">Reinforcement Learning:Tips and Tricks</span>
            </a>
        </div>
        
        
        <div class="level-end">
            <a class="level level-item has-link-grey  article-nav-next" href="/2020/05/04/è¯»ä¹¦ç¬”è®°-ã€Šç¥ç»ç½‘ç»œä¸æ·±åº¦å­¦ä¹ ã€‹/">
                <span class="level-item">è¯»ä¹¦ç¬”è®°-ã€Šç¥ç»ç½‘ç»œä¸æ·±åº¦å­¦ä¹ ã€‹</span>
                <i class="level-item fas fa-chevron-right"></i>
            </a>
        </div>
        
    </div>
</div>



<div class="card">
    <div class="card-content">
        <h3 class="title is-5 has-text-weight-normal">è¯„è®º</h3>
        
<div id="valine-thread" class="content"></div>
<script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/valine@1.3.10/dist/Valine.min.js"></script>
<script>
    new Valine({
        el: '#valine-thread' ,
        notify: false,
        verify: false,
        app_id: 'JQMgg0zbFBNWwL0lLnq2s1G7-gzGzoHsz',
        app_key: 'm5FMVedFNxGutQCnMsVMAaXM',
        placeholder: 'Say Something ...'
    });
</script>

    </div>
</div>
</div>
                
                




<div class="column is-4-tablet is-4-desktop is-3-widescreen  has-order-3 column-right is-sticky">
    
        

    <div class="card widget" id="toc">
        <div class="card-content">
            <div class="menu">
                <h3 class="menu-label">
                    ç›®å½•
                </h3>
                <ul class="menu-list"><li>
        <a class="is-flex" href="#pytorchæ¨¡å‹çš„å¯¼å‡º">
        <span class="has-mr-6">1</span>
        <span>pytorchæ¨¡å‹çš„å¯¼å‡º</span>
        </a><ul class="menu-list"><li>
        <a class="is-flex" href="#å¯¼å‡ºæ¨¡å‹çš„æ£€æµ‹">
        <span class="has-mr-6">1.1</span>
        <span>å¯¼å‡ºæ¨¡å‹çš„æ£€æµ‹</span>
        </a></li></ul></li><li>
        <a class="is-flex" href="#æ¨¡å‹åŠ è½½">
        <span class="has-mr-6">2</span>
        <span>æ¨¡å‹åŠ è½½</span>
        </a><ul class="menu-list"><li>
        <a class="is-flex" href="#ä½¿ç”¨opencvåŠ è½½ONNXæ¨¡å‹">
        <span class="has-mr-6">2.1</span>
        <span>ä½¿ç”¨opencvåŠ è½½ONNXæ¨¡å‹</span>
        </a></li><li>
        <a class="is-flex" href="#ä½¿ç”¨libtorch">
        <span class="has-mr-6">2.2</span>
        <span>ä½¿ç”¨libtorch</span>
        </a></li><li>
        <a class="is-flex" href="#DLLçš„ç”Ÿæˆä¸æµ‹è¯•">
        <span class="has-mr-6">2.3</span>
        <span>DLLçš„ç”Ÿæˆä¸æµ‹è¯•</span>
        </a><ul class="menu-list"><li>
        <a class="is-flex" href="#è§£å†³cudaä¸è¯†åˆ«çš„é—®é¢˜">
        <span class="has-mr-6">2.3.1</span>
        <span>è§£å†³cudaä¸è¯†åˆ«çš„é—®é¢˜</span>
        </a></li></ul></li></ul></li><li>
        <a class="is-flex" href="#Visual-Studioé…ç½®">
        <span class="has-mr-6">3</span>
        <span>Visual Studioé…ç½®</span>
        </a><ul class="menu-list"><ul class="menu-list"><li>
        <a class="is-flex" href="#1-é™„åŠ åŒ…å«ç›®å½•çš„é…ç½®">
        <span class="has-mr-6">3.1.1</span>
        <span>1. é™„åŠ åŒ…å«ç›®å½•çš„é…ç½®</span>
        </a></li><li>
        <a class="is-flex" href="#2-é“¾æ¥å™¨é…ç½®">
        <span class="has-mr-6">3.1.2</span>
        <span>2. é“¾æ¥å™¨é…ç½®</span>
        </a></li></ul></ul></li><li>
        <a class="is-flex" href="#æŠ€å·§">
        <span class="has-mr-6">4</span>
        <span>æŠ€å·§</span>
        </a></li><li>
        <a class="is-flex" href="#C-è°ƒç”¨C-DLL">
        <span class="has-mr-6">5</span>
        <span>C#è°ƒç”¨C++ DLL</span>
        </a><ul class="menu-list"><li>
        <a class="is-flex" href="#c-ä¸c-çš„ç±»å‹å¯¹ç…§é—®é¢˜">
        <span class="has-mr-6">5.1</span>
        <span>c# ä¸c++çš„ç±»å‹å¯¹ç…§é—®é¢˜</span>
        </a></li><li>
        <a class="is-flex" href="#å†…å­˜é‡Šæ”¾">
        <span class="has-mr-6">5.2</span>
        <span>å†…å­˜é‡Šæ”¾</span>
        </a></li><li>
        <a class="is-flex" href="#ç‰ˆæœ¬é—®é¢˜">
        <span class="has-mr-6">5.3</span>
        <span>ç‰ˆæœ¬é—®é¢˜</span>
        </a></li><li>
        <a class="is-flex" href="#ç¼–è¯‘é—®é¢˜-é™æ€ç¼–è¯‘ä¸åŠ¨æ€ç¼–è¯‘">
        <span class="has-mr-6">5.4</span>
        <span>ç¼–è¯‘é—®é¢˜(é™æ€ç¼–è¯‘ä¸åŠ¨æ€ç¼–è¯‘)</span>
        </a></li><li>
        <a class="is-flex" href="#å¼‚å¸¸æ•è·ä¸é—®é¢˜å®šä½">
        <span class="has-mr-6">5.5</span>
        <span>å¼‚å¸¸æ•è·ä¸é—®é¢˜å®šä½</span>
        </a></li><li>
        <a class="is-flex" href="#c-ä¸-c-äº’ä¼ æ–‡ä»¶ä»£ç ">
        <span class="has-mr-6">5.6</span>
        <span>c# ä¸ c++äº’ä¼ æ–‡ä»¶ä»£ç </span>
        </a></li></ul></li><li>
        <a class="is-flex" href="#å…¶å®ƒ">
        <span class="has-mr-6">6</span>
        <span>å…¶å®ƒ</span>
        </a><ul class="menu-list"><li>
        <a class="is-flex" href="#å…³äºlibtorchä¸pytorchè¾“å‡ºç»“æœçš„ä¸ä¸€è‡´æ€§">
        <span class="has-mr-6">6.1</span>
        <span>å…³äºlibtorchä¸pytorchè¾“å‡ºç»“æœçš„ä¸ä¸€è‡´æ€§</span>
        </a></li><li>
        <a class="is-flex" href="#C-è°ƒç”¨C-ç±»çš„å®ç°-å¦‚ä¸‹å†…å®¹å¾…æµ‹è¯•">
        <span class="has-mr-6">6.2</span>
        <span>C# è°ƒç”¨C++ç±»çš„å®ç°(å¦‚ä¸‹å†…å®¹å¾…æµ‹è¯•)</span>
        </a></li></ul></li><li>
        <a class="is-flex" href="#å‚è€ƒ">
        <span class="has-mr-6">7</span>
        <span>å‚è€ƒ</span>
        </a></li></ul>
            </div>
        </div>
    </div>

    
        <div class="card widget">
    <div class="card-content">
        <h3 class="menu-label">
            æœ€æ–°æ–‡ç« 
        </h3>
        
        <article class="media">
            
            <a href="/2021/01/28/Reinforcement-Learning-Tips-and-Tricks/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/../qnsource/blog/rl.jpg" alt="Reinforcement Learning:Tips and Tricks">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2021-01-28T02:56:30.000Z">2021-01-28</time></div>
                    <a href="/2021/01/28/Reinforcement-Learning-Tips-and-Tricks/" class="title has-link-black-ter is-size-6 has-text-weight-normal">Reinforcement Learning:Tips and Tricks</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/å¼ºåŒ–å­¦ä¹ /">å¼ºåŒ–å­¦ä¹ </a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2020/11/19/pytorchæ¨¡å‹çš„å¯¼å‡ºä¸éƒ¨ç½²/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/../qnsource/blog/cvat.jpg" alt="pytorchæ¨¡å‹çš„å¯¼å‡ºä¸éƒ¨ç½²">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2020-11-19T05:00:18.000Z">2020-11-19</time></div>
                    <a href="/2020/11/19/pytorchæ¨¡å‹çš„å¯¼å‡ºä¸éƒ¨ç½²/" class="title has-link-black-ter is-size-6 has-text-weight-normal">pytorchæ¨¡å‹çš„å¯¼å‡ºä¸éƒ¨ç½²</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/æ·±åº¦å­¦ä¹ /">æ·±åº¦å­¦ä¹ </a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2020/05/04/è¯»ä¹¦ç¬”è®°-ã€Šç¥ç»ç½‘ç»œä¸æ·±åº¦å­¦ä¹ ã€‹/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/../qnsource/blog/qxp.jpg" alt="è¯»ä¹¦ç¬”è®°-ã€Šç¥ç»ç½‘ç»œä¸æ·±åº¦å­¦ä¹ ã€‹">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2020-05-04T13:50:21.000Z">2020-05-04</time></div>
                    <a href="/2020/05/04/è¯»ä¹¦ç¬”è®°-ã€Šç¥ç»ç½‘ç»œä¸æ·±åº¦å­¦ä¹ ã€‹/" class="title has-link-black-ter is-size-6 has-text-weight-normal">è¯»ä¹¦ç¬”è®°-ã€Šç¥ç»ç½‘ç»œä¸æ·±åº¦å­¦ä¹ ã€‹</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/æ·±åº¦å­¦ä¹ /">æ·±åº¦å­¦ä¹ </a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2020/04/19/è®¡ç®—æœºè§†è§‰ç›®æ ‡æ£€æµ‹ç ”ç©¶æœ­è®°/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/../qnsource/banner/02.jpg" alt="è®¡ç®—æœºè§†è§‰ç›®æ ‡æ£€æµ‹ç ”ç©¶æœ­è®°">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2020-04-19T07:10:45.000Z">2020-04-19</time></div>
                    <a href="/2020/04/19/è®¡ç®—æœºè§†è§‰ç›®æ ‡æ£€æµ‹ç ”ç©¶æœ­è®°/" class="title has-link-black-ter is-size-6 has-text-weight-normal">è®¡ç®—æœºè§†è§‰ç›®æ ‡æ£€æµ‹ç ”ç©¶æœ­è®°</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/æ·±åº¦å­¦ä¹ /">æ·±åº¦å­¦ä¹ </a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2020/03/30/ç›®æ ‡æ£€æµ‹ä¸­çš„Anchorä¸æ„Ÿå—é‡/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/../qnsource/blog/anchor.jpg" alt="ç›®æ ‡æ£€æµ‹ä¸­çš„Anchorä¸æ„Ÿå—é‡">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2020-03-30T13:14:50.000Z">2020-03-30</time></div>
                    <a href="/2020/03/30/ç›®æ ‡æ£€æµ‹ä¸­çš„Anchorä¸æ„Ÿå—é‡/" class="title has-link-black-ter is-size-6 has-text-weight-normal">ç›®æ ‡æ£€æµ‹ä¸­çš„Anchorä¸æ„Ÿå—é‡</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/æ·±åº¦å­¦ä¹ /">æ·±åº¦å­¦ä¹ </a>
                    </p>
                </div>
            </div>
        </article>
        
    </div>
</div>
    
    
</div>

            </div>
        </div>
    </section>
    <footer class="footer">
    <div class="container">
        <div class="level">
            <div class="level-start has-text-centered-mobile">
                <a class="footer-logo is-block has-mb-6" href="/">
                
                    <img src="/images/logo02.png" alt="pytorchæ¨¡å‹çš„å¯¼å‡ºä¸éƒ¨ç½²" height="28">
                
                </a>
                <p class="is-size-7">
                &copy; 2021 Ebby DD&nbsp;
                Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> & <a
                        href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a>  æ²ªICPå¤‡20005404å·
                
                </p>
            </div>
            <div class="level-end">
            
                <div class="field has-addons is-flex-center-mobile has-mt-5-mobile is-flex-wrap is-flex-middle">
                
                <p class="control">
                    <a class="button is-white is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/">
                        
                        <i class="fab fa-creative-commons"></i>
                        
                    </a>
                </p>
                
                <p class="control">
                    <a class="button is-white is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/">
                        
                        <i class="fab fa-creative-commons-by"></i>
                        
                    </a>
                </p>
                
                </div>
            
            </div>
        </div>
    </div>
</footer>
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script>
<script>moment.locale("zh-CN");</script>


<script>
var IcarusThemeSettings = {
    site: {
        url: 'http://blog.a-stack.com',
        external_link: {"enable":true,"exclude":[]}
    },
    article: {
        highlight: {
            clipboard: true,
            fold: 'unfolded'
        }
    }
};
</script>


<script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script>





<script src="/js/animation.js"></script>



<script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script>
<script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script>
<script src="/js/gallery.js" defer></script>



<div id="outdated">
    <h6>Your browser is out-of-date!</h6>
    <p>Update your browser to view this website correctly. <a id="btnUpdateBrowser" href="http://outdatedbrowser.com/">Update
            my browser now </a></p>
    <p class="last"><a href="#" id="btnCloseUpdateBrowser" title="Close">&times;</a></p>
</div>
<script src="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.js" defer></script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        outdatedBrowser({
            bgColor: '#f25648',
            color: '#ffffff',
            lowerThan: 'flex'
        });
    });
</script>


<script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.5/unpacked/MathJax.js?config=TeX-MML-AM_CHTML" defer></script>
<script>
document.addEventListener('DOMContentLoaded', function () {
    MathJax.Hub.Config({
        'HTML-CSS': {
            matchFontHeight: false
        },
        SVG: {
            matchFontHeight: false
        },
        CommonHTML: {
            matchFontHeight: false
        },
        tex2jax: {
            inlineMath: [
                ['$','$'],
                ['\\(','\\)']
            ]
        }
    });
});
</script>


<a id="back-to-top" title="å›åˆ°é¡¶ç«¯" href="javascript:;">
    <i class="fas fa-chevron-up"></i>
</a>
<script src="/js/back-to-top.js" defer></script>














<script src="/js/main.js" defer></script>

    
    <div class="searchbox ins-search">
    <div class="searchbox-container ins-search-container">
        <div class="searchbox-input-wrapper">
            <input type="text" class="searchbox-input ins-search-input" placeholder="æƒ³è¦æŸ¥æ‰¾ä»€ä¹ˆ..." />
            <span class="searchbox-close ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="searchbox-result-wrapper ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
    (function (window) {
        var INSIGHT_CONFIG = {
            TRANSLATION: {
                POSTS: 'æ–‡ç« ',
                PAGES: 'é¡µé¢',
                CATEGORIES: 'åˆ†ç±»',
                TAGS: 'æ ‡ç­¾',
                UNTITLED: '(æ— æ ‡é¢˜)',
            },
            CONTENT_URL: '/content.json',
        };
        window.INSIGHT_CONFIG = INSIGHT_CONFIG;
    })(window);
</script>
<script src="/js/insight.js" defer></script>
<link rel="stylesheet" href="/css/search.css">
<link rel="stylesheet" href="/css/insight.css">
    
</body>
</html>